{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "languageVersion": "2.0",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.39.26.7824",
      "templateHash": "17896997500040733571"
    }
  },
  "parameters": {
    "environmentName": {
      "type": "string",
      "minLength": 1,
      "maxLength": 64,
      "metadata": {
        "description": "Name of the the environment which is used to generate a short unique hash used in all resources."
      }
    },
    "location": {
      "type": "string",
      "allowedValues": [
        "uaenorth",
        "southafricanorth",
        "westeurope",
        "southcentralus",
        "australiaeast",
        "canadaeast",
        "eastus",
        "eastus2",
        "francecentral",
        "japaneast",
        "northcentralus",
        "swedencentral",
        "switzerlandnorth",
        "uksouth"
      ],
      "minLength": 1,
      "metadata": {
        "description": "Primary location for all resources (filtered on available regions for Azure Open AI Service)."
      }
    },
    "tags": {
      "type": "object",
      "metadata": {
        "description": "Tags to be applied to resources."
      }
    },
    "resourceGroupName": {
      "type": "string",
      "metadata": {
        "description": "Name of the resource group. Leave blank to use default naming conventions."
      }
    },
    "apimServiceName": {
      "type": "string",
      "metadata": {
        "description": "Name of the API Management service. Leave blank to use default naming conventions."
      }
    },
    "applicationInsightsDashboardName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Application Insights dashboard for APIM. Leave blank to use default naming conventions."
      }
    },
    "applicationInsightsName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Application Insights for APIM resource. Leave blank to use default naming conventions."
      }
    },
    "eventHubNamespaceName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Event Hub Namespace resource. Leave blank to use default naming conventions."
      }
    },
    "cosmosDbAccountName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Cosmos DB account resource. Leave blank to use default naming conventions."
      }
    },
    "usageProcessingLogicAppName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Logic App resource for usage processing. Leave blank to use default naming conventions."
      }
    },
    "storageAccountName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Storage Account. Leave blank to use default naming conventions."
      }
    },
    "languageServiceName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Azure Language service. Leave blank to use default naming conventions."
      }
    },
    "aiContentSafetyName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Azure Content Safety service. Leave blank to use default naming conventions."
      }
    },
    "vnetName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Virtual Network. Leave blank to use default naming conventions."
      }
    },
    "useExistingVnet": {
      "type": "bool",
      "metadata": {
        "description": "Use an existing Virtual Network instead of creating a new one."
      }
    },
    "existingVnetRG": {
      "type": "string",
      "metadata": {
        "description": "Resource group containing the existing VNet (only used when useExistingVnet is true)."
      }
    },
    "apimSubnetName": {
      "type": "string"
    },
    "logicAppSubnetName": {
      "type": "string"
    },
    "redisPrivateEndpointSubnetName": {
      "type": "string"
    },
    "cosmosPrivateEndpointSubnetName": {
      "type": "string"
    },
    "eventHubPrivateEndpointSubnetName": {
      "type": "string"
    },
    "contentSafetyPrivateEndpointSubnetName": {
      "type": "string"
    },
    "languageApiPrivateEndpointSubnetName": {
      "type": "string"
    },
    "storageAccountPrivateEndpointSubnetName": {
      "type": "string"
    },
    "othersPrivateEndpointSubnetName": {
      "type": "string"
    },
    "apimNsgName": {
      "type": "string"
    },
    "logicAppNsgName": {
      "type": "string"
    },
    "cosmosPrivateEndpointNsgName": {
      "type": "string"
    },
    "redisPrivateEndpointNsgName": {
      "type": "string"
    },
    "eventhubPrivateEndpointNsgName": {
      "type": "string"
    },
    "contentSafetyPrivateEndpointNsgName": {
      "type": "string"
    },
    "languageApiPrivateEndpointNsgName": {
      "type": "string"
    },
    "storageAccountPrivateEndpointNsgName": {
      "type": "string"
    },
    "othersPrivateEndpointNsgName": {
      "type": "string"
    },
    "apimRouteTableName": {
      "type": "string",
      "metadata": {
        "description": "Route Table name for API Management subnet. Leave blank to use default naming conventions."
      }
    },
    "dnsZoneRG": {
      "type": "string",
      "metadata": {
        "description": "Resource group containing the DNS zones (only used with existing VNet)."
      }
    },
    "dnsSubscriptionId": {
      "type": "string",
      "metadata": {
        "description": "Subscription ID containing the DNS zones (only used with existing VNet)."
      }
    },
    "storageBlobPrivateEndpointName": {
      "type": "string",
      "metadata": {
        "description": "Storage Blob private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "storageFilePrivateEndpointName": {
      "type": "string",
      "metadata": {
        "description": "Storage File private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "storageTablePrivateEndpointName": {
      "type": "string",
      "metadata": {
        "description": "Storage Table private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "storageQueuePrivateEndpointName": {
      "type": "string",
      "metadata": {
        "description": "Storage Queue private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "cosmosDbPrivateEndpointName": {
      "type": "string",
      "metadata": {
        "description": "Cosmos DB private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "eventHubPrivateEndpointName": {
      "type": "string",
      "metadata": {
        "description": "Event Hub private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "languageServicePrivateEndpointName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Azure Language service private endpoint. Leave blank to use default naming conventions."
      }
    },
    "aiContentSafetyPrivateEndpointName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Azure Content Safety service private endpoint. Leave blank to use default naming conventions."
      }
    },
    "apimNetworkType": {
      "type": "string",
      "allowedValues": [
        "External",
        "Internal"
      ],
      "metadata": {
        "description": "Network type for API Management service. Applies only to Premium and Developer SKUs."
      }
    },
    "apimV2PublicNetworkAccess": {
      "type": "bool",
      "metadata": {
        "description": "API Management service external network access. When false, APIM must have private endpoint."
      }
    },
    "cosmosDbPublicAccess": {
      "type": "string",
      "allowedValues": [
        "Enabled",
        "Disabled"
      ],
      "metadata": {
        "description": "Cosmos DB public network access."
      }
    },
    "eventHubNetworkAccess": {
      "type": "string",
      "allowedValues": [
        "Enabled",
        "Disabled"
      ],
      "metadata": {
        "description": "Event Hub public network access."
      }
    },
    "languageServiceExternalNetworkAccess": {
      "type": "string",
      "allowedValues": [
        "Enabled",
        "Disabled"
      ],
      "metadata": {
        "description": "Azure Language service external network access."
      }
    },
    "aiContentSafetyExternalNetworkAccess": {
      "type": "string",
      "allowedValues": [
        "Enabled",
        "Disabled"
      ],
      "metadata": {
        "description": "Azure Content Safety external network access."
      }
    },
    "createAppInsightsDashboard": {
      "type": "bool",
      "metadata": {
        "description": "Create Application Insights dashboard."
      }
    },
    "enableAIModelInference": {
      "type": "bool",
      "metadata": {
        "description": "Enable AI Model Inference in API Management."
      }
    },
    "enableDocumentIntelligence": {
      "type": "bool",
      "metadata": {
        "description": "Enable Document Intelligence in API Management."
      }
    },
    "enableAIGatewayPiiRedaction": {
      "type": "bool",
      "metadata": {
        "description": "Enable PII redaction in AI Gateway"
      }
    },
    "enableOpenAIRealtime": {
      "type": "bool",
      "metadata": {
        "description": "Enable OpenAI realtime capabilities"
      }
    },
    "entraAuth": {
      "type": "bool",
      "metadata": {
        "description": "Enable Microsoft Entra ID authentication for API Management."
      }
    },
    "apimSku": {
      "type": "string",
      "allowedValues": [
        "Developer",
        "Premium",
        "StandardV2",
        "PremiumV2"
      ],
      "metadata": {
        "description": "API Management service SKU. Only Developer and Premium are supported."
      }
    },
    "apimSkuUnits": {
      "type": "int",
      "metadata": {
        "description": "API Management service SKU units."
      }
    },
    "eventHubCapacityUnits": {
      "type": "int",
      "metadata": {
        "description": "Event Hub capacity units."
      }
    },
    "cosmosDbRUs": {
      "type": "int",
      "metadata": {
        "description": "Cosmos DB throughput in Request Units (RUs)."
      }
    },
    "logicAppsSkuCapacityUnits": {
      "type": "int",
      "metadata": {
        "description": "Logic Apps SKU capacity units."
      }
    },
    "languageServiceSkuName": {
      "type": "string",
      "metadata": {
        "description": "Azure Language service SKU name."
      }
    },
    "aiContentSafetySkuName": {
      "type": "string",
      "metadata": {
        "description": "Azure Content Safety service SKU name."
      }
    },
    "functionContentShareName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Storage Account file share for Azure Function content."
      }
    },
    "logicContentShareName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Storage Account file share for Logic App content."
      }
    },
    "entraTenantId": {
      "type": "string",
      "metadata": {
        "description": "Microsoft Entra ID tenant ID for authentication (only used when entraAuth is true)."
      }
    },
    "entraClientId": {
      "type": "string",
      "metadata": {
        "description": "Microsoft Entra ID client ID for authentication (only used when entraAuth is true)."
      }
    },
    "entraAudience": {
      "type": "string",
      "metadata": {
        "description": "Audience value for Microsoft Entra ID authentication (only used when entraAuth is true)."
      }
    },
    "existingOpenAiAccountName": {
      "type": "string",
      "metadata": {
        "description": "Name of the existing Azure OpenAI (Cognitive Services) account to reuse."
      }
    },
    "existingOpenAiResourceGroupName": {
      "type": "string",
      "defaultValue": "[parameters('resourceGroupName')]",
      "metadata": {
        "description": "Resource group of the existing Azure OpenAI account. Defaults to the deployment RG."
      }
    },
    "existingLogAnalyticsWorkspaceName": {
      "type": "string",
      "metadata": {
        "description": "Name of the existing Log Analytics workspace to reuse."
      }
    },
    "existingLogAnalyticsWorkspaceResourceGroupName": {
      "type": "string",
      "defaultValue": "[parameters('resourceGroupName')]",
      "metadata": {
        "description": "Resource group of the existing Log Analytics workspace. Defaults to the deployment RG."
      }
    },
    "existingPrivateLinkScopeName": {
      "type": "string"
    },
    "existingPrivateLinkScopeRG": {
      "type": "string"
    },
    "existingPrivateLinkScopeSubId": {
      "type": "string"
    },
    "embeddingsDeploymentName": {
      "type": "string",
      "metadata": {
        "description": "Name of the embdedding deplyment to be used for caching"
      }
    },
    "redisClusterName": {
      "type": "string",
      "metadata": {
        "description": "name of the Redis Cluster"
      }
    },
    "skuName": {
      "type": "string",
      "metadata": {
        "description": "Redis Enterprise SKU (Azure Managed Redis / Redis Enterprise)."
      }
    },
    "redisPrivateEndpointName": {
      "type": "string"
    }
  },
  "variables": {
    "$fxv#0": {
      "analysisServicesServers": "as",
      "apiManagementService": "apim-",
      "appConfigurationConfigurationStores": "appcs-",
      "appManagedEnvironments": "cae-",
      "appContainerApps": "ca-",
      "authorizationPolicyDefinitions": "policy-",
      "automationAutomationAccounts": "aa-",
      "blueprintBlueprints": "bp-",
      "blueprintBlueprintsArtifacts": "bpa-",
      "cacheRedis": "redis-",
      "cdnProfiles": "cdnp-",
      "cdnProfilesEndpoints": "cdne-",
      "cognitiveServicesAccounts": "cog-",
      "cognitiveServicesFormRecognizer": "cog-fr-",
      "cognitiveServicesTextAnalytics": "cog-ta-",
      "computeAvailabilitySets": "avail-",
      "computeCloudServices": "cld-",
      "computeDiskEncryptionSets": "des",
      "computeDisks": "disk",
      "computeDisksOs": "osdisk",
      "computeGalleries": "gal",
      "computeSnapshots": "snap-",
      "computeVirtualMachines": "vm",
      "computeVirtualMachineScaleSets": "vmss-",
      "containerInstanceContainerGroups": "ci",
      "containerRegistryRegistries": "cr",
      "containerServiceManagedClusters": "aks-",
      "databricksWorkspaces": "dbw-",
      "dataFactoryFactories": "adf-",
      "dataLakeAnalyticsAccounts": "dla",
      "dataLakeStoreAccounts": "dls",
      "dataMigrationServices": "dms-",
      "dBforMySQLServers": "mysql-",
      "dBforPostgreSQLServers": "psql-",
      "devicesIotHubs": "iot-",
      "devicesProvisioningServices": "provs-",
      "devicesProvisioningServicesCertificates": "pcert-",
      "documentDBDatabaseAccounts": "cosmos-",
      "eventGridDomains": "evgd-",
      "eventGridDomainsTopics": "evgt-",
      "eventGridEventSubscriptions": "evgs-",
      "eventHubNamespaces": "evhns-",
      "eventHubNamespacesEventHubs": "evh-",
      "hdInsightClustersHadoop": "hadoop-",
      "hdInsightClustersHbase": "hbase-",
      "hdInsightClustersKafka": "kafka-",
      "hdInsightClustersMl": "mls-",
      "hdInsightClustersSpark": "spark-",
      "hdInsightClustersStorm": "storm-",
      "hybridComputeMachines": "arcs-",
      "insightsActionGroups": "ag-",
      "insightsComponents": "appi-",
      "keyVaultVaults": "kv-",
      "kubernetesConnectedClusters": "arck",
      "kustoClusters": "dec",
      "kustoClustersDatabases": "dedb",
      "logicIntegrationAccounts": "ia-",
      "logicWorkflows": "logic-",
      "machineLearningServicesWorkspaces": "mlw-",
      "managedIdentityUserAssignedIdentities": "id-",
      "managementManagementGroups": "mg-",
      "migrateAssessmentProjects": "migr-",
      "networkApplicationGateways": "agw-",
      "networkApplicationSecurityGroups": "asg-",
      "networkAzureFirewalls": "afw-",
      "networkBastionHosts": "bas-",
      "networkConnections": "con-",
      "networkDnsZones": "dnsz-",
      "networkExpressRouteCircuits": "erc-",
      "networkFirewallPolicies": "afwp-",
      "networkFirewallPoliciesWebApplication": "waf",
      "networkFirewallPoliciesRuleGroups": "wafrg",
      "networkFrontDoors": "fd-",
      "networkFrontdoorWebApplicationFirewallPolicies": "fdfp-",
      "networkLoadBalancersExternal": "lbe-",
      "networkLoadBalancersInternal": "lbi-",
      "networkLoadBalancersInboundNatRules": "rule-",
      "networkLocalNetworkGateways": "lgw-",
      "networkNatGateways": "ng-",
      "networkNetworkInterfaces": "nic-",
      "networkNetworkSecurityGroups": "nsg-",
      "networkNetworkSecurityGroupsSecurityRules": "nsgsr-",
      "networkNetworkWatchers": "nw-",
      "networkPrivateDnsZones": "pdnsz-",
      "networkPrivateLinkServices": "pl-",
      "networkPublicIPAddresses": "pip-",
      "networkPublicIPPrefixes": "ippre-",
      "networkRouteFilters": "rf-",
      "networkRouteTables": "rt-",
      "networkRouteTablesRoutes": "udr-",
      "networkTrafficManagerProfiles": "traf-",
      "networkVirtualNetworkGateways": "vgw-",
      "networkVirtualNetworks": "vnet-",
      "networkVirtualNetworksSubnets": "snet-",
      "networkVirtualNetworksVirtualNetworkPeerings": "peer-",
      "networkVirtualWans": "vwan-",
      "networkVpnGateways": "vpng-",
      "networkVpnGatewaysVpnConnections": "vcn-",
      "networkVpnGatewaysVpnSites": "vst-",
      "notificationHubsNamespaces": "ntfns-",
      "notificationHubsNamespacesNotificationHubs": "ntf-",
      "operationalInsightsWorkspaces": "log-",
      "portalDashboards": "dash-",
      "powerBIDedicatedCapacities": "pbi-",
      "purviewAccounts": "pview-",
      "privateEndpoints": "pe-",
      "recoveryServicesVaults": "rsv-",
      "resourcesResourceGroups": "rg-",
      "searchSearchServices": "srch-",
      "serviceBusNamespaces": "sb-",
      "serviceBusNamespacesQueues": "sbq-",
      "serviceBusNamespacesTopics": "sbt-",
      "serviceEndPointPolicies": "se-",
      "serviceFabricClusters": "sf-",
      "signalRServiceSignalR": "sigr",
      "sqlManagedInstances": "sqlmi-",
      "sqlServers": "sql-",
      "sqlServersDataWarehouse": "sqldw-",
      "sqlServersDatabases": "sqldb-",
      "sqlServersDatabasesStretch": "sqlstrdb-",
      "storageStorageAccounts": "st",
      "storageStorageAccountsVm": "stvm",
      "storSimpleManagers": "ssimp",
      "streamAnalyticsCluster": "asa-",
      "synapseWorkspaces": "syn",
      "synapseWorkspacesAnalyticsWorkspaces": "synw",
      "synapseWorkspacesSqlPoolsDedicated": "syndp",
      "synapseWorkspacesSqlPoolsSpark": "synsp",
      "timeSeriesInsightsEnvironments": "tsi-",
      "webServerFarms": "plan-",
      "webSitesAppService": "app-",
      "webSitesAppServiceEnvironment": "ase-",
      "webSitesFunctions": "func-",
      "webStaticSites": "stapp-"
    },
    "abbrs": "[variables('$fxv#0')]",
    "resourceToken": "[toLower(uniqueString(subscription().id, parameters('environmentName'), parameters('location')))]",
    "openAiPrivateDnsZoneName": "privatelink.openai.azure.com",
    "keyVaultPrivateDnsZoneName": "privatelink.vaultcore.azure.net",
    "monitorPrivateDnsZoneName": "privatelink.monitor.azure.com",
    "eventHubPrivateDnsZoneName": "privatelink.servicebus.windows.net",
    "cosmosDbPrivateDnsZoneName": "privatelink.documents.azure.com",
    "storageBlobPrivateDnsZoneName": "privatelink.blob.core.windows.net",
    "storageFilePrivateDnsZoneName": "privatelink.file.core.windows.net",
    "storageTablePrivateDnsZoneName": "privatelink.table.core.windows.net",
    "storageQueuePrivateDnsZoneName": "privatelink.queue.core.windows.net",
    "aiCogntiveServicesDnsZoneName": "privatelink.cognitiveservices.azure.com",
    "apimV2SkuDnsZoneName": "privatelink.azure-api.net",
    "redisPrivateDnsZoneName": "privatelink.redis.azure.net"
  },
  "resources": {
    "existingOpenAi": {
      "existing": true,
      "type": "Microsoft.CognitiveServices/accounts",
      "apiVersion": "2023-05-01",
      "resourceGroup": "[parameters('existingOpenAiResourceGroupName')]",
      "name": "[parameters('existingOpenAiAccountName')]"
    },
    "existingLaw": {
      "existing": true,
      "type": "Microsoft.OperationalInsights/workspaces",
      "apiVersion": "2022-10-01",
      "resourceGroup": "[parameters('existingLogAnalyticsWorkspaceResourceGroupName')]",
      "name": "[parameters('existingLogAnalyticsWorkspaceName')]"
    },
    "vnetExisting": {
      "condition": "[parameters('useExistingVnet')]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "vnetExisting",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": {
            "value": "[parameters('vnetName')]"
          },
          "apimSubnetName": {
            "value": "[parameters('apimSubnetName')]"
          },
          "logicAppSubnetName": {
            "value": "[parameters('logicAppSubnetName')]"
          },
          "redisPrivateEndpointSubnetName": {
            "value": "[parameters('redisPrivateEndpointSubnetName')]"
          },
          "cosmosPrivateEndpointSubnetName": {
            "value": "[parameters('cosmosPrivateEndpointSubnetName')]"
          },
          "eventHubPrivateEndpointSubnetName": {
            "value": "[parameters('eventHubPrivateEndpointSubnetName')]"
          },
          "contentSafetyPrivateEndpointSubnetName": {
            "value": "[parameters('contentSafetyPrivateEndpointSubnetName')]"
          },
          "languageApiPrivateEndpointSubnetName": {
            "value": "[parameters('languageApiPrivateEndpointSubnetName')]"
          },
          "storageAccountPrivateEndpointSubnetName": {
            "value": "[parameters('storageAccountPrivateEndpointSubnetName')]"
          },
          "vnetRG": {
            "value": "[parameters('existingVnetRG')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "1513379173270661078"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "vnetRG": {
              "type": "string"
            },
            "apimSubnetName": {
              "type": "string"
            },
            "logicAppSubnetName": {
              "type": "string"
            },
            "redisPrivateEndpointSubnetName": {
              "type": "string"
            },
            "cosmosPrivateEndpointSubnetName": {
              "type": "string"
            },
            "eventHubPrivateEndpointSubnetName": {
              "type": "string"
            },
            "contentSafetyPrivateEndpointSubnetName": {
              "type": "string"
            },
            "languageApiPrivateEndpointSubnetName": {
              "type": "string"
            },
            "storageAccountPrivateEndpointSubnetName": {
              "type": "string"
            }
          },
          "resources": [],
          "outputs": {
            "vnetRG": {
              "type": "string",
              "value": "[parameters('vnetRG')]"
            },
            "location": {
              "type": "string",
              "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), '2019-11-01', 'full').location]"
            },
            "virtualNetworkId": {
              "type": "string",
              "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name'))]"
            },
            "vnetName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "apimSubnetName": {
              "type": "string",
              "value": "[parameters('apimSubnetName')]"
            },
            "apimSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('apimSubnetName'))]"
            },
            "logicAppSubnetName": {
              "type": "string",
              "value": "[parameters('logicAppSubnetName')]"
            },
            "logicAppSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('logicAppSubnetName'))]"
            },
            "redisPrivateEndpointSubnetName": {
              "type": "string",
              "value": "[parameters('redisPrivateEndpointSubnetName')]"
            },
            "redisPrivateEndpointSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('redisPrivateEndpointSubnetName'))]"
            },
            "cosmosPrivateEndpointSubnetName": {
              "type": "string",
              "value": "[parameters('cosmosPrivateEndpointSubnetName')]"
            },
            "cosmosPrivateEndpointSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('cosmosPrivateEndpointSubnetName'))]"
            },
            "eventHubPrivateEndpointSubnetName": {
              "type": "string",
              "value": "[parameters('eventHubPrivateEndpointSubnetName')]"
            },
            "eventHubPrivateEndpointSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('eventHubPrivateEndpointSubnetName'))]"
            },
            "contentSafetyPrivateEndpointSubnetName": {
              "type": "string",
              "value": "[parameters('contentSafetyPrivateEndpointSubnetName')]"
            },
            "contentSafetyPrivateEndpointSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('contentSafetyPrivateEndpointSubnetName'))]"
            },
            "languageApiPrivateEndpointSubnetName": {
              "type": "string",
              "value": "[parameters('languageApiPrivateEndpointSubnetName')]"
            },
            "languageApiPrivateEndpointSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('languageApiPrivateEndpointSubnetName'))]"
            },
            "storageAccountPrivateEndpointSubnetName": {
              "type": "string",
              "value": "[parameters('storageAccountPrivateEndpointSubnetName')]"
            },
            "storageAccountPrivateEndpointSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('storageAccountPrivateEndpointSubnetName'))]"
            }
          }
        }
      }
    },
    "monitoring": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "monitoring",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "privateLinkScopeName": {
            "value": "[parameters('existingPrivateLinkScopeName')]"
          },
          "privateLinkScopeRgName": {
            "value": "[parameters('existingPrivateLinkScopeRG')]"
          },
          "privateLinkScopeSubId": {
            "value": "[parameters('existingPrivateLinkScopeSubId')]"
          },
          "logAnalyticsWorkspaceResourceId": {
            "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('existingLogAnalyticsWorkspaceResourceGroupName')), 'Microsoft.OperationalInsights/workspaces', parameters('existingLogAnalyticsWorkspaceName'))]"
          },
          "apimApplicationInsightsName": "[if(not(empty(parameters('applicationInsightsName'))), createObject('value', parameters('applicationInsightsName')), createObject('value', format('{0}apim-{1}', variables('abbrs').insightsComponents, variables('resourceToken'))))]",
          "apimApplicationInsightsDashboardName": "[if(not(empty(parameters('applicationInsightsDashboardName'))), createObject('value', parameters('applicationInsightsDashboardName')), createObject('value', format('{0}apim-{1}', variables('abbrs').portalDashboards, variables('resourceToken'))))]",
          "createDashboard": {
            "value": "[parameters('createAppInsightsDashboard')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "3553997694845974119"
            }
          },
          "parameters": {
            "privateLinkScopeRgName": {
              "type": "string"
            },
            "privateLinkScopeSubId": {
              "type": "string",
              "defaultValue": "[subscription().subscriptionId]"
            },
            "privateLinkScopeName": {
              "type": "string"
            },
            "apimApplicationInsightsName": {
              "type": "string"
            },
            "apimApplicationInsightsDashboardName": {
              "type": "string"
            },
            "location": {
              "type": "string"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "createDashboard": {
              "type": "bool"
            },
            "logAnalyticsWorkspaceResourceId": {
              "type": "string"
            }
          },
          "resources": [
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "application-insights",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "name": {
                    "value": "[parameters('apimApplicationInsightsName')]"
                  },
                  "dashboardName": {
                    "value": "[parameters('apimApplicationInsightsDashboardName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "tags": {
                    "value": "[parameters('tags')]"
                  },
                  "logAnalyticsWorkspaceId": {
                    "value": "[parameters('logAnalyticsWorkspaceResourceId')]"
                  },
                  "createDashboard": {
                    "value": "[parameters('createDashboard')]"
                  },
                  "usePrivateLinkScope": {
                    "value": "[not(equals(parameters('privateLinkScopeName'), ''))]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1547612462218128614"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "dashboardName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]"
                    },
                    "tags": {
                      "type": "object",
                      "defaultValue": {}
                    },
                    "logAnalyticsWorkspaceId": {
                      "type": "string"
                    },
                    "createDashboard": {
                      "type": "bool"
                    },
                    "usePrivateLinkScope": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Set to true when this App Insights instance will be linked to an AMPLS."
                      }
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Insights/components",
                      "apiVersion": "2020-02-02",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
                      "kind": "web",
                      "properties": {
                        "Application_Type": "web",
                        "WorkspaceResourceId": "[parameters('logAnalyticsWorkspaceId')]",
                        "publicNetworkAccessForIngestion": "[if(parameters('usePrivateLinkScope'), 'Disabled', 'Enabled')]",
                        "publicNetworkAccessForQuery": "Enabled",
                        "CustomMetricsOptedInType": "WithDimensions"
                      }
                    },
                    {
                      "condition": "[parameters('createDashboard')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "application-insights-dashboard",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[parameters('dashboardName')]"
                          },
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "applicationInsightsName": {
                            "value": "[parameters('name')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "14532348577945871377"
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string"
                            },
                            "applicationInsightsName": {
                              "type": "string"
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]"
                            },
                            "tags": {
                              "type": "object",
                              "defaultValue": {}
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Portal/dashboards",
                              "apiVersion": "2020-09-01-preview",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "lenses": [
                                  {
                                    "order": 0,
                                    "parts": [
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 0,
                                          "colSpan": 2,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "id",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/AspNetOverviewPinnedPart",
                                          "asset": {
                                            "idInputName": "id",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "overview"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 2,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/ProactiveDetectionAsyncPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "ProactiveDetection"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 3,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "ResourceId",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/QuickPulseButtonSmallPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "endTime": null,
                                                "createdTime": "2018-05-04T01:20:33.345Z",
                                                "isInitialTime": true,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/AvailabilityNavButtonPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 5,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "endTime": null,
                                                "createdTime": "2018-05-08T18:47:35.237Z",
                                                "isInitialTime": true,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            },
                                            {
                                              "name": "ConfigurationId",
                                              "value": "78ce933e-e864-4b05-a27b-71fd55a6afad"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/AppMapButtonPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Usage",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 3,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "endTime": null,
                                                "createdTime": "2018-05-04T01:22:35.782Z",
                                                "isInitialTime": true,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/UsageUsersOverviewPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Reliability",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 7,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ResourceId",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            },
                                            {
                                              "name": "DataModel",
                                              "value": {
                                                "version": "1.0.0",
                                                "timeContext": {
                                                  "durationMs": 86400000,
                                                  "createdTime": "2018-05-04T23:42:40.072Z",
                                                  "isInitialTime": false,
                                                  "grain": 1,
                                                  "useDashboardTimeRange": false
                                                }
                                              },
                                              "isOptional": true
                                            },
                                            {
                                              "name": "ConfigurationId",
                                              "value": "8a02f7bf-ac0f-40e1-afe9-f0e72cfee77f",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/CuratedBladeFailuresPinnedPart",
                                          "isAdapter": true,
                                          "asset": {
                                            "idInputName": "ResourceId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "failures"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Responsiveness\r\n",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 11,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ResourceId",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            },
                                            {
                                              "name": "DataModel",
                                              "value": {
                                                "version": "1.0.0",
                                                "timeContext": {
                                                  "durationMs": 86400000,
                                                  "createdTime": "2018-05-04T23:43:37.804Z",
                                                  "isInitialTime": false,
                                                  "grain": 1,
                                                  "useDashboardTimeRange": false
                                                }
                                              },
                                              "isOptional": true
                                            },
                                            {
                                              "name": "ConfigurationId",
                                              "value": "2a8ede4f-2bee-4b9c-aed9-2db0e8a01865",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/CuratedBladePerformancePinnedPart",
                                          "isAdapter": true,
                                          "asset": {
                                            "idInputName": "ResourceId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "performance"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 12,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Browser",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 15,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "MetricsExplorerJsonDefinitionId",
                                              "value": "BrowserPerformanceTimelineMetrics"
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "createdTime": "2018-05-08T12:16:27.534Z",
                                                "isInitialTime": false,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            },
                                            {
                                              "name": "CurrentFilter",
                                              "value": {
                                                "eventTypes": [
                                                  4,
                                                  1,
                                                  3,
                                                  5,
                                                  2,
                                                  6,
                                                  13
                                                ],
                                                "typeFacets": {},
                                                "isPermissive": false
                                              }
                                            },
                                            {
                                              "name": "id",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/MetricsExplorerBladePinnedPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "browser"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "sessions/count",
                                                      "aggregationType": 5,
                                                      "namespace": "microsoft.insights/components/kusto",
                                                      "metricVisualization": {
                                                        "displayName": "Sessions",
                                                        "color": "#47BDF5"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "users/count",
                                                      "aggregationType": 5,
                                                      "namespace": "microsoft.insights/components/kusto",
                                                      "metricVisualization": {
                                                        "displayName": "Users",
                                                        "color": "#7E58FF"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Unique sessions and users",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "segmentationUsers"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "requests/failed",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Failed requests",
                                                        "color": "#EC008C"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Failed requests",
                                                  "visualization": {
                                                    "chartType": 3,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "failures"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "requests/duration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Server response time",
                                                        "color": "#00BCF2"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Server response time",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "performance"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 12,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/networkDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Page load network connect time",
                                                        "color": "#7E58FF"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/processingDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Client processing time",
                                                        "color": "#44F1C8"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/sendDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Send request time",
                                                        "color": "#EB9371"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/receiveDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Receiving response time",
                                                        "color": "#0672F1"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average page load time breakdown",
                                                  "visualization": {
                                                    "chartType": 3,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "availabilityResults/availabilityPercentage",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Availability",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average availability",
                                                  "visualization": {
                                                    "chartType": 3,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "availability"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "exceptions/server",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Server exceptions",
                                                        "color": "#47BDF5"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "dependencies/failed",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Dependency failures",
                                                        "color": "#7E58FF"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Server exceptions and Dependency failures",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/processorCpuPercentage",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Processor time",
                                                        "color": "#47BDF5"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/processCpuPercentage",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Process CPU",
                                                        "color": "#7E58FF"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average processor and process CPU utilization",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 12,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "exceptions/browser",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Browser exceptions",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Browser exceptions",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 8,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "availabilityResults/count",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Availability test results count",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Availability test results count",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 8,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/processIOBytesPerSecond",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Process IO rate",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average process I/O rate",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 8,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/memoryAvailableBytes",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Available memory",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average available memory",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      }
                                    ]
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Insights/components', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "connectionString": {
                      "type": "string",
                      "value": "[reference(resourceId('Microsoft.Insights/components', parameters('name')), '2020-02-02').ConnectionString]"
                    },
                    "instrumentationKey": {
                      "type": "string",
                      "value": "[reference(resourceId('Microsoft.Insights/components', parameters('name')), '2020-02-02').InstrumentationKey]"
                    },
                    "name": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    },
                    "id": {
                      "type": "string",
                      "value": "[resourceId('Microsoft.Insights/components', parameters('name'))]"
                    }
                  }
                }
              }
            },
            {
              "condition": "[not(equals(parameters('privateLinkScopeName'), ''))]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "ampls-appinsights-link",
              "subscriptionId": "[parameters('privateLinkScopeSubId')]",
              "resourceGroup": "[parameters('privateLinkScopeRgName')]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "privateLinkScopeName": {
                    "value": "[parameters('privateLinkScopeName')]"
                  },
                  "linkedResourceId": {
                    "value": "[reference(resourceId('Microsoft.Resources/deployments', 'application-insights'), '2025-04-01').outputs.id.value]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "14786299305833041854"
                    }
                  },
                  "parameters": {
                    "privateLinkScopeName": {
                      "type": "string",
                      "metadata": {
                        "description": "Name of an existing Azure Monitor Private Link Scope (AMPLS) in this resource group."
                      }
                    },
                    "linkedResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource ID of the resource to link (App Insights)."
                      }
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Insights/privateLinkScopes/scopedResources",
                      "apiVersion": "2021-07-01-preview",
                      "name": "[format('{0}/{1}', parameters('privateLinkScopeName'), 'appinsights-connection')]",
                      "properties": {
                        "linkedResourceId": "[parameters('linkedResourceId')]"
                      }
                    }
                  ]
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'application-insights')]"
              ]
            }
          ],
          "outputs": {
            "applicationInsightsName": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'application-insights'), '2025-04-01').outputs.name.value]"
            },
            "applicationInsightsConnectionString": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'application-insights'), '2025-04-01').outputs.connectionString.value]"
            },
            "applicationInsightsInstrumentationKey": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'application-insights'), '2025-04-01').outputs.instrumentationKey.value]"
            },
            "logAnalyticsWorkspaceId": {
              "type": "string",
              "value": "[parameters('logAnalyticsWorkspaceResourceId')]"
            },
            "logAnalyticsWorkspaceName": {
              "type": "string",
              "value": "[last(split(parameters('logAnalyticsWorkspaceResourceId'), '/'))]"
            }
          }
        }
      },
      "dependsOn": [
        "vnetExisting"
      ]
    },
    "contentSafety": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "ai-content-safety",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('aiContentSafetyName'))), createObject('value', parameters('aiContentSafetyName')), createObject('value', format('{0}consafety-{1}', variables('abbrs').cognitiveServicesAccounts, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "kind": {
            "value": "ContentSafety"
          },
          "vNetName": {
            "value": "[reference('vnetExisting').outputs.vnetName.value]"
          },
          "vNetLocation": {
            "value": "[reference('vnetExisting').outputs.location.value]"
          },
          "privateEndpointSubnetName": {
            "value": "[reference('vnetExisting').outputs.contentSafetyPrivateEndpointSubnetName.value]"
          },
          "aiPrivateEndpointName": "[if(not(empty(parameters('aiContentSafetyPrivateEndpointName'))), createObject('value', parameters('aiContentSafetyPrivateEndpointName')), createObject('value', format('{0}consafety-pe-{1}', variables('abbrs').cognitiveServicesAccounts, variables('resourceToken'))))]",
          "publicNetworkAccess": {
            "value": "[parameters('aiContentSafetyExternalNetworkAccess')]"
          },
          "openAiDnsZoneName": {
            "value": "[variables('aiCogntiveServicesDnsZoneName')]"
          },
          "sku": {
            "value": {
              "name": "[parameters('aiContentSafetySkuName')]"
            }
          },
          "vNetRG": {
            "value": "[reference('vnetExisting').outputs.vnetRG.value]"
          },
          "dnsZoneRG": {
            "value": "[parameters('dnsZoneRG')]"
          },
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "226830365898815919"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "deployments": {
              "type": "array",
              "defaultValue": []
            },
            "kind": {
              "type": "string",
              "defaultValue": "OpenAI"
            },
            "sku": {
              "type": "object",
              "defaultValue": {
                "name": "S0"
              }
            },
            "deploymentCapacity": {
              "type": "int",
              "defaultValue": 1
            },
            "publicNetworkAccess": {
              "type": "string",
              "defaultValue": "Disabled"
            },
            "aiPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "vNetLocation": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "openAiDnsZoneName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            }
          },
          "resources": [
            {
              "type": "Microsoft.CognitiveServices/accounts",
              "apiVersion": "2023-05-01",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "kind": "[parameters('kind')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "customSubDomainName": "[toLower(parameters('name'))]",
                "publicNetworkAccess": "[parameters('publicNetworkAccess')]",
                "networkAcls": {
                  "defaultAction": "Deny",
                  "ipRules": [],
                  "virtualNetworkRules": []
                }
              },
              "sku": "[parameters('sku')]"
            },
            {
              "copy": {
                "name": "deployment",
                "count": "[length(parameters('deployments'))]",
                "mode": "serial",
                "batchSize": 1
              },
              "type": "Microsoft.CognitiveServices/accounts/deployments",
              "apiVersion": "2023-05-01",
              "name": "[format('{0}/{1}', parameters('name'), parameters('deployments')[copyIndex()].name)]",
              "properties": {
                "model": "[parameters('deployments')[copyIndex()].model]",
                "raiPolicyName": "[coalesce(tryGet(parameters('deployments')[copyIndex()], 'raiPolicyName'), null())]"
              },
              "sku": "[coalesce(tryGet(parameters('deployments')[copyIndex()], 'sku'), createObject('name', 'Standard', 'capacity', parameters('deploymentCapacity')))]",
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('name'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "account"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('openAiDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('aiPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
                  },
                  "location": {
                    "value": "[parameters('vNetLocation')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1357425506328167870"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]",
                "deployment"
              ]
            }
          ],
          "outputs": {
            "openAiName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "openAiEndpointUri": {
              "type": "string",
              "value": "[format('{0}openai/', reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint)]"
            },
            "aiServiceName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "aiServiceEndpoint": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint]"
            }
          }
        }
      },
      "dependsOn": [
        "vnetExisting"
      ]
    },
    "languageService": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "ai-language-service",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('languageServiceName'))), createObject('value', parameters('languageServiceName')), createObject('value', format('{0}language-{1}', variables('abbrs').cognitiveServicesAccounts, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "kind": {
            "value": "TextAnalytics"
          },
          "vNetName": {
            "value": "[reference('vnetExisting').outputs.vnetName.value]"
          },
          "vNetLocation": {
            "value": "[reference('vnetExisting').outputs.location.value]"
          },
          "privateEndpointSubnetName": {
            "value": "[reference('vnetExisting').outputs.languageApiPrivateEndpointSubnetName.value]"
          },
          "aiPrivateEndpointName": "[if(not(empty(parameters('languageServicePrivateEndpointName'))), createObject('value', parameters('languageServicePrivateEndpointName')), createObject('value', format('{0}language-pe-{1}', variables('abbrs').cognitiveServicesAccounts, variables('resourceToken'))))]",
          "publicNetworkAccess": {
            "value": "[parameters('languageServiceExternalNetworkAccess')]"
          },
          "openAiDnsZoneName": {
            "value": "[variables('aiCogntiveServicesDnsZoneName')]"
          },
          "sku": {
            "value": {
              "name": "[parameters('languageServiceSkuName')]"
            }
          },
          "vNetRG": {
            "value": "[reference('vnetExisting').outputs.vnetRG.value]"
          },
          "dnsZoneRG": {
            "value": "[parameters('dnsZoneRG')]"
          },
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "226830365898815919"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "deployments": {
              "type": "array",
              "defaultValue": []
            },
            "kind": {
              "type": "string",
              "defaultValue": "OpenAI"
            },
            "sku": {
              "type": "object",
              "defaultValue": {
                "name": "S0"
              }
            },
            "deploymentCapacity": {
              "type": "int",
              "defaultValue": 1
            },
            "publicNetworkAccess": {
              "type": "string",
              "defaultValue": "Disabled"
            },
            "aiPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "vNetLocation": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "openAiDnsZoneName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            }
          },
          "resources": [
            {
              "type": "Microsoft.CognitiveServices/accounts",
              "apiVersion": "2023-05-01",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "kind": "[parameters('kind')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "customSubDomainName": "[toLower(parameters('name'))]",
                "publicNetworkAccess": "[parameters('publicNetworkAccess')]",
                "networkAcls": {
                  "defaultAction": "Deny",
                  "ipRules": [],
                  "virtualNetworkRules": []
                }
              },
              "sku": "[parameters('sku')]"
            },
            {
              "copy": {
                "name": "deployment",
                "count": "[length(parameters('deployments'))]",
                "mode": "serial",
                "batchSize": 1
              },
              "type": "Microsoft.CognitiveServices/accounts/deployments",
              "apiVersion": "2023-05-01",
              "name": "[format('{0}/{1}', parameters('name'), parameters('deployments')[copyIndex()].name)]",
              "properties": {
                "model": "[parameters('deployments')[copyIndex()].model]",
                "raiPolicyName": "[coalesce(tryGet(parameters('deployments')[copyIndex()], 'raiPolicyName'), null())]"
              },
              "sku": "[coalesce(tryGet(parameters('deployments')[copyIndex()], 'sku'), createObject('name', 'Standard', 'capacity', parameters('deploymentCapacity')))]",
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('name'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "account"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('openAiDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('aiPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
                  },
                  "location": {
                    "value": "[parameters('vNetLocation')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1357425506328167870"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]",
                "deployment"
              ]
            }
          ],
          "outputs": {
            "openAiName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "openAiEndpointUri": {
              "type": "string",
              "value": "[format('{0}openai/', reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint)]"
            },
            "aiServiceName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "aiServiceEndpoint": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint]"
            }
          }
        }
      },
      "dependsOn": [
        "vnetExisting"
      ]
    },
    "eventHub": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "event-hub",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('eventHubNamespaceName'))), createObject('value', parameters('eventHubNamespaceName')), createObject('value', format('{0}{1}', variables('abbrs').eventHubNamespaces, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "eventHubPrivateEndpointName": "[if(not(empty(parameters('eventHubPrivateEndpointName'))), createObject('value', parameters('eventHubPrivateEndpointName')), createObject('value', format('{0}pe-{1}', variables('abbrs').eventHubNamespaces, variables('resourceToken'))))]",
          "vNetName": {
            "value": "[reference('vnetExisting').outputs.vnetName.value]"
          },
          "privateEndpointSubnetName": {
            "value": "[reference('vnetExisting').outputs.eventHubPrivateEndpointSubnetName.value]"
          },
          "eventHubDnsZoneName": {
            "value": "[variables('eventHubPrivateDnsZoneName')]"
          },
          "publicNetworkAccess": {
            "value": "[parameters('eventHubNetworkAccess')]"
          },
          "vNetRG": {
            "value": "[reference('vnetExisting').outputs.vnetRG.value]"
          },
          "dnsZoneRG": {
            "value": "[parameters('dnsZoneRG')]"
          },
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]",
          "capacity": {
            "value": "[parameters('eventHubCapacityUnits')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "languageVersion": "2.0",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "15319937389598283341"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "sku": {
              "type": "string",
              "defaultValue": "Standard"
            },
            "capacity": {
              "type": "int",
              "defaultValue": 1
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "eventHubName": {
              "type": "string",
              "defaultValue": "ai-usage"
            },
            "isPIIEnabled": {
              "type": "bool",
              "defaultValue": true
            },
            "eventHubNamePII": {
              "type": "string",
              "defaultValue": "pii-usage"
            },
            "eventHubPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "eventHubDnsZoneName": {
              "type": "string"
            },
            "publicNetworkAccess": {
              "type": "string",
              "defaultValue": "Enabled"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            },
            "zoneRedundant": {
              "type": "bool",
              "defaultValue": true
            },
            "disasterRecoveryConfig": {
              "type": "object",
              "defaultValue": {}
            },
            "messageRetentionInDays": {
              "type": "int",
              "defaultValue": 7
            },
            "autoInflateEnabled": {
              "type": "bool",
              "defaultValue": true
            },
            "maximumThroughputUnits": {
              "type": "int",
              "defaultValue": 20
            },
            "kafkaEnabled": {
              "type": "bool",
              "defaultValue": false
            }
          },
          "resources": {
            "vnet": {
              "existing": true,
              "type": "Microsoft.Network/virtualNetworks",
              "apiVersion": "2022-01-01",
              "resourceGroup": "[parameters('vNetRG')]",
              "name": "[parameters('vNetName')]"
            },
            "subnet": {
              "existing": true,
              "type": "Microsoft.Network/virtualNetworks/subnets",
              "apiVersion": "2022-01-01",
              "resourceGroup": "[parameters('vNetRG')]",
              "name": "[format('{0}/{1}', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
            },
            "eventHubNamespace": {
              "type": "Microsoft.EventHub/namespaces",
              "apiVersion": "2024-05-01-preview",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "sku": {
                "name": "[parameters('sku')]",
                "tier": "[parameters('sku')]",
                "capacity": "[parameters('capacity')]"
              },
              "properties": {
                "isAutoInflateEnabled": "[parameters('autoInflateEnabled')]",
                "maximumThroughputUnits": "[parameters('maximumThroughputUnits')]",
                "publicNetworkAccess": "[parameters('publicNetworkAccess')]",
                "zoneRedundant": "[parameters('zoneRedundant')]",
                "kafkaEnabled": "[parameters('kafkaEnabled')]",
                "disableLocalAuth": false,
                "minimumTlsVersion": "1.2"
              }
            },
            "eventHub": {
              "type": "Microsoft.EventHub/namespaces/eventhubs",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}', parameters('name'), parameters('eventHubName'))]",
              "properties": {
                "messageRetentionInDays": "[parameters('messageRetentionInDays')]",
                "partitionCount": 4,
                "status": "Active"
              },
              "dependsOn": [
                "eventHubNamespace"
              ]
            },
            "eventHubPII": {
              "condition": "[parameters('isPIIEnabled')]",
              "type": "Microsoft.EventHub/namespaces/eventhubs",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}', parameters('name'), parameters('eventHubNamePII'))]",
              "properties": {
                "messageRetentionInDays": "[parameters('messageRetentionInDays')]",
                "partitionCount": 2,
                "status": "Active"
              },
              "dependsOn": [
                "eventHubNamespace"
              ]
            },
            "defaultConsumerGroup": {
              "type": "Microsoft.EventHub/namespaces/eventhubs/consumergroups",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), parameters('eventHubName'), '$Default')]",
              "dependsOn": [
                "eventHub"
              ]
            },
            "aiUsageConsumerGroup": {
              "type": "Microsoft.EventHub/namespaces/eventhubs/consumergroups",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), parameters('eventHubName'), 'aiUsageIngestion')]",
              "dependsOn": [
                "eventHub"
              ]
            },
            "defaultPIIConsumerGroup": {
              "type": "Microsoft.EventHub/namespaces/eventhubs/consumergroups",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), parameters('eventHubNamePII'), '$Default')]",
              "dependsOn": [
                "eventHubPII"
              ]
            },
            "piiUsageConsumerGroup": {
              "type": "Microsoft.EventHub/namespaces/eventhubs/consumergroups",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), parameters('eventHubNamePII'), 'piiUsageIngestion')]",
              "dependsOn": [
                "eventHubPII"
              ]
            },
            "disasterRecovery": {
              "condition": "[not(empty(parameters('disasterRecoveryConfig')))]",
              "type": "Microsoft.EventHub/namespaces/disasterRecoveryConfigs",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}', parameters('name'), 'default')]",
              "properties": "[parameters('disasterRecoveryConfig')]",
              "dependsOn": [
                "eventHubNamespace"
              ]
            },
            "eventHubSendRule": {
              "type": "Microsoft.EventHub/namespaces/eventhubs/authorizationRules",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), parameters('eventHubName'), 'apim-send')]",
              "properties": {
                "rights": [
                  "Send"
                ]
              },
              "dependsOn": [
                "eventHub"
              ]
            },
            "privateEndpoint": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('eventHubName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "namespace"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('eventHubDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('eventHubPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.EventHub/namespaces', parameters('name'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1357425506328167870"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "eventHubNamespace"
              ]
            }
          },
          "outputs": {
            "eventHubNamespaceName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "eventHubName": {
              "type": "string",
              "value": "[parameters('eventHubName')]"
            },
            "eventHubEndpoint": {
              "type": "string",
              "value": "[reference('eventHubNamespace').serviceBusEndpoint]"
            },
            "eventHubPIIName": {
              "type": "string",
              "value": "[coalesce(parameters('eventHubNamePII'), '')]"
            },
            "eventHubResourceId": {
              "type": "string",
              "value": "[resourceId('Microsoft.EventHub/namespaces', parameters('name'))]"
            },
            "eventHubConnectionString": {
              "type": "securestring",
              "value": "[listKeys('eventHubSendRule', '2024-05-01-preview').primaryConnectionString]"
            }
          }
        }
      },
      "dependsOn": [
        "vnetExisting"
      ]
    },
    "apim": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "apim",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('apimServiceName'))), createObject('value', parameters('apimServiceName')), createObject('value', format('{0}{1}', variables('abbrs').apiManagementService, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "applicationInsightsName": {
            "value": "[reference('monitoring').outputs.applicationInsightsName.value]"
          },
          "openAiUris": {
            "value": [
              "[reference('existingOpenAi').endpoint]"
            ]
          },
          "entraAuth": {
            "value": "[parameters('entraAuth')]"
          },
          "clientAppId": "[if(parameters('entraAuth'), createObject('value', parameters('entraClientId')), createObject('value', null()))]",
          "tenantId": "[if(parameters('entraAuth'), createObject('value', parameters('entraTenantId')), createObject('value', null()))]",
          "audience": "[if(parameters('entraAuth'), createObject('value', parameters('entraAudience')), createObject('value', null()))]",
          "eventHubName": {
            "value": "[reference('eventHub').outputs.eventHubName.value]"
          },
          "eventHubEndpoint": {
            "value": "[reference('eventHub').outputs.eventHubEndpoint.value]"
          },
          "eventHubPIIName": {
            "value": "[reference('eventHub').outputs.eventHubPIIName.value]"
          },
          "eventHubConnectionString": {
            "value": "[listOutputsWithSecureValues('eventHub', '2025-04-01').eventHubConnectionString]"
          },
          "apimSubnetId": {
            "value": "[reference('vnetExisting').outputs.apimSubnetId.value]"
          },
          "aiLanguageServiceUrl": {
            "value": "[reference('languageService').outputs.aiServiceEndpoint.value]"
          },
          "contentSafetyServiceUrl": {
            "value": "[reference('contentSafety').outputs.aiServiceEndpoint.value]"
          },
          "apimNetworkType": {
            "value": "[parameters('apimNetworkType')]"
          },
          "enablePIIAnonymization": {
            "value": "[parameters('enableAIGatewayPiiRedaction')]"
          },
          "enableAIModelInference": {
            "value": "[parameters('enableAIModelInference')]"
          },
          "enableDocumentIntelligence": {
            "value": "[parameters('enableDocumentIntelligence')]"
          },
          "enableOpenAIRealtime": {
            "value": "[parameters('enableOpenAIRealtime')]"
          },
          "sku": {
            "value": "[parameters('apimSku')]"
          },
          "skuCount": {
            "value": "[parameters('apimSkuUnits')]"
          },
          "apimV2PublicNetworkAccess": {
            "value": "[parameters('apimV2PublicNetworkAccess')]"
          },
          "enableSemanticCaching": {
            "value": true
          },
          "semanticCacheName": {
            "value": "default"
          },
          "semanticCacheConnectionString": {
            "value": "[format('{0}:10000,password={1},ssl=True,abortConnect=False', reference('redis').outputs.redisHostName.value, listOutputsWithSecureValues('redisKeys', '2025-04-01').primaryKey)]"
          },
          "embeddingsDeploymentName": {
            "value": "[parameters('embeddingsDeploymentName')]"
          },
          "embeddingsBackendId": {
            "value": "embeddings-backend"
          },
          "eventHubNamespaceName": {
            "value": "[reference('eventHub').outputs.eventHubNamespaceName.value]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "languageVersion": "2.0",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "9989221170702775972"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "entraAuth": {
              "type": "bool",
              "defaultValue": false
            },
            "publisherEmail": {
              "type": "string",
              "defaultValue": "noreply@microsoft.com",
              "minLength": 1
            },
            "publisherName": {
              "type": "string",
              "defaultValue": "n/a",
              "minLength": 1
            },
            "sku": {
              "type": "string",
              "defaultValue": "Developer"
            },
            "skuCount": {
              "type": "int",
              "defaultValue": 1
            },
            "applicationInsightsName": {
              "type": "string"
            },
            "openAiUris": {
              "type": "array"
            },
            "clientAppId": {
              "type": "string",
              "defaultValue": " "
            },
            "tenantId": {
              "type": "string",
              "defaultValue": "[tenant().tenantId]"
            },
            "audience": {
              "type": "string",
              "defaultValue": "https://cognitiveservices.azure.com/.default"
            },
            "eventHubName": {
              "type": "string"
            },
            "eventHubNamespaceName": {
              "type": "string"
            },
            "eventHubEndpoint": {
              "type": "string"
            },
            "eventHubPIIName": {
              "type": "string"
            },
            "eventHubConnectionString": {
              "type": "string"
            },
            "enableAIModelInference": {
              "type": "bool",
              "defaultValue": true
            },
            "enableOpenAIRealtime": {
              "type": "bool",
              "defaultValue": true
            },
            "enableDocumentIntelligence": {
              "type": "bool",
              "defaultValue": true
            },
            "enablePIIAnonymization": {
              "type": "bool",
              "defaultValue": true
            },
            "contentSafetyServiceUrl": {
              "type": "string"
            },
            "aiLanguageServiceUrl": {
              "type": "string"
            },
            "enableSemanticCaching": {
              "type": "bool",
              "defaultValue": true,
              "metadata": {
                "description": "Enable semantic caching for Azure OpenAI API."
              }
            },
            "semanticCacheName": {
              "type": "string",
              "defaultValue": "default",
              "metadata": {
                "description": "APIM external cache entity name. Use \"default\" unless you have multi-region caches."
              }
            },
            "semanticCacheConnectionString": {
              "type": "securestring",
              "metadata": {
                "description": "Redis connection string used by APIM external cache."
              }
            },
            "embeddingsDeploymentName": {
              "type": "string",
              "metadata": {
                "description": "Azure OpenAI embeddings deployment name used for semantic caching."
              }
            },
            "embeddingsBackendId": {
              "type": "string",
              "defaultValue": "embeddings-backend",
              "metadata": {
                "description": "APIM backend id used by semantic cache lookup policy for embeddings calls."
              }
            },
            "apimNetworkType": {
              "type": "string",
              "defaultValue": "External"
            },
            "apimSubnetId": {
              "type": "string"
            },
            "apimV2PrivateDnsZoneName": {
              "type": "string",
              "defaultValue": "privatelink.azure-api.net"
            },
            "apimV2PublicNetworkAccess": {
              "type": "bool",
              "defaultValue": false
            }
          },
          "variables": {
            "$fxv#0": {
              "openapi": "3.0.0",
              "info": {
                "title": "Azure OpenAI Service API",
                "description": "Azure OpenAI APIs for completions and search",
                "version": "2024-10-21"
              },
              "servers": [
                {
                  "url": "https://REPLACEBYPOLICY/openai",
                  "variables": {
                    "endpoint": {
                      "default": "your-resource-name.openai.azure.com"
                    }
                  }
                }
              ],
              "security": [
                {
                  "bearer": [
                    "api.read"
                  ]
                },
                {
                  "apiKey": []
                }
              ],
              "paths": {
                "/deployments/{deployment-id}/completions": {
                  "post": {
                    "summary": "Creates a completion for the provided prompt, parameters and chosen model.",
                    "operationId": "Completions_Create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "davinci",
                          "description": "Deployment id of the model which was deployed."
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "application/json": {
                          "schema": {
                            "$ref": "#/components/schemas/createCompletionRequest"
                          },
                          "example": {
                            "prompt": "Negate the following sentence.The price for bubblegum increased on thursday.\n\n Negated Sentence:",
                            "max_tokens": 50
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/createCompletionResponse"
                            },
                            "example": {
                              "model": "davinci",
                              "object": "text_completion",
                              "id": "cmpl-4509KAos68kxOqpE2uYGw81j6m7uo",
                              "created": 1637097562,
                              "choices": [
                                {
                                  "index": 0,
                                  "text": "The price for bubblegum decreased on thursday.",
                                  "logprobs": null,
                                  "finish_reason": "stop"
                                }
                              ]
                            }
                          }
                        },
                        "headers": {
                          "apim-request-id": {
                            "description": "Request ID for troubleshooting purposes",
                            "schema": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "default": {
                        "description": "Service unavailable",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/errorResponse"
                            }
                          }
                        },
                        "headers": {
                          "apim-request-id": {
                            "description": "Request ID for troubleshooting purposes",
                            "schema": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/embeddings": {
                  "post": {
                    "summary": "Get a vector representation of a given input that can be easily consumed by machine learning models and algorithms.",
                    "operationId": "embeddings_create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "enum": [
                            "embedding"
                          ],
                          "type": "string",
                          "example": "ada-search-index-v1",
                          "default": "embedding"
                        },
                        "description": "The deployment id of the model which was deployed."
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "enum": [
                            "2024-10-21"
                          ],
                          "example": "2024-10-21",
                          "default": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "application/json": {
                          "schema": {
                            "type": "object",
                            "additionalProperties": true,
                            "properties": {
                              "input": {
                                "description": "Input text to get embeddings for, encoded as a string. To get embeddings for multiple inputs in a single request, pass an array of strings. Each input must not exceed 2048 tokens in length.\nUnless you are embedding code, we suggest replacing newlines (\\n) in your input with a single space, as we have observed inferior results when newlines are present.",
                                "oneOf": [
                                  {
                                    "type": "string",
                                    "default": "",
                                    "example": "This is a test.",
                                    "nullable": true
                                  },
                                  {
                                    "type": "array",
                                    "minItems": 1,
                                    "maxItems": 2048,
                                    "items": {
                                      "type": "string",
                                      "minLength": 1,
                                      "example": "This is a test.",
                                      "nullable": false
                                    }
                                  }
                                ]
                              },
                              "user": {
                                "description": "A unique identifier representing your end-user, which can help monitoring and detecting abuse.",
                                "type": "string",
                                "nullable": false
                              },
                              "input_type": {
                                "description": "input type of embedding search to use",
                                "type": "string",
                                "example": "query"
                              },
                              "encoding_format": {
                                "description": "The format to return the embeddings in. Can be either `float` or `base64`. Defaults to `float`.",
                                "type": "string",
                                "example": "base64",
                                "nullable": true
                              },
                              "dimensions": {
                                "description": "The number of dimensions the resulting output embeddings should have. Only supported in `text-embedding-3` and later models.",
                                "type": "integer",
                                "example": 1,
                                "nullable": true
                              }
                            },
                            "required": [
                              "input"
                            ]
                          },
                          "example": {
                            "input": "APIM love OpenAI"
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "type": "object",
                              "properties": {
                                "object": {
                                  "type": "string"
                                },
                                "model": {
                                  "type": "string"
                                },
                                "data": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "index": {
                                        "type": "integer"
                                      },
                                      "object": {
                                        "type": "string"
                                      },
                                      "embedding": {
                                        "type": "array",
                                        "items": {
                                          "type": "number"
                                        }
                                      }
                                    },
                                    "required": [
                                      "index",
                                      "object",
                                      "embedding"
                                    ]
                                  }
                                },
                                "usage": {
                                  "type": "object",
                                  "properties": {
                                    "prompt_tokens": {
                                      "type": "integer"
                                    },
                                    "total_tokens": {
                                      "type": "integer"
                                    }
                                  },
                                  "required": [
                                    "prompt_tokens",
                                    "total_tokens"
                                  ]
                                }
                              },
                              "required": [
                                "object",
                                "model",
                                "data",
                                "usage"
                              ]
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create a embeddings.": {
                        "$ref": "./examples/embeddings.yaml"
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/chat/completions": {
                  "post": {
                    "summary": "Creates a completion for the chat message",
                    "operationId": "ChatCompletions_Create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "default": "chat",
                          "description": "Deployment id of the model which was deployed.",
                          "enum": [
                            "chat",
                            "gpt-4o"
                          ]
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "enum": [
                            "2024-10-21"
                          ],
                          "type": "string",
                          "default": "2024-10-21",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "application/json": {
                          "schema": {
                            "$ref": "#/components/schemas/createChatCompletionRequest"
                          },
                          "example": {
                            "model": "chat",
                            "messages": [
                              {
                                "role": "system",
                                "content": "You are a helpful assistant that responds in Markdown. Help me with my math homework!"
                              },
                              {
                                "role": "user",
                                "content": "How to calculate the distance between earth and moon?"
                              }
                            ]
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "oneOf": [
                                {
                                  "$ref": "#/components/schemas/createChatCompletionResponse"
                                },
                                {
                                  "$ref": "#/components/schemas/createChatCompletionStreamResponse"
                                }
                              ]
                            }
                          }
                        },
                        "headers": {
                          "apim-request-id": {
                            "description": "Request ID for troubleshooting purposes",
                            "schema": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "default": {
                        "description": "Service unavailable",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/errorResponse"
                            }
                          }
                        },
                        "headers": {
                          "apim-request-id": {
                            "description": "Request ID for troubleshooting purposes",
                            "schema": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create a chat completion.": {
                        "$ref": "./examples/chat_completions.yaml"
                      },
                      "Creates a completion based on Azure Search data and system-assigned managed identity.": {
                        "$ref": "./examples/chat_completions_azure_search_minimum.yaml"
                      },
                      "Creates a completion based on Azure Search vector data, previous assistant message and user-assigned managed identity.": {
                        "$ref": "./examples/chat_completions_azure_search_advanced.yaml"
                      },
                      "Creates a completion for the provided Azure Cosmos DB.": {
                        "$ref": "./examples/chat_completions_cosmos_db.yaml"
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/audio/transcriptions": {
                  "post": {
                    "summary": "Transcribes audio into the input language.",
                    "operationId": "Transcriptions_Create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "whisper",
                          "description": "Deployment id of the whisper model."
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "multipart/form-data": {
                          "schema": {
                            "$ref": "#/components/schemas/createTranscriptionRequest"
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "oneOf": [
                                {
                                  "$ref": "#/components/schemas/audioResponse"
                                },
                                {
                                  "$ref": "#/components/schemas/audioVerboseResponse"
                                }
                              ]
                            }
                          },
                          "text/plain": {
                            "schema": {
                              "type": "string",
                              "description": "Transcribed text in the output format (when response_format was one of text, vtt or srt)."
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create an audio transcription with json response format.": {
                        "$ref": "./examples/audio_transcription_object.yaml"
                      },
                      "Create an audio transcription with text response format.": {
                        "$ref": "./examples/audio_transcription_text.yaml"
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/audio/translations": {
                  "post": {
                    "summary": "Transcribes and translates input audio into English text.",
                    "operationId": "Translations_Create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "whisper",
                          "description": "Deployment id of the whisper model which was deployed."
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "multipart/form-data": {
                          "schema": {
                            "$ref": "#/components/schemas/createTranslationRequest"
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "oneOf": [
                                {
                                  "$ref": "#/components/schemas/audioResponse"
                                },
                                {
                                  "$ref": "#/components/schemas/audioVerboseResponse"
                                }
                              ]
                            }
                          },
                          "text/plain": {
                            "schema": {
                              "type": "string",
                              "description": "Transcribed text in the output format (when response_format was one of text, vtt or srt)."
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create an audio translation with json response format.": {
                        "$ref": "./examples/audio_translation_object.yaml"
                      },
                      "Create an audio translation with text response format.": {
                        "$ref": "./examples/audio_translation_text.yaml"
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/images/generations": {
                  "post": {
                    "summary": "Generates a batch of images from a text caption on a given DALLE model deployment",
                    "operationId": "ImageGenerations_Create",
                    "requestBody": {
                      "required": true,
                      "content": {
                        "application/json": {
                          "schema": {
                            "$ref": "#/components/schemas/imageGenerationsRequest"
                          }
                        }
                      }
                    },
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "dalle-deployment",
                          "description": "Deployment id of the dalle model which was deployed."
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "responses": {
                      "200": {
                        "description": "Ok",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/generateImagesResponse"
                            }
                          }
                        }
                      },
                      "default": {
                        "description": "An error occurred.",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/dalleErrorResponse"
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create an image.": {
                        "$ref": "./examples/image_generation.yaml"
                      }
                    }
                  }
                }
              },
              "components": {
                "schemas": {
                  "errorResponse": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "$ref": "#/components/schemas/error"
                      }
                    }
                  },
                  "errorBase": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "string"
                      },
                      "message": {
                        "type": "string"
                      }
                    }
                  },
                  "error": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/errorBase"
                      }
                    ],
                    "properties": {
                      "param": {
                        "type": "string"
                      },
                      "type": {
                        "type": "string"
                      },
                      "inner_error": {
                        "$ref": "#/components/schemas/innerError"
                      }
                    }
                  },
                  "innerError": {
                    "description": "Inner error with additional details.",
                    "type": "object",
                    "properties": {
                      "code": {
                        "$ref": "#/components/schemas/innerErrorCode"
                      },
                      "content_filter_results": {
                        "$ref": "#/components/schemas/contentFilterPromptResults"
                      }
                    }
                  },
                  "innerErrorCode": {
                    "description": "Error codes for the inner error object.",
                    "enum": [
                      "ResponsibleAIPolicyViolation"
                    ],
                    "type": "string",
                    "x-ms-enum": {
                      "name": "InnerErrorCode",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "ResponsibleAIPolicyViolation",
                          "description": "The prompt violated one of more content filter rules."
                        }
                      ]
                    }
                  },
                  "dalleErrorResponse": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "$ref": "#/components/schemas/dalleError"
                      }
                    }
                  },
                  "dalleError": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/errorBase"
                      }
                    ],
                    "properties": {
                      "param": {
                        "type": "string"
                      },
                      "type": {
                        "type": "string"
                      },
                      "inner_error": {
                        "$ref": "#/components/schemas/dalleInnerError"
                      }
                    }
                  },
                  "dalleInnerError": {
                    "description": "Inner error with additional details.",
                    "type": "object",
                    "properties": {
                      "code": {
                        "$ref": "#/components/schemas/innerErrorCode"
                      },
                      "content_filter_results": {
                        "$ref": "#/components/schemas/dalleFilterResults"
                      },
                      "revised_prompt": {
                        "type": "string",
                        "description": "The prompt that was used to generate the image, if there was any revision to the prompt."
                      }
                    }
                  },
                  "contentFilterResultBase": {
                    "type": "object",
                    "properties": {
                      "filtered": {
                        "type": "boolean"
                      }
                    },
                    "required": [
                      "filtered"
                    ]
                  },
                  "contentFilterSeverityResult": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterResultBase"
                      },
                      {
                        "properties": {
                          "severity": {
                            "type": "string",
                            "enum": [
                              "safe",
                              "low",
                              "medium",
                              "high"
                            ],
                            "x-ms-enum": {
                              "name": "ContentFilterSeverity",
                              "modelAsString": true,
                              "values": [
                                {
                                  "value": "safe",
                                  "description": "General content or related content in generic or non-harmful contexts."
                                },
                                {
                                  "value": "low",
                                  "description": "Harmful content at a low intensity and risk level."
                                },
                                {
                                  "value": "medium",
                                  "description": "Harmful content at a medium intensity and risk level."
                                },
                                {
                                  "value": "high",
                                  "description": "Harmful content at a high intensity and risk level."
                                }
                              ]
                            }
                          }
                        }
                      }
                    ],
                    "required": [
                      "severity",
                      "filtered"
                    ]
                  },
                  "contentFilterDetectedResult": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterResultBase"
                      },
                      {
                        "properties": {
                          "detected": {
                            "type": "boolean"
                          }
                        }
                      }
                    ],
                    "required": [
                      "detected",
                      "filtered"
                    ]
                  },
                  "contentFilterDetectedWithCitationResult": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterDetectedResult"
                      },
                      {
                        "properties": {
                          "citation": {
                            "type": "object",
                            "properties": {
                              "URL": {
                                "type": "string"
                              },
                              "license": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    ],
                    "required": [
                      "detected",
                      "filtered"
                    ]
                  },
                  "contentFilterResultsBase": {
                    "type": "object",
                    "description": "Information about the content filtering results.",
                    "properties": {
                      "sexual": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "violence": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "hate": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "self_harm": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "profanity": {
                        "$ref": "#/components/schemas/contentFilterDetectedResult"
                      },
                      "error": {
                        "$ref": "#/components/schemas/errorBase"
                      }
                    }
                  },
                  "contentFilterPromptResults": {
                    "type": "object",
                    "description": "Information about the content filtering category (hate, sexual, violence, self_harm), if it has been detected, as well as the severity level (very_low, low, medium, high-scale that determines the intensity and risk level of harmful content) and if it has been filtered or not. Information about jailbreak content and profanity, if it has been detected, and if it has been filtered or not. And information about customer block list, if it has been filtered and its id.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterResultsBase"
                      },
                      {
                        "properties": {
                          "jailbreak": {
                            "$ref": "#/components/schemas/contentFilterDetectedResult"
                          }
                        }
                      }
                    ]
                  },
                  "contentFilterChoiceResults": {
                    "type": "object",
                    "description": "Information about the content filtering category (hate, sexual, violence, self_harm), if it has been detected, as well as the severity level (very_low, low, medium, high-scale that determines the intensity and risk level of harmful content) and if it has been filtered or not. Information about third party text and profanity, if it has been detected, and if it has been filtered or not. And information about customer block list, if it has been filtered and its id.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterResultsBase"
                      },
                      {
                        "properties": {
                          "protected_material_text": {
                            "$ref": "#/components/schemas/contentFilterDetectedResult"
                          }
                        }
                      },
                      {
                        "properties": {
                          "protected_material_code": {
                            "$ref": "#/components/schemas/contentFilterDetectedWithCitationResult"
                          }
                        }
                      }
                    ]
                  },
                  "promptFilterResult": {
                    "type": "object",
                    "description": "Content filtering results for a single prompt in the request.",
                    "properties": {
                      "prompt_index": {
                        "type": "integer"
                      },
                      "content_filter_results": {
                        "$ref": "#/components/schemas/contentFilterPromptResults"
                      }
                    }
                  },
                  "promptFilterResults": {
                    "type": "array",
                    "description": "Content filtering results for zero or more prompts in the request. In a streaming request, results for different prompts may arrive at different times or in different orders.",
                    "items": {
                      "$ref": "#/components/schemas/promptFilterResult"
                    }
                  },
                  "dalleContentFilterResults": {
                    "type": "object",
                    "description": "Information about the content filtering results.",
                    "properties": {
                      "sexual": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "violence": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "hate": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "self_harm": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      }
                    }
                  },
                  "dalleFilterResults": {
                    "type": "object",
                    "description": "Information about the content filtering category (hate, sexual, violence, self_harm), if it has been detected, as well as the severity level (very_low, low, medium, high-scale that determines the intensity and risk level of harmful content) and if it has been filtered or not. Information about jailbreak content and profanity, if it has been detected, and if it has been filtered or not. And information about customer block list, if it has been filtered and its id.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/dalleContentFilterResults"
                      },
                      {
                        "properties": {
                          "profanity": {
                            "$ref": "#/components/schemas/contentFilterDetectedResult"
                          },
                          "jailbreak": {
                            "$ref": "#/components/schemas/contentFilterDetectedResult"
                          }
                        }
                      }
                    ]
                  },
                  "chatCompletionsRequestCommon": {
                    "type": "object",
                    "properties": {
                      "temperature": {
                        "description": "What sampling temperature to use, between 0 and 2. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.\nWe generally recommend altering this or `top_p` but not both.",
                        "type": "number",
                        "minimum": 0,
                        "maximum": 2,
                        "default": 1,
                        "example": 1,
                        "nullable": true
                      },
                      "top_p": {
                        "description": "An alternative to sampling with temperature, called nucleus sampling, where the model considers the results of the tokens with top_p probability mass. So 0.1 means only the tokens comprising the top 10% probability mass are considered.\nWe generally recommend altering this or `temperature` but not both.",
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1,
                        "default": 1,
                        "example": 1,
                        "nullable": true
                      },
                      "stream": {
                        "description": "If set, partial message deltas will be sent, like in ChatGPT. Tokens will be sent as data-only server-sent events as they become available, with the stream terminated by a `data: [DONE]` message.",
                        "type": "boolean",
                        "nullable": true,
                        "default": false
                      },
                      "stop": {
                        "description": "Up to 4 sequences where the API will stop generating further tokens.",
                        "oneOf": [
                          {
                            "type": "string",
                            "nullable": true
                          },
                          {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "nullable": false
                            },
                            "minItems": 1,
                            "maxItems": 4,
                            "description": "Array minimum size of 1 and maximum of 4"
                          }
                        ],
                        "default": null
                      },
                      "max_tokens": {
                        "description": "The maximum number of tokens allowed for the generated answer. By default, the number of tokens the model can return will be (4096 - prompt tokens).\n\nThis value is now deprecated in favor of `max_completion_tokens`, and is not compatible with o1 series models.\n",
                        "type": "integer",
                        "default": 4096
                      },
                      "max_completion_tokens": {
                        "description": "An upper bound for the number of tokens that can be generated for a completion, including visible output tokens and reasoning tokens.\n",
                        "type": "integer",
                        "nullable": true
                      },
                      "presence_penalty": {
                        "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on whether they appear in the text so far, increasing the model's likelihood to talk about new topics.",
                        "type": "number",
                        "default": 0,
                        "minimum": -2,
                        "maximum": 2
                      },
                      "frequency_penalty": {
                        "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on their existing frequency in the text so far, decreasing the model's likelihood to repeat the same line verbatim.",
                        "type": "number",
                        "default": 0,
                        "minimum": -2,
                        "maximum": 2
                      },
                      "logit_bias": {
                        "description": "Modify the likelihood of specified tokens appearing in the completion. Accepts a json object that maps tokens (specified by their token ID in the tokenizer) to an associated bias value from -100 to 100. Mathematically, the bias is added to the logits generated by the model prior to sampling. The exact effect will vary per model, but values between -1 and 1 should decrease or increase likelihood of selection; values like -100 or 100 should result in a ban or exclusive selection of the relevant token.",
                        "type": "object",
                        "nullable": true
                      },
                      "user": {
                        "description": "A unique identifier representing your end-user, which can help Azure OpenAI to monitor and detect abuse.",
                        "type": "string",
                        "example": "user-1234",
                        "nullable": false
                      }
                    }
                  },
                  "createCompletionRequest": {
                    "type": "object",
                    "properties": {
                      "prompt": {
                        "description": "The prompt(s) to generate completions for, encoded as a string, array of strings, array of tokens, or array of token arrays.\n\nNote that <|endoftext|> is the document separator that the model sees during training, so if a prompt is not specified the model will generate as if from the beginning of a new document.\n",
                        "default": "<|endoftext|>",
                        "nullable": true,
                        "oneOf": [
                          {
                            "type": "string",
                            "default": "",
                            "example": "This is a test."
                          },
                          {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "default": "",
                              "example": "This is a test."
                            }
                          }
                        ]
                      },
                      "best_of": {
                        "type": "integer",
                        "default": 1,
                        "minimum": 0,
                        "maximum": 20,
                        "nullable": true,
                        "description": "Generates `best_of` completions server-side and returns the \"best\" (the one with the highest log probability per token). Results cannot be streamed.\n\nWhen used with `n`, `best_of` controls the number of candidate completions and `n` specifies how many to return  `best_of` must be greater than `n`.\n\n**Note:** Because this parameter generates many completions, it can quickly consume your token quota. Use carefully and ensure that you have reasonable settings for `max_tokens` and `stop`.\n"
                      },
                      "echo": {
                        "type": "boolean",
                        "default": false,
                        "nullable": true,
                        "description": "Echo back the prompt in addition to the completion\n"
                      },
                      "frequency_penalty": {
                        "type": "number",
                        "default": 0,
                        "minimum": -2,
                        "maximum": 2,
                        "nullable": true,
                        "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on their existing frequency in the text so far, decreasing the model's likelihood to repeat the same line verbatim.\n"
                      },
                      "logit_bias": {
                        "type": "object",
                        "x-oaiTypeLabel": "map",
                        "default": null,
                        "nullable": true,
                        "additionalProperties": {
                          "type": "integer"
                        },
                        "description": "Modify the likelihood of specified tokens appearing in the completion.\n\nAccepts a JSON object that maps tokens (specified by their token ID in the GPT tokenizer) to an associated bias value from -100 to 100. You can use this [tokenizer tool](https://platform.openai.com/tokenizer?view=bpe) to convert text to token IDs. Mathematically, the bias is added to the logits generated by the model prior to sampling. The exact effect will vary per model, but values between -1 and 1 should decrease or increase likelihood of selection; values like -100 or 100 should result in a ban or exclusive selection of the relevant token.\n\nAs an example, you can pass `{\"50256\": -100}` to prevent the <|endoftext|> token from being generated.\n"
                      },
                      "logprobs": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 5,
                        "default": null,
                        "nullable": true,
                        "description": "Include the log probabilities on the `logprobs` most likely output tokens, as well the chosen tokens. For example, if `logprobs` is 5, the API will return a list of the 5 most likely tokens. The API will always return the `logprob` of the sampled token, so there may be up to `logprobs+1` elements in the response.\n\nThe maximum value for `logprobs` is 5.\n"
                      },
                      "max_tokens": {
                        "type": "integer",
                        "minimum": 0,
                        "default": 16,
                        "example": 16,
                        "nullable": true,
                        "description": "The maximum number of [tokens](https://platform.openai.com/tokenizer) that can be generated in the completion.\n\nThe token count of your prompt plus `max_tokens` cannot exceed the model's context length. [Example Python code](https://cookbook.openai.com/examples/how_to_count_tokens_with_tiktoken) for counting tokens.\n"
                      },
                      "n": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 128,
                        "default": 1,
                        "example": 1,
                        "nullable": true,
                        "description": "How many completions to generate for each prompt.\n\n**Note:** Because this parameter generates many completions, it can quickly consume your token quota. Use carefully and ensure that you have reasonable settings for `max_tokens` and `stop`.\n"
                      },
                      "presence_penalty": {
                        "type": "number",
                        "default": 0,
                        "minimum": -2,
                        "maximum": 2,
                        "nullable": true,
                        "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on whether they appear in the text so far, increasing the model's likelihood to talk about new topics.\n"
                      },
                      "seed": {
                        "type": "integer",
                        "minimum": -9223372036854775808,
                        "maximum": 9223372036854775807,
                        "nullable": true,
                        "description": "If specified, our system will make a best effort to sample deterministically, such that repeated requests with the same `seed` and parameters should return the same result.\n\nDeterminism is not guaranteed, and you should refer to the `system_fingerprint` response parameter to monitor changes in the backend.\n"
                      },
                      "stop": {
                        "description": "Up to 4 sequences where the API will stop generating further tokens. The returned text will not contain the stop sequence.\n",
                        "default": null,
                        "nullable": true,
                        "oneOf": [
                          {
                            "type": "string",
                            "default": "<|endoftext|>",
                            "example": "\n",
                            "nullable": true
                          },
                          {
                            "type": "array",
                            "minItems": 1,
                            "maxItems": 4,
                            "items": {
                              "type": "string",
                              "example": "[[\"\\n\"]"
                            }
                          }
                        ]
                      },
                      "stream": {
                        "description": "Whether to stream back partial progress. If set, tokens will be sent as data-only [server-sent events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format) as they become available, with the stream terminated by a `data: [DONE]` message. [Example Python code](https://cookbook.openai.com/examples/how_to_stream_completions).\n",
                        "type": "boolean",
                        "nullable": true,
                        "default": false
                      },
                      "suffix": {
                        "description": "The suffix that comes after a completion of inserted text.\n\nThis parameter is only supported for `gpt-3.5-turbo-instruct`.\n",
                        "default": null,
                        "nullable": true,
                        "type": "string",
                        "example": "test."
                      },
                      "stream_options": {
                        "$ref": "#/components/schemas/chatCompletionStreamOptions"
                      },
                      "temperature": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 2,
                        "default": 1,
                        "example": 1,
                        "nullable": true,
                        "description": "What sampling temperature to use, between 0 and 2. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.\n\nWe generally recommend altering this or `top_p` but not both.\n"
                      },
                      "top_p": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1,
                        "default": 1,
                        "example": 1,
                        "nullable": true,
                        "description": "An alternative to sampling with temperature, called nucleus sampling, where the model considers the results of the tokens with top_p probability mass. So 0.1 means only the tokens comprising the top 10% probability mass are considered.\n\nWe generally recommend altering this or `temperature` but not both.\n"
                      },
                      "user": {
                        "type": "string",
                        "example": "user-1234",
                        "description": "A unique identifier representing your end-user, which can help to monitor and detect abuse.\n"
                      }
                    },
                    "required": [
                      "prompt"
                    ]
                  },
                  "createCompletionResponse": {
                    "type": "object",
                    "description": "Represents a completion response from the API. Note: both the streamed and non-streamed response objects share the same shape (unlike the chat endpoint).\n",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "A unique identifier for the completion."
                      },
                      "choices": {
                        "type": "array",
                        "description": "The list of completion choices the model generated for the input prompt.",
                        "items": {
                          "type": "object",
                          "required": [
                            "finish_reason",
                            "index",
                            "logprobs",
                            "text"
                          ],
                          "properties": {
                            "finish_reason": {
                              "type": "string",
                              "description": "The reason the model stopped generating tokens. This will be `stop` if the model hit a natural stop point or a provided stop sequence,\n`length` if the maximum number of tokens specified in the request was reached,\nor `content_filter` if content was omitted due to a flag from our content filters.\n",
                              "enum": [
                                "stop",
                                "length",
                                "content_filter"
                              ]
                            },
                            "index": {
                              "type": "integer"
                            },
                            "logprobs": {
                              "type": "object",
                              "nullable": true,
                              "properties": {
                                "text_offset": {
                                  "type": "array",
                                  "items": {
                                    "type": "integer"
                                  }
                                },
                                "token_logprobs": {
                                  "type": "array",
                                  "items": {
                                    "type": "number"
                                  }
                                },
                                "tokens": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "top_logprobs": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "additionalProperties": {
                                      "type": "number"
                                    }
                                  }
                                }
                              }
                            },
                            "text": {
                              "type": "string"
                            },
                            "content_filter_results": {
                              "$ref": "#/components/schemas/contentFilterChoiceResults"
                            }
                          }
                        }
                      },
                      "created": {
                        "type": "integer",
                        "description": "The Unix timestamp (in seconds) of when the completion was created."
                      },
                      "model": {
                        "type": "string",
                        "description": "The model used for completion."
                      },
                      "prompt_filter_results": {
                        "$ref": "#/components/schemas/promptFilterResults"
                      },
                      "system_fingerprint": {
                        "type": "string",
                        "description": "This fingerprint represents the backend configuration that the model runs with.\n\nCan be used in conjunction with the `seed` request parameter to understand when backend changes have been made that might impact determinism.\n"
                      },
                      "object": {
                        "type": "string",
                        "description": "The object type, which is always \"text_completion\"",
                        "enum": [
                          "text_completion"
                        ]
                      },
                      "usage": {
                        "$ref": "#/components/schemas/completionUsage"
                      }
                    },
                    "required": [
                      "id",
                      "object",
                      "created",
                      "model",
                      "choices"
                    ]
                  },
                  "createChatCompletionRequest": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionsRequestCommon"
                      },
                      {
                        "properties": {
                          "messages": {
                            "description": "A list of messages comprising the conversation so far. [Example Python code](https://github.com/openai/openai-cookbook/blob/main/examples/How_to_format_inputs_to_ChatGPT_models.ipynb).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestMessage"
                            }
                          },
                          "data_sources": {
                            "type": "array",
                            "description": "  The configuration entries for Azure OpenAI chat extensions that use them.\n  This additional specification is only compatible with Azure OpenAI.",
                            "items": {
                              "$ref": "#/components/schemas/azureChatExtensionConfiguration"
                            }
                          },
                          "frequency_penalty": {
                            "type": "number",
                            "default": 0,
                            "minimum": -2,
                            "maximum": 2,
                            "nullable": true,
                            "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on their existing frequency in the text so far, decreasing the model's likelihood to repeat the same line verbatim.\n"
                          },
                          "logit_bias": {
                            "type": "object",
                            "default": null,
                            "nullable": true,
                            "additionalProperties": {
                              "type": "integer"
                            },
                            "description": "Modify the likelihood of specified tokens appearing in the completion.\n\nAccepts a JSON object that maps tokens (specified by their token ID in the tokenizer) to an associated bias value from -100 to 100. Mathematically, the bias is added to the logits generated by the model prior to sampling. The exact effect will vary per model, but values between -1 and 1 should decrease or increase likelihood of selection; values like -100 or 100 should result in a ban or exclusive selection of the relevant token.\n"
                          },
                          "logprobs": {
                            "description": "Whether to return log probabilities of the output tokens or not. If true, returns the log probabilities of each output token returned in the `content` of `message`.",
                            "type": "boolean",
                            "default": false,
                            "nullable": true
                          },
                          "top_logprobs": {
                            "description": "An integer between 0 and 20 specifying the number of most likely tokens to return at each token position, each with an associated log probability. `logprobs` must be set to `true` if this parameter is used.",
                            "type": "integer",
                            "minimum": 0,
                            "maximum": 20,
                            "nullable": true
                          },
                          "max_tokens": {
                            "description": "The maximum number of [tokens](/tokenizer) that can be generated in the chat completion.\n\nThe total length of input tokens and generated tokens is limited by the model's context length. [Example Python code](https://cookbook.openai.com/examples/how_to_count_tokens_with_tiktoken) for counting tokens.\n",
                            "type": "integer",
                            "nullable": true
                          },
                          "n": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 128,
                            "default": 1,
                            "example": 1,
                            "nullable": true,
                            "description": "How many chat completion choices to generate for each input message. Note that you will be charged based on the number of generated tokens across all of the choices. Keep `n` as `1` to minimize costs."
                          },
                          "parallel_tool_calls": {
                            "$ref": "#/components/schemas/ParallelToolCalls"
                          },
                          "presence_penalty": {
                            "type": "number",
                            "default": 0,
                            "minimum": -2,
                            "maximum": 2,
                            "nullable": true,
                            "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on whether they appear in the text so far, increasing the model's likelihood to talk about new topics.\n"
                          },
                          "response_format": {
                            "description": "An object specifying the format that the model must output. Compatible with [GPT-4o](https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-4-and-gpt-4-turbo-models), [GPT-4o mini](https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-4-and-gpt-4-turbo-models), [GPT-4 Turbo](https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-4-and-gpt-4-turbo-models) and all [GPT-3.5](https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-35) Turbo models newer than `gpt-3.5-turbo-1106`.\n\nSetting to `{ \"type\": \"json_schema\", \"json_schema\": {...} }` enables Structured Outputs which guarantees the model will match your supplied JSON schema.\n\nSetting to `{ \"type\": \"json_object\" }` enables JSON mode, which guarantees the message the model generates is valid JSON.\n\n**Important:** when using JSON mode, you **must** also instruct the model to produce JSON yourself via a system or user message. Without this, the model may generate an unending stream of whitespace until the generation reaches the token limit, resulting in a long-running and seemingly \"stuck\" request. Also note that the message content may be partially cut off if `finish_reason=\"length\"`, which indicates the generation exceeded `max_tokens` or the conversation exceeded the max context length.\n",
                            "oneOf": [
                              {
                                "$ref": "#/components/schemas/ResponseFormatText"
                              },
                              {
                                "$ref": "#/components/schemas/ResponseFormatJsonObject"
                              },
                              {
                                "$ref": "#/components/schemas/ResponseFormatJsonSchema"
                              }
                            ],
                            "x-oaiExpandable": true
                          },
                          "seed": {
                            "type": "integer",
                            "minimum": -9223372036854775808,
                            "maximum": 9223372036854775807,
                            "nullable": true,
                            "description": "This feature is in Beta.\nIf specified, our system will make a best effort to sample deterministically, such that repeated requests with the same `seed` and parameters should return the same result.\nDeterminism is not guaranteed, and you should refer to the `system_fingerprint` response parameter to monitor changes in the backend.\n"
                          },
                          "stop": {
                            "description": "Up to 4 sequences where the API will stop generating further tokens.\n",
                            "default": null,
                            "oneOf": [
                              {
                                "type": "string",
                                "nullable": true
                              },
                              {
                                "type": "array",
                                "minItems": 1,
                                "maxItems": 4,
                                "items": {
                                  "type": "string"
                                }
                              }
                            ]
                          },
                          "stream": {
                            "description": "If set, partial message deltas will be sent, like in ChatGPT. Tokens will be sent as data-only [server-sent events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format) as they become available, with the stream terminated by a `data: [DONE]` message. [Example Python code](https://cookbook.openai.com/examples/how_to_stream_completions).\n",
                            "type": "boolean",
                            "nullable": true,
                            "default": false
                          },
                          "stream_options": {
                            "$ref": "#/components/schemas/chatCompletionStreamOptions"
                          },
                          "temperature": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 2,
                            "default": 1,
                            "example": 1,
                            "nullable": true,
                            "description": "What sampling temperature to use, between 0 and 2. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.\n\nWe generally recommend altering this or `top_p` but not both.\n"
                          },
                          "top_p": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "default": 1,
                            "example": 1,
                            "nullable": true,
                            "description": "An alternative to sampling with temperature, called nucleus sampling, where the model considers the results of the tokens with top_p probability mass. So 0.1 means only the tokens comprising the top 10% probability mass are considered.\n\nWe generally recommend altering this or `temperature` but not both.\n"
                          },
                          "tools": {
                            "type": "array",
                            "description": "A list of tools the model may call. Currently, only functions are supported as a tool. Use this to provide a list of functions the model may generate JSON inputs for. A max of 128 functions are supported.\n",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionTool"
                            }
                          },
                          "tool_choice": {
                            "$ref": "#/components/schemas/chatCompletionToolChoiceOption"
                          },
                          "function_call": {
                            "deprecated": true,
                            "description": "Deprecated in favor of `tool_choice`.\n\nControls which (if any) function is called by the model.\n`none` means the model will not call a function and instead generates a message.\n`auto` means the model can pick between generating a message or calling a function.\nSpecifying a particular function via `{\"name\": \"my_function\"}` forces the model to call that function.\n\n`none` is the default when no functions are present. `auto` is the default if functions are present.\n",
                            "oneOf": [
                              {
                                "type": "string",
                                "description": "`none` means the model will not call a function and instead generates a message. `auto` means the model can pick between generating a message or calling a function.\n",
                                "enum": [
                                  "none",
                                  "auto"
                                ]
                              },
                              {
                                "$ref": "#/components/schemas/chatCompletionFunctionCallOption"
                              }
                            ],
                            "x-oaiExpandable": true
                          },
                          "functions": {
                            "deprecated": true,
                            "description": "Deprecated in favor of `tools`.\n\nA list of functions the model may generate JSON inputs for.\n",
                            "type": "array",
                            "minItems": 1,
                            "maxItems": 128,
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionFunctions"
                            }
                          },
                          "user": {
                            "type": "string",
                            "example": "user-1234",
                            "description": "A unique identifier representing your end-user, which can help to monitor and detect abuse.\n"
                          }
                        },
                        "required": [
                          "messages"
                        ]
                      }
                    ]
                  },
                  "chatCompletionFunctions": {
                    "type": "object",
                    "deprecated": true,
                    "properties": {
                      "description": {
                        "type": "string",
                        "description": "A description of what the function does, used by the model to choose when and how to call the function."
                      },
                      "name": {
                        "type": "string",
                        "description": "The name of the function to be called. Must be a-z, A-Z, 0-9, or contain underscores and dashes, with a maximum length of 64."
                      },
                      "parameters": {
                        "$ref": "#/components/schemas/FunctionParameters"
                      }
                    },
                    "required": [
                      "name"
                    ]
                  },
                  "chatCompletionFunctionCallOption": {
                    "type": "object",
                    "description": "Specifying a particular function via `{\"name\": \"my_function\"}` forces the model to call that function.\n",
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "The name of the function to call."
                      }
                    },
                    "required": [
                      "name"
                    ]
                  },
                  "chatCompletionRequestMessage": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestSystemMessage"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestUserMessage"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestAssistantMessage"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestToolMessage"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestFunctionMessage"
                      }
                    ]
                  },
                  "chatCompletionRequestSystemMessage": {
                    "type": "object",
                    "title": "System message",
                    "properties": {
                      "content": {
                        "description": "The contents of the system message.",
                        "oneOf": [
                          {
                            "type": "string",
                            "description": "The contents of the system message.",
                            "title": "Text content"
                          },
                          {
                            "type": "array",
                            "description": "An array of content parts with a defined type. For system messages, only type `text` is supported.",
                            "title": "Array of content parts",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestSystemMessageContentPart"
                            },
                            "minItems": 1
                          }
                        ]
                      },
                      "role": {
                        "type": "string",
                        "enum": [
                          "system"
                        ],
                        "description": "The role of the messages author, in this case `system`."
                      },
                      "name": {
                        "type": "string",
                        "description": "An optional name for the participant. Provides the model information to differentiate between participants of the same role."
                      }
                    },
                    "required": [
                      "content",
                      "role"
                    ]
                  },
                  "chatCompletionRequestUserMessage": {
                    "type": "object",
                    "title": "User message",
                    "properties": {
                      "content": {
                        "description": "The contents of the user message.\n",
                        "oneOf": [
                          {
                            "type": "string",
                            "description": "The text contents of the message.",
                            "title": "Text content"
                          },
                          {
                            "type": "array",
                            "description": "An array of content parts with a defined type, each can be of type `text` or `image_url` when passing in images. You can pass multiple images by adding multiple `image_url` content parts. Image input is only supported when using the `gpt-4o` model.",
                            "title": "Array of content parts",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestUserMessageContentPart"
                            },
                            "minItems": 1
                          }
                        ],
                        "x-oaiExpandable": true
                      },
                      "role": {
                        "type": "string",
                        "enum": [
                          "user"
                        ],
                        "description": "The role of the messages author, in this case `user`."
                      },
                      "name": {
                        "type": "string",
                        "description": "An optional name for the participant. Provides the model information to differentiate between participants of the same role."
                      }
                    },
                    "required": [
                      "content",
                      "role"
                    ]
                  },
                  "chatCompletionRequestAssistantMessage": {
                    "type": "object",
                    "title": "Assistant message",
                    "properties": {
                      "content": {
                        "nullable": true,
                        "oneOf": [
                          {
                            "type": "string",
                            "description": "The contents of the assistant message.",
                            "title": "Text content"
                          },
                          {
                            "type": "array",
                            "description": "An array of content parts with a defined type. Can be one or more of type `text`, or exactly one of type `refusal`.",
                            "title": "Array of content parts",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestAssistantMessageContentPart"
                            },
                            "minItems": 1
                          }
                        ],
                        "description": "The contents of the assistant message. Required unless `tool_calls` or `function_call` is specified.\n"
                      },
                      "refusal": {
                        "nullable": true,
                        "type": "string",
                        "description": "The refusal message by the assistant."
                      },
                      "role": {
                        "type": "string",
                        "enum": [
                          "assistant"
                        ],
                        "description": "The role of the messages author, in this case `assistant`."
                      },
                      "name": {
                        "type": "string",
                        "description": "An optional name for the participant. Provides the model information to differentiate between participants of the same role."
                      },
                      "tool_calls": {
                        "$ref": "#/components/schemas/chatCompletionMessageToolCalls"
                      },
                      "function_call": {
                        "type": "object",
                        "deprecated": true,
                        "description": "Deprecated and replaced by `tool_calls`. The name and arguments of a function that should be called, as generated by the model.",
                        "nullable": true,
                        "properties": {
                          "arguments": {
                            "type": "string",
                            "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                          },
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          }
                        },
                        "required": [
                          "arguments",
                          "name"
                        ]
                      }
                    },
                    "required": [
                      "role"
                    ]
                  },
                  "chatCompletionRequestToolMessage": {
                    "type": "object",
                    "title": "Tool message",
                    "properties": {
                      "role": {
                        "type": "string",
                        "enum": [
                          "tool"
                        ],
                        "description": "The role of the messages author, in this case `tool`."
                      },
                      "content": {
                        "oneOf": [
                          {
                            "type": "string",
                            "description": "The contents of the tool message.",
                            "title": "Text content"
                          },
                          {
                            "type": "array",
                            "description": "An array of content parts with a defined type. For tool messages, only type `text` is supported.",
                            "title": "Array of content parts",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestToolMessageContentPart"
                            },
                            "minItems": 1
                          }
                        ],
                        "description": "The contents of the tool message."
                      },
                      "tool_call_id": {
                        "type": "string",
                        "description": "Tool call that this message is responding to."
                      }
                    },
                    "required": [
                      "role",
                      "content",
                      "tool_call_id"
                    ]
                  },
                  "chatCompletionRequestFunctionMessage": {
                    "type": "object",
                    "title": "Function message",
                    "deprecated": true,
                    "properties": {
                      "role": {
                        "type": "string",
                        "enum": [
                          "function"
                        ],
                        "description": "The role of the messages author, in this case `function`."
                      },
                      "content": {
                        "nullable": true,
                        "type": "string",
                        "description": "The contents of the function message."
                      },
                      "name": {
                        "type": "string",
                        "description": "The name of the function to call."
                      }
                    },
                    "required": [
                      "role",
                      "content",
                      "name"
                    ]
                  },
                  "chatCompletionRequestSystemMessageContentPart": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartText"
                      }
                    ]
                  },
                  "chatCompletionRequestUserMessageContentPart": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartText"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartImage"
                      }
                    ]
                  },
                  "chatCompletionRequestAssistantMessageContentPart": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartText"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartRefusal"
                      }
                    ]
                  },
                  "chatCompletionRequestToolMessageContentPart": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartText"
                      }
                    ]
                  },
                  "chatCompletionRequestMessageContentPartText": {
                    "type": "object",
                    "title": "Text content part",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "text"
                        ],
                        "description": "The type of the content part."
                      },
                      "text": {
                        "type": "string",
                        "description": "The text content."
                      }
                    },
                    "required": [
                      "type",
                      "text"
                    ]
                  },
                  "chatCompletionRequestMessageContentPartImage": {
                    "type": "object",
                    "title": "Image content part",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "image_url"
                        ],
                        "description": "The type of the content part."
                      },
                      "image_url": {
                        "type": "object",
                        "properties": {
                          "url": {
                            "type": "string",
                            "description": "Either a URL of the image or the base64 encoded image data.",
                            "format": "uri"
                          },
                          "detail": {
                            "type": "string",
                            "description": "Specifies the detail level of the image. Learn more in the [Vision guide](https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/gpt-with-vision?tabs=rest%2Csystem-assigned%2Cresource#detail-parameter-settings-in-image-processing-low-high-auto).",
                            "enum": [
                              "auto",
                              "low",
                              "high"
                            ],
                            "default": "auto"
                          }
                        },
                        "required": [
                          "url"
                        ]
                      }
                    },
                    "required": [
                      "type",
                      "image_url"
                    ]
                  },
                  "chatCompletionRequestMessageContentPartRefusal": {
                    "type": "object",
                    "title": "Refusal content part",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "refusal"
                        ],
                        "description": "The type of the content part."
                      },
                      "refusal": {
                        "type": "string",
                        "description": "The refusal message generated by the model."
                      }
                    },
                    "required": [
                      "type",
                      "refusal"
                    ]
                  },
                  "azureChatExtensionConfiguration": {
                    "required": [
                      "type"
                    ],
                    "type": "object",
                    "properties": {
                      "type": {
                        "$ref": "#/components/schemas/azureChatExtensionType"
                      }
                    },
                    "description": "  A representation of configuration data for a single Azure OpenAI chat extension. This will be used by a chat\n  completions request that should use Azure OpenAI chat extensions to augment the response behavior.\n  The use of this configuration is compatible only with Azure OpenAI.",
                    "discriminator": {
                      "propertyName": "type",
                      "mapping": {
                        "azure_search": "#/components/schemas/azureSearchChatExtensionConfiguration",
                        "azure_cosmos_db": "#/components/schemas/azureCosmosDBChatExtensionConfiguration"
                      }
                    }
                  },
                  "azureChatExtensionType": {
                    "type": "string",
                    "description": "  A representation of configuration data for a single Azure OpenAI chat extension. This will be used by a chat\n  completions request that should use Azure OpenAI chat extensions to augment the response behavior.\n  The use of this configuration is compatible only with Azure OpenAI.",
                    "enum": [
                      "azure_search",
                      "azure_cosmos_db"
                    ],
                    "x-ms-enum": {
                      "name": "AzureChatExtensionType",
                      "modelAsString": true,
                      "values": [
                        {
                          "name": "azureSearch",
                          "value": "azure_search",
                          "description": "Represents the use of Azure Search as an Azure OpenAI chat extension."
                        },
                        {
                          "name": "azureCosmosDB",
                          "value": "azure_cosmos_db",
                          "description": "Represents the use of Azure Cosmos DB as an Azure OpenAI chat extension."
                        }
                      ]
                    }
                  },
                  "azureSearchChatExtensionConfiguration": {
                    "required": [
                      "parameters"
                    ],
                    "description": "A specific representation of configurable options for Azure Search when using it as an Azure OpenAI chat\nextension.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/azureChatExtensionConfiguration"
                      },
                      {
                        "properties": {
                          "parameters": {
                            "$ref": "#/components/schemas/azureSearchChatExtensionParameters"
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "azure_search"
                  },
                  "azureSearchChatExtensionParameters": {
                    "required": [
                      "authentication",
                      "endpoint",
                      "index_name"
                    ],
                    "type": "object",
                    "properties": {
                      "authentication": {
                        "oneOf": [
                          {
                            "$ref": "#/components/schemas/onYourDataApiKeyAuthenticationOptions"
                          },
                          {
                            "$ref": "#/components/schemas/onYourDataSystemAssignedManagedIdentityAuthenticationOptions"
                          },
                          {
                            "$ref": "#/components/schemas/onYourDataUserAssignedManagedIdentityAuthenticationOptions"
                          }
                        ]
                      },
                      "top_n_documents": {
                        "type": "integer",
                        "description": "The configured top number of documents to feature for the configured query.",
                        "format": "int32"
                      },
                      "in_scope": {
                        "type": "boolean",
                        "description": "Whether queries should be restricted to use of indexed data."
                      },
                      "strictness": {
                        "maximum": 5,
                        "minimum": 1,
                        "type": "integer",
                        "description": "The configured strictness of the search relevance filtering. The higher of strictness, the higher of the precision but lower recall of the answer.",
                        "format": "int32"
                      },
                      "role_information": {
                        "type": "string",
                        "description": "Give the model instructions about how it should behave and any context it should reference when generating a response. You can describe the assistant's personality and tell it how to format responses. There's a 100 token limit for it, and it counts against the overall token limit."
                      },
                      "endpoint": {
                        "type": "string",
                        "description": "The absolute endpoint path for the Azure Search resource to use.",
                        "format": "uri"
                      },
                      "index_name": {
                        "type": "string",
                        "description": "The name of the index to use as available in the referenced Azure Search resource."
                      },
                      "fields_mapping": {
                        "$ref": "#/components/schemas/azureSearchIndexFieldMappingOptions"
                      },
                      "query_type": {
                        "$ref": "#/components/schemas/azureSearchQueryType"
                      },
                      "semantic_configuration": {
                        "type": "string",
                        "description": "The additional semantic configuration for the query."
                      },
                      "filter": {
                        "type": "string",
                        "description": "Search filter."
                      },
                      "embedding_dependency": {
                        "oneOf": [
                          {
                            "$ref": "#/components/schemas/onYourDataEndpointVectorizationSource"
                          },
                          {
                            "$ref": "#/components/schemas/onYourDataDeploymentNameVectorizationSource"
                          }
                        ]
                      }
                    },
                    "description": "Parameters for Azure Search when used as an Azure OpenAI chat extension."
                  },
                  "azureSearchIndexFieldMappingOptions": {
                    "type": "object",
                    "properties": {
                      "title_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a title."
                      },
                      "url_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a URL."
                      },
                      "filepath_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a filepath."
                      },
                      "content_fields": {
                        "type": "array",
                        "description": "The names of index fields that should be treated as content.",
                        "items": {
                          "type": "string"
                        }
                      },
                      "content_fields_separator": {
                        "type": "string",
                        "description": "The separator pattern that content fields should use."
                      },
                      "vector_fields": {
                        "type": "array",
                        "description": "The names of fields that represent vector data.",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "description": "Optional settings to control how fields are processed when using a configured Azure Search resource."
                  },
                  "azureSearchQueryType": {
                    "type": "string",
                    "description": "The type of Azure Search retrieval query that should be executed when using it as an Azure OpenAI chat extension.",
                    "enum": [
                      "simple",
                      "semantic",
                      "vector",
                      "vector_simple_hybrid",
                      "vector_semantic_hybrid"
                    ],
                    "x-ms-enum": {
                      "name": "AzureSearchQueryType",
                      "modelAsString": true,
                      "values": [
                        {
                          "name": "simple",
                          "value": "simple",
                          "description": "Represents the default, simple query parser."
                        },
                        {
                          "name": "semantic",
                          "value": "semantic",
                          "description": "Represents the semantic query parser for advanced semantic modeling."
                        },
                        {
                          "name": "vector",
                          "value": "vector",
                          "description": "Represents vector search over computed data."
                        },
                        {
                          "name": "vectorSimpleHybrid",
                          "value": "vector_simple_hybrid",
                          "description": "Represents a combination of the simple query strategy with vector data."
                        },
                        {
                          "name": "vectorSemanticHybrid",
                          "value": "vector_semantic_hybrid",
                          "description": "Represents a combination of semantic search and vector data querying."
                        }
                      ]
                    }
                  },
                  "azureCosmosDBChatExtensionConfiguration": {
                    "required": [
                      "parameters"
                    ],
                    "description": "A specific representation of configurable options for Azure Cosmos DB when using it as an Azure OpenAI chat\nextension.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/azureChatExtensionConfiguration"
                      },
                      {
                        "properties": {
                          "parameters": {
                            "$ref": "#/components/schemas/azureCosmosDBChatExtensionParameters"
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "azure_cosmos_db"
                  },
                  "azureCosmosDBChatExtensionParameters": {
                    "required": [
                      "authentication",
                      "container_name",
                      "database_name",
                      "embedding_dependency",
                      "fields_mapping",
                      "index_name"
                    ],
                    "type": "object",
                    "properties": {
                      "authentication": {
                        "$ref": "#/components/schemas/onYourDataConnectionStringAuthenticationOptions"
                      },
                      "top_n_documents": {
                        "type": "integer",
                        "description": "The configured top number of documents to feature for the configured query.",
                        "format": "int32"
                      },
                      "in_scope": {
                        "type": "boolean",
                        "description": "Whether queries should be restricted to use of indexed data."
                      },
                      "strictness": {
                        "maximum": 5,
                        "minimum": 1,
                        "type": "integer",
                        "description": "The configured strictness of the search relevance filtering. The higher of strictness, the higher of the precision but lower recall of the answer.",
                        "format": "int32"
                      },
                      "role_information": {
                        "type": "string",
                        "description": "Give the model instructions about how it should behave and any context it should reference when generating a response. You can describe the assistant's personality and tell it how to format responses. There's a 100 token limit for it, and it counts against the overall token limit."
                      },
                      "database_name": {
                        "type": "string",
                        "description": "The MongoDB vCore database name to use with Azure Cosmos DB."
                      },
                      "container_name": {
                        "type": "string",
                        "description": "The name of the Azure Cosmos DB resource container."
                      },
                      "index_name": {
                        "type": "string",
                        "description": "The MongoDB vCore index name to use with Azure Cosmos DB."
                      },
                      "fields_mapping": {
                        "$ref": "#/components/schemas/azureCosmosDBFieldMappingOptions"
                      },
                      "embedding_dependency": {
                        "oneOf": [
                          {
                            "$ref": "#/components/schemas/onYourDataEndpointVectorizationSource"
                          },
                          {
                            "$ref": "#/components/schemas/onYourDataDeploymentNameVectorizationSource"
                          }
                        ]
                      }
                    },
                    "description": "Parameters to use when configuring Azure OpenAI On Your Data chat extensions when using Azure Cosmos DB for\nMongoDB vCore."
                  },
                  "azureCosmosDBFieldMappingOptions": {
                    "required": [
                      "content_fields",
                      "vector_fields"
                    ],
                    "type": "object",
                    "properties": {
                      "title_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a title."
                      },
                      "url_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a URL."
                      },
                      "filepath_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a filepath."
                      },
                      "content_fields": {
                        "type": "array",
                        "description": "The names of index fields that should be treated as content.",
                        "items": {
                          "type": "string"
                        }
                      },
                      "content_fields_separator": {
                        "type": "string",
                        "description": "The separator pattern that content fields should use."
                      },
                      "vector_fields": {
                        "type": "array",
                        "description": "The names of fields that represent vector data.",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "description": "Optional settings to control how fields are processed when using a configured Azure Cosmos DB resource."
                  },
                  "onYourDataAuthenticationOptions": {
                    "required": [
                      "type"
                    ],
                    "type": "object",
                    "properties": {
                      "type": {
                        "$ref": "#/components/schemas/onYourDataAuthenticationType"
                      }
                    },
                    "description": "The authentication options for Azure OpenAI On Your Data.",
                    "discriminator": {
                      "propertyName": "type",
                      "mapping": {
                        "api_key": "#/components/schemas/onYourDataApiKeyAuthenticationOptions",
                        "connection_string": "#/components/schemas/onYourDataConnectionStringAuthenticationOptions",
                        "system_assigned_managed_identity": "#/components/schemas/onYourDataSystemAssignedManagedIdentityAuthenticationOptions",
                        "user_assigned_managed_identity": "#/components/schemas/onYourDataUserAssignedManagedIdentityAuthenticationOptions"
                      }
                    }
                  },
                  "onYourDataAuthenticationType": {
                    "type": "string",
                    "description": "The authentication types supported with Azure OpenAI On Your Data.",
                    "enum": [
                      "api_key",
                      "connection_string",
                      "system_assigned_managed_identity",
                      "user_assigned_managed_identity"
                    ],
                    "x-ms-enum": {
                      "name": "OnYourDataAuthenticationType",
                      "modelAsString": true,
                      "values": [
                        {
                          "name": "apiKey",
                          "value": "api_key",
                          "description": "Authentication via API key."
                        },
                        {
                          "name": "connectionString",
                          "value": "connection_string",
                          "description": "Authentication via connection string."
                        },
                        {
                          "name": "systemAssignedManagedIdentity",
                          "value": "system_assigned_managed_identity",
                          "description": "Authentication via system-assigned managed identity."
                        },
                        {
                          "name": "userAssignedManagedIdentity",
                          "value": "user_assigned_managed_identity",
                          "description": "Authentication via user-assigned managed identity."
                        }
                      ]
                    }
                  },
                  "onYourDataApiKeyAuthenticationOptions": {
                    "required": [
                      "key"
                    ],
                    "description": "The authentication options for Azure OpenAI On Your Data when using an API key.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataAuthenticationOptions"
                      },
                      {
                        "properties": {
                          "key": {
                            "type": "string",
                            "description": "The API key to use for authentication."
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "api_key"
                  },
                  "onYourDataConnectionStringAuthenticationOptions": {
                    "required": [
                      "connection_string"
                    ],
                    "description": "The authentication options for Azure OpenAI On Your Data when using a connection string.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataAuthenticationOptions"
                      },
                      {
                        "properties": {
                          "connection_string": {
                            "type": "string",
                            "description": "The connection string to use for authentication."
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "connection_string"
                  },
                  "onYourDataSystemAssignedManagedIdentityAuthenticationOptions": {
                    "description": "The authentication options for Azure OpenAI On Your Data when using a system-assigned managed identity.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataAuthenticationOptions"
                      }
                    ],
                    "x-ms-discriminator-value": "system_assigned_managed_identity"
                  },
                  "onYourDataUserAssignedManagedIdentityAuthenticationOptions": {
                    "required": [
                      "managed_identity_resource_id"
                    ],
                    "description": "The authentication options for Azure OpenAI On Your Data when using a user-assigned managed identity.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataAuthenticationOptions"
                      },
                      {
                        "properties": {
                          "managed_identity_resource_id": {
                            "type": "string",
                            "description": "The resource ID of the user-assigned managed identity to use for authentication."
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "user_assigned_managed_identity"
                  },
                  "onYourDataVectorizationSource": {
                    "required": [
                      "type"
                    ],
                    "type": "object",
                    "properties": {
                      "type": {
                        "$ref": "#/components/schemas/onYourDataVectorizationSourceType"
                      }
                    },
                    "description": "An abstract representation of a vectorization source for Azure OpenAI On Your Data with vector search.",
                    "discriminator": {
                      "propertyName": "type",
                      "mapping": {
                        "endpoint": "#/components/schemas/onYourDataEndpointVectorizationSource",
                        "deployment_name": "#/components/schemas/onYourDataDeploymentNameVectorizationSource"
                      }
                    }
                  },
                  "onYourDataVectorizationSourceType": {
                    "type": "string",
                    "description": "Represents the available sources Azure OpenAI On Your Data can use to configure vectorization of data for use with\nvector search.",
                    "enum": [
                      "endpoint",
                      "deployment_name"
                    ],
                    "x-ms-enum": {
                      "name": "OnYourDataVectorizationSourceType",
                      "modelAsString": true,
                      "values": [
                        {
                          "name": "endpoint",
                          "value": "endpoint",
                          "description": "Represents vectorization performed by public service calls to an Azure OpenAI embedding model."
                        },
                        {
                          "name": "deploymentName",
                          "value": "deployment_name",
                          "description": "Represents an Ada model deployment name to use. This model deployment must be in the same Azure OpenAI resource, but\nOn Your Data will use this model deployment via an internal call rather than a public one, which enables vector\nsearch even in private networks."
                        }
                      ]
                    }
                  },
                  "onYourDataDeploymentNameVectorizationSource": {
                    "required": [
                      "deployment_name"
                    ],
                    "description": "The details of a a vectorization source, used by Azure OpenAI On Your Data when applying vector search, that is based\non an internal embeddings model deployment name in the same Azure OpenAI resource.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataVectorizationSource"
                      },
                      {
                        "properties": {
                          "deployment_name": {
                            "type": "string",
                            "description": "Specifies the name of the model deployment to use for vectorization. This model deployment must be in the same Azure OpenAI resource, but On Your Data will use this model deployment via an internal call rather than a public one, which enables vector search even in private networks."
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "deployment_name"
                  },
                  "onYourDataEndpointVectorizationSource": {
                    "required": [
                      "authentication",
                      "endpoint"
                    ],
                    "description": "The details of a a vectorization source, used by Azure OpenAI On Your Data when applying vector search, that is based\non a public Azure OpenAI endpoint call for embeddings.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataVectorizationSource"
                      },
                      {
                        "properties": {
                          "authentication": {
                            "$ref": "#/components/schemas/onYourDataApiKeyAuthenticationOptions"
                          },
                          "endpoint": {
                            "type": "string",
                            "description": "Specifies the endpoint to use for vectorization. This endpoint must be in the same Azure OpenAI resource, but On Your Data will use this endpoint via an internal call rather than a public one, which enables vector search even in private networks.",
                            "format": "uri"
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "endpoint"
                  },
                  "azureChatExtensionsMessageContext": {
                    "type": "object",
                    "properties": {
                      "citations": {
                        "type": "array",
                        "description": "The data source retrieval result, used to generate the assistant message in the response.",
                        "items": {
                          "$ref": "#/components/schemas/citation"
                        },
                        "x-ms-identifiers": []
                      },
                      "intent": {
                        "type": "string",
                        "description": "The detected intent from the chat history, used to pass to the next turn to carry over the context."
                      }
                    },
                    "description": "  A representation of the additional context information available when Azure OpenAI chat extensions are involved\n  in the generation of a corresponding chat completions response. This context information is only populated when\n  using an Azure OpenAI request configured to use a matching extension."
                  },
                  "citation": {
                    "required": [
                      "content"
                    ],
                    "type": "object",
                    "properties": {
                      "content": {
                        "type": "string",
                        "description": "The content of the citation."
                      },
                      "title": {
                        "type": "string",
                        "description": "The title of the citation."
                      },
                      "url": {
                        "type": "string",
                        "description": "The URL of the citation."
                      },
                      "filepath": {
                        "type": "string",
                        "description": "The file path of the citation."
                      },
                      "chunk_id": {
                        "type": "string",
                        "description": "The chunk ID of the citation."
                      }
                    },
                    "description": "citation information for a chat completions response message."
                  },
                  "chatCompletionMessageToolCall": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "The ID of the tool call."
                      },
                      "type": {
                        "$ref": "#/components/schemas/toolCallType"
                      },
                      "function": {
                        "type": "object",
                        "description": "The function that the model called.",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          },
                          "arguments": {
                            "type": "string",
                            "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                          }
                        },
                        "required": [
                          "name",
                          "arguments"
                        ]
                      }
                    },
                    "required": [
                      "id",
                      "type",
                      "function"
                    ]
                  },
                  "toolCallType": {
                    "type": "string",
                    "enum": [
                      "function"
                    ],
                    "description": "The type of the tool call, in this case `function`.",
                    "x-ms-enum": {
                      "name": "ToolCallType",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "function",
                          "description": "The tool call type is function."
                        }
                      ]
                    }
                  },
                  "chatCompletionRequestMessageTool": {
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessage"
                      },
                      {
                        "type": "object",
                        "nullable": true,
                        "properties": {
                          "tool_call_id": {
                            "type": "string",
                            "description": "Tool call that this message is responding to."
                          },
                          "content": {
                            "type": "string",
                            "description": "The contents of the message.",
                            "nullable": true
                          }
                        }
                      }
                    ],
                    "required": [
                      "tool_call_id",
                      "content"
                    ]
                  },
                  "chatCompletionRequestMessageFunction": {
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessage"
                      },
                      {
                        "type": "object",
                        "description": "Deprecated. Message that represents a function.",
                        "nullable": true,
                        "properties": {
                          "role": {
                            "type": "string",
                            "enum": [
                              "function"
                            ],
                            "description": "The role of the messages author, in this case `function`."
                          },
                          "name": {
                            "type": "string",
                            "description": "The contents of the message."
                          },
                          "content": {
                            "type": "string",
                            "description": "The contents of the message.",
                            "nullable": true
                          }
                        }
                      }
                    ],
                    "required": [
                      "function_call_id",
                      "content"
                    ]
                  },
                  "createChatCompletionResponse": {
                    "type": "object",
                    "description": "Represents a chat completion response returned by model, based on the provided input.",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "A unique identifier for the chat completion."
                      },
                      "prompt_filter_results": {
                        "$ref": "#/components/schemas/promptFilterResults"
                      },
                      "choices": {
                        "type": "array",
                        "description": "A list of chat completion choices. Can be more than one if `n` is greater than 1.",
                        "items": {
                          "type": "object",
                          "required": [
                            "finish_reason",
                            "index",
                            "message",
                            "logprobs"
                          ],
                          "properties": {
                            "finish_reason": {
                              "type": "string",
                              "description": "The reason the model stopped generating tokens. This will be `stop` if the model hit a natural stop point or a provided stop sequence,\n`length` if the maximum number of tokens specified in the request was reached,\n`content_filter` if content was omitted due to a flag from our content filters,\n`tool_calls` if the model called a tool, or `function_call` (deprecated) if the model called a function.\n",
                              "enum": [
                                "stop",
                                "length",
                                "tool_calls",
                                "content_filter",
                                "function_call"
                              ]
                            },
                            "index": {
                              "type": "integer",
                              "description": "The index of the choice in the list of choices."
                            },
                            "message": {
                              "$ref": "#/components/schemas/chatCompletionResponseMessage"
                            },
                            "content_filter_results": {
                              "$ref": "#/components/schemas/contentFilterChoiceResults"
                            },
                            "logprobs": {
                              "description": "Log probability information for the choice.",
                              "type": "object",
                              "nullable": true,
                              "properties": {
                                "content": {
                                  "description": "A list of message content tokens with log probability information.",
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                                  },
                                  "nullable": true
                                },
                                "refusal": {
                                  "description": "A list of message refusal tokens with log probability information.",
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                                  },
                                  "nullable": true
                                }
                              },
                              "required": [
                                "content",
                                "refusal"
                              ]
                            }
                          }
                        }
                      },
                      "created": {
                        "type": "integer",
                        "description": "The Unix timestamp (in seconds) of when the chat completion was created."
                      },
                      "model": {
                        "type": "string",
                        "description": "The model used for the chat completion."
                      },
                      "system_fingerprint": {
                        "type": "string",
                        "description": "This fingerprint represents the backend configuration that the model runs with.\n\nCan be used in conjunction with the `seed` request parameter to understand when backend changes have been made that might impact determinism.\n"
                      },
                      "object": {
                        "type": "string",
                        "description": "The object type, which is always `chat.completion`.",
                        "enum": [
                          "chat.completion"
                        ]
                      },
                      "usage": {
                        "$ref": "#/components/schemas/completionUsage"
                      }
                    },
                    "required": [
                      "choices",
                      "created",
                      "id",
                      "model",
                      "object"
                    ]
                  },
                  "createChatCompletionStreamResponse": {
                    "type": "object",
                    "description": "Represents a streamed chunk of a chat completion response returned by model, based on the provided input.",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "A unique identifier for the chat completion. Each chunk has the same ID."
                      },
                      "choices": {
                        "type": "array",
                        "description": "A list of chat completion choices. Can contain more than one elements if `n` is greater than 1.\n",
                        "items": {
                          "type": "object",
                          "required": [
                            "delta",
                            "finish_reason",
                            "index"
                          ],
                          "properties": {
                            "delta": {
                              "$ref": "#/components/schemas/chatCompletionStreamResponseDelta"
                            },
                            "logprobs": {
                              "description": "Log probability information for the choice.",
                              "type": "object",
                              "nullable": true,
                              "properties": {
                                "content": {
                                  "description": "A list of message content tokens with log probability information.",
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                                  },
                                  "nullable": true
                                },
                                "refusal": {
                                  "description": "A list of message refusal tokens with log probability information.",
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                                  },
                                  "nullable": true
                                }
                              },
                              "required": [
                                "content",
                                "refusal"
                              ]
                            },
                            "finish_reason": {
                              "type": "string",
                              "description": "The reason the model stopped generating tokens. This will be `stop` if the model hit a natural stop point or a provided stop sequence,\n`length` if the maximum number of tokens specified in the request was reached,\n`content_filter` if content was omitted due to a flag from our content filters,\n`tool_calls` if the model called a tool, or `function_call` (deprecated) if the model called a function.\n",
                              "enum": [
                                "stop",
                                "length",
                                "tool_calls",
                                "content_filter",
                                "function_call"
                              ],
                              "nullable": true
                            },
                            "index": {
                              "type": "integer",
                              "description": "The index of the choice in the list of choices."
                            }
                          }
                        }
                      },
                      "created": {
                        "type": "integer",
                        "description": "The Unix timestamp (in seconds) of when the chat completion was created. Each chunk has the same timestamp."
                      },
                      "model": {
                        "type": "string",
                        "description": "The model to generate the completion."
                      },
                      "system_fingerprint": {
                        "type": "string",
                        "description": "This fingerprint represents the backend configuration that the model runs with.\nCan be used in conjunction with the `seed` request parameter to understand when backend changes have been made that might impact determinism.\n"
                      },
                      "object": {
                        "type": "string",
                        "description": "The object type, which is always `chat.completion.chunk`.",
                        "enum": [
                          "chat.completion.chunk"
                        ],
                        "required": [
                          "prompt_tokens",
                          "completion_tokens",
                          "total_tokens"
                        ]
                      }
                    },
                    "required": [
                      "choices",
                      "created",
                      "id",
                      "model",
                      "object"
                    ]
                  },
                  "chatCompletionStreamResponseDelta": {
                    "type": "object",
                    "description": "A chat completion delta generated by streamed model responses.",
                    "properties": {
                      "content": {
                        "type": "string",
                        "description": "The contents of the chunk message.",
                        "nullable": true
                      },
                      "function_call": {
                        "deprecated": true,
                        "type": "object",
                        "description": "Deprecated and replaced by `tool_calls`. The name and arguments of a function that should be called, as generated by the model.",
                        "properties": {
                          "arguments": {
                            "type": "string",
                            "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                          },
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          }
                        }
                      },
                      "tool_calls": {
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/chatCompletionMessageToolCallChunk"
                        }
                      },
                      "role": {
                        "type": "string",
                        "enum": [
                          "system",
                          "user",
                          "assistant",
                          "tool"
                        ],
                        "description": "The role of the author of this message."
                      },
                      "refusal": {
                        "type": "string",
                        "description": "The refusal message generated by the model.",
                        "nullable": true
                      }
                    }
                  },
                  "chatCompletionMessageToolCallChunk": {
                    "type": "object",
                    "properties": {
                      "index": {
                        "type": "integer"
                      },
                      "id": {
                        "type": "string",
                        "description": "The ID of the tool call."
                      },
                      "type": {
                        "type": "string",
                        "enum": [
                          "function"
                        ],
                        "description": "The type of the tool. Currently, only `function` is supported."
                      },
                      "function": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          },
                          "arguments": {
                            "type": "string",
                            "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                          }
                        }
                      }
                    },
                    "required": [
                      "index"
                    ]
                  },
                  "chatCompletionStreamOptions": {
                    "description": "Options for streaming response. Only set this when you set `stream: true`.\n",
                    "type": "object",
                    "nullable": true,
                    "default": null,
                    "properties": {
                      "include_usage": {
                        "type": "boolean",
                        "description": "If set, an additional chunk will be streamed before the `data: [DONE]` message. The `usage` field on this chunk shows the token usage statistics for the entire request, and the `choices` field will always be an empty array. All other chunks will also include a `usage` field, but with a null value.\n"
                      }
                    }
                  },
                  "chatCompletionChoiceLogProbs": {
                    "description": "Log probability information for the choice.",
                    "type": "object",
                    "nullable": true,
                    "properties": {
                      "content": {
                        "description": "A list of message content tokens with log probability information.",
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                        },
                        "nullable": true
                      },
                      "refusal": {
                        "description": "A list of message refusal tokens with log probability information.",
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                        },
                        "nullable": true
                      }
                    },
                    "required": [
                      "content"
                    ]
                  },
                  "chatCompletionTokenLogprob": {
                    "type": "object",
                    "properties": {
                      "token": {
                        "description": "The token.",
                        "type": "string"
                      },
                      "logprob": {
                        "description": "The log probability of this token.",
                        "type": "number"
                      },
                      "bytes": {
                        "description": "A list of integers representing the UTF-8 bytes representation of the token. Useful in instances where characters are represented by multiple tokens and their byte representations must be combined to generate the correct text representation. Can be `null` if there is no bytes representation for the token.",
                        "type": "array",
                        "items": {
                          "type": "integer"
                        },
                        "nullable": true
                      },
                      "top_logprobs": {
                        "description": "List of the most likely tokens and their log probability, at this token position. In rare cases, there may be fewer than the number of requested `top_logprobs` returned.",
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "token": {
                              "description": "The token.",
                              "type": "string"
                            },
                            "logprob": {
                              "description": "The log probability of this token.",
                              "type": "number"
                            },
                            "bytes": {
                              "description": "A list of integers representing the UTF-8 bytes representation of the token. Useful in instances where characters are represented by multiple tokens and their byte representations must be combined to generate the correct text representation. Can be `null` if there is no bytes representation for the token.",
                              "type": "array",
                              "items": {
                                "type": "integer"
                              },
                              "nullable": true
                            }
                          },
                          "required": [
                            "token",
                            "logprob",
                            "bytes"
                          ]
                        }
                      }
                    },
                    "required": [
                      "token",
                      "logprob",
                      "bytes",
                      "top_logprobs"
                    ]
                  },
                  "chatCompletionResponseMessage": {
                    "type": "object",
                    "description": "A chat completion message generated by the model.",
                    "properties": {
                      "role": {
                        "$ref": "#/components/schemas/chatCompletionResponseMessageRole"
                      },
                      "refusal": {
                        "type": "string",
                        "description": "The refusal message generated by the model.",
                        "nullable": true
                      },
                      "content": {
                        "type": "string",
                        "description": "The contents of the message.",
                        "nullable": true
                      },
                      "tool_calls": {
                        "type": "array",
                        "description": "The tool calls generated by the model, such as function calls.",
                        "items": {
                          "$ref": "#/components/schemas/chatCompletionMessageToolCall"
                        }
                      },
                      "function_call": {
                        "$ref": "#/components/schemas/chatCompletionFunctionCall"
                      },
                      "context": {
                        "$ref": "#/components/schemas/azureChatExtensionsMessageContext"
                      }
                    },
                    "required": [
                      "role",
                      "content",
                      "refusal"
                    ]
                  },
                  "chatCompletionResponseMessageRole": {
                    "type": "string",
                    "enum": [
                      "assistant"
                    ],
                    "description": "The role of the author of the response message."
                  },
                  "chatCompletionToolChoiceOption": {
                    "description": "Controls which (if any) tool is called by the model.\n`none` means the model will not call any tool and instead generates a message.\n`auto` means the model can pick between generating a message or calling one or more tools.\n`required` means the model must call one or more tools.\nSpecifying a particular tool via `{\"type\": \"function\", \"function\": {\"name\": \"my_function\"}}` forces the model to call that tool.\n`none` is the default when no tools are present. `auto` is the default if tools are present.\n",
                    "oneOf": [
                      {
                        "type": "string",
                        "description": "`none` means the model will not call any tool and instead generates a message. `auto` means the model can pick between generating a message or calling one or more tools. `required` means the model must call one or more tools.\n",
                        "enum": [
                          "none",
                          "auto",
                          "required"
                        ]
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionNamedToolChoice"
                      }
                    ]
                  },
                  "chatCompletionNamedToolChoice": {
                    "type": "object",
                    "description": "Specifies a tool the model should use. Use to force the model to call a specific function.",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "function"
                        ],
                        "description": "The type of the tool. Currently, only `function` is supported."
                      },
                      "function": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          }
                        },
                        "required": [
                          "name"
                        ]
                      }
                    },
                    "required": [
                      "type",
                      "function"
                    ]
                  },
                  "ParallelToolCalls": {
                    "description": "Whether to enable parallel function calling during tool use.",
                    "type": "boolean",
                    "default": true
                  },
                  "chatCompletionMessageToolCalls": {
                    "type": "array",
                    "description": "The tool calls generated by the model, such as function calls.",
                    "items": {
                      "$ref": "#/components/schemas/chatCompletionMessageToolCall"
                    }
                  },
                  "chatCompletionFunctionCall": {
                    "type": "object",
                    "description": "Deprecated and replaced by `tool_calls`. The name and arguments of a function that should be called, as generated by the model.",
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "The name of the function to call."
                      },
                      "arguments": {
                        "type": "string",
                        "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                      }
                    },
                    "required": [
                      "name",
                      "arguments"
                    ]
                  },
                  "completionUsage": {
                    "type": "object",
                    "description": "Usage statistics for the completion request.",
                    "properties": {
                      "prompt_tokens": {
                        "type": "integer",
                        "description": "Number of tokens in the prompt."
                      },
                      "completion_tokens": {
                        "type": "integer",
                        "description": "Number of tokens in the generated completion."
                      },
                      "total_tokens": {
                        "type": "integer",
                        "description": "Total number of tokens used in the request (prompt + completion)."
                      },
                      "completion_tokens_details": {
                        "type": "object",
                        "description": "Breakdown of tokens used in a completion.",
                        "properties": {
                          "reasoning_tokens": {
                            "type": "integer",
                            "description": "Tokens generated by the model for reasoning."
                          }
                        }
                      }
                    },
                    "required": [
                      "prompt_tokens",
                      "completion_tokens",
                      "total_tokens"
                    ]
                  },
                  "chatCompletionTool": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "function"
                        ],
                        "description": "The type of the tool. Currently, only `function` is supported."
                      },
                      "function": {
                        "$ref": "#/components/schemas/FunctionObject"
                      }
                    },
                    "required": [
                      "type",
                      "function"
                    ]
                  },
                  "FunctionParameters": {
                    "type": "object",
                    "description": "The parameters the functions accepts, described as a JSON Schema object. See the guide](https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling) for examples, and the [JSON Schema reference](https://json-schema.org/understanding-json-schema/) for documentation about the format. \n\nOmitting `parameters` defines a function with an empty parameter list.",
                    "additionalProperties": true
                  },
                  "FunctionObject": {
                    "type": "object",
                    "properties": {
                      "description": {
                        "type": "string",
                        "description": "A description of what the function does, used by the model to choose when and how to call the function."
                      },
                      "name": {
                        "type": "string",
                        "description": "The name of the function to be called. Must be a-z, A-Z, 0-9, or contain underscores and dashes, with a maximum length of 64."
                      },
                      "parameters": {
                        "$ref": "#/components/schemas/FunctionParameters"
                      },
                      "strict": {
                        "type": "boolean",
                        "nullable": true,
                        "default": false,
                        "description": "Whether to enable strict schema adherence when generating the function call. If set to true, the model will follow the exact schema defined in the `parameters` field. Only a subset of JSON Schema is supported when `strict` is `true`. Learn more about Structured Outputs in the [function calling guide](docs/guides/function-calling)."
                      }
                    },
                    "required": [
                      "name"
                    ]
                  },
                  "ResponseFormatText": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "description": "The type of response format being defined: `text`",
                        "enum": [
                          "text"
                        ]
                      }
                    },
                    "required": [
                      "type"
                    ]
                  },
                  "ResponseFormatJsonObject": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "description": "The type of response format being defined: `json_object`",
                        "enum": [
                          "json_object"
                        ]
                      }
                    },
                    "required": [
                      "type"
                    ]
                  },
                  "ResponseFormatJsonSchemaSchema": {
                    "type": "object",
                    "description": "The schema for the response format, described as a JSON Schema object.",
                    "additionalProperties": true
                  },
                  "ResponseFormatJsonSchema": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "description": "The type of response format being defined: `json_schema`",
                        "enum": [
                          "json_schema"
                        ]
                      },
                      "json_schema": {
                        "type": "object",
                        "properties": {
                          "description": {
                            "type": "string",
                            "description": "A description of what the response format is for, used by the model to determine how to respond in the format."
                          },
                          "name": {
                            "type": "string",
                            "description": "The name of the response format. Must be a-z, A-Z, 0-9, or contain underscores and dashes, with a maximum length of 64."
                          },
                          "schema": {
                            "$ref": "#/components/schemas/ResponseFormatJsonSchemaSchema"
                          },
                          "strict": {
                            "type": "boolean",
                            "nullable": true,
                            "default": false,
                            "description": "Whether to enable strict schema adherence when generating the output. If set to true, the model will always follow the exact schema defined in the `schema` field. Only a subset of JSON Schema is supported when `strict` is `true`."
                          }
                        },
                        "required": [
                          "type",
                          "name"
                        ]
                      }
                    },
                    "required": [
                      "type",
                      "json_schema"
                    ]
                  },
                  "chatCompletionChoiceCommon": {
                    "type": "object",
                    "properties": {
                      "index": {
                        "type": "integer"
                      },
                      "finish_reason": {
                        "type": "string"
                      }
                    }
                  },
                  "createTranslationRequest": {
                    "type": "object",
                    "description": "Translation request.",
                    "properties": {
                      "file": {
                        "type": "string",
                        "description": "The audio file to translate.",
                        "format": "binary"
                      },
                      "prompt": {
                        "type": "string",
                        "description": "An optional text to guide the model's style or continue a previous audio segment. The prompt should be in English."
                      },
                      "response_format": {
                        "$ref": "#/components/schemas/audioResponseFormat"
                      },
                      "temperature": {
                        "type": "number",
                        "default": 0,
                        "description": "The sampling temperature, between 0 and 1. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic. If set to 0, the model will use log probability to automatically increase the temperature until certain thresholds are hit."
                      }
                    },
                    "required": [
                      "file"
                    ]
                  },
                  "audioResponse": {
                    "description": "Translation or transcription response when response_format was json",
                    "type": "object",
                    "properties": {
                      "text": {
                        "type": "string",
                        "description": "Translated or transcribed text."
                      }
                    },
                    "required": [
                      "text"
                    ]
                  },
                  "audioVerboseResponse": {
                    "description": "Translation or transcription response when response_format was verbose_json",
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/audioResponse"
                      },
                      {
                        "properties": {
                          "task": {
                            "type": "string",
                            "description": "Type of audio task.",
                            "enum": [
                              "transcribe",
                              "translate"
                            ],
                            "x-ms-enum": {
                              "modelAsString": true
                            }
                          },
                          "language": {
                            "type": "string",
                            "description": "Language."
                          },
                          "duration": {
                            "type": "number",
                            "description": "Duration."
                          },
                          "segments": {
                            "type": "array",
                            "items": {
                              "$ref": "#/components/schemas/audioSegment"
                            }
                          }
                        }
                      }
                    ],
                    "required": [
                      "text"
                    ]
                  },
                  "audioResponseFormat": {
                    "title": "AudioResponseFormat",
                    "description": "Defines the format of the output.",
                    "enum": [
                      "json",
                      "text",
                      "srt",
                      "verbose_json",
                      "vtt"
                    ],
                    "type": "string",
                    "x-ms-enum": {
                      "modelAsString": true
                    }
                  },
                  "createTranscriptionRequest": {
                    "type": "object",
                    "description": "Transcription request.",
                    "properties": {
                      "file": {
                        "type": "string",
                        "description": "The audio file object to transcribe.",
                        "format": "binary"
                      },
                      "prompt": {
                        "type": "string",
                        "description": "An optional text to guide the model's style or continue a previous audio segment. The prompt should match the audio language."
                      },
                      "response_format": {
                        "$ref": "#/components/schemas/audioResponseFormat"
                      },
                      "temperature": {
                        "type": "number",
                        "default": 0,
                        "description": "The sampling temperature, between 0 and 1. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic. If set to 0, the model will use log probability to automatically increase the temperature until certain thresholds are hit."
                      },
                      "language": {
                        "type": "string",
                        "description": "The language of the input audio. Supplying the input language in ISO-639-1 format will improve accuracy and latency."
                      }
                    },
                    "required": [
                      "file"
                    ]
                  },
                  "audioSegment": {
                    "type": "object",
                    "description": "Transcription or translation segment.",
                    "properties": {
                      "id": {
                        "type": "integer",
                        "description": "Segment identifier."
                      },
                      "seek": {
                        "type": "number",
                        "description": "Offset of the segment."
                      },
                      "start": {
                        "type": "number",
                        "description": "Segment start offset."
                      },
                      "end": {
                        "type": "number",
                        "description": "Segment end offset."
                      },
                      "text": {
                        "type": "string",
                        "description": "Segment text."
                      },
                      "tokens": {
                        "type": "array",
                        "items": {
                          "type": "number",
                          "nullable": false
                        },
                        "description": "Tokens of the text."
                      },
                      "temperature": {
                        "type": "number",
                        "description": "Temperature."
                      },
                      "avg_logprob": {
                        "type": "number",
                        "description": "Average log probability."
                      },
                      "compression_ratio": {
                        "type": "number",
                        "description": "Compression ratio."
                      },
                      "no_speech_prob": {
                        "type": "number",
                        "description": "Probability of 'no speech'."
                      }
                    }
                  },
                  "imageQuality": {
                    "description": "The quality of the image that will be generated.",
                    "type": "string",
                    "enum": [
                      "standard",
                      "hd"
                    ],
                    "default": "standard",
                    "x-ms-enum": {
                      "name": "Quality",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "standard",
                          "description": "Standard quality creates images with standard quality.",
                          "name": "Standard"
                        },
                        {
                          "value": "hd",
                          "description": "HD quality creates images with finer details and greater consistency across the image.",
                          "name": "HD"
                        }
                      ]
                    }
                  },
                  "imagesResponseFormat": {
                    "description": "The format in which the generated images are returned.",
                    "type": "string",
                    "enum": [
                      "url",
                      "b64_json"
                    ],
                    "default": "url",
                    "x-ms-enum": {
                      "name": "ImagesResponseFormat",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "url",
                          "description": "The URL that provides temporary access to download the generated images.",
                          "name": "Url"
                        },
                        {
                          "value": "b64_json",
                          "description": "The generated images are returned as base64 encoded string.",
                          "name": "Base64Json"
                        }
                      ]
                    }
                  },
                  "imageSize": {
                    "description": "The size of the generated images.",
                    "type": "string",
                    "enum": [
                      "1792x1024",
                      "1024x1792",
                      "1024x1024"
                    ],
                    "default": "1024x1024",
                    "x-ms-enum": {
                      "name": "Size",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "1792x1024",
                          "description": "The desired size of the generated image is 1792x1024 pixels.",
                          "name": "Size1792x1024"
                        },
                        {
                          "value": "1024x1792",
                          "description": "The desired size of the generated image is 1024x1792 pixels.",
                          "name": "Size1024x1792"
                        },
                        {
                          "value": "1024x1024",
                          "description": "The desired size of the generated image is 1024x1024 pixels.",
                          "name": "Size1024x1024"
                        }
                      ]
                    }
                  },
                  "imageStyle": {
                    "description": "The style of the generated images.",
                    "type": "string",
                    "enum": [
                      "vivid",
                      "natural"
                    ],
                    "default": "vivid",
                    "x-ms-enum": {
                      "name": "Style",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "vivid",
                          "description": "Vivid creates images that are hyper-realistic and dramatic.",
                          "name": "Vivid"
                        },
                        {
                          "value": "natural",
                          "description": "Natural creates images that are more natural and less hyper-realistic.",
                          "name": "Natural"
                        }
                      ]
                    }
                  },
                  "imageGenerationsRequest": {
                    "type": "object",
                    "properties": {
                      "prompt": {
                        "description": "A text description of the desired image(s). The maximum length is 4000 characters.",
                        "type": "string",
                        "format": "string",
                        "example": "a corgi in a field",
                        "minLength": 1
                      },
                      "n": {
                        "description": "The number of images to generate.",
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 1,
                        "default": 1
                      },
                      "size": {
                        "$ref": "#/components/schemas/imageSize"
                      },
                      "response_format": {
                        "$ref": "#/components/schemas/imagesResponseFormat"
                      },
                      "user": {
                        "description": "A unique identifier representing your end-user, which can help to monitor and detect abuse.",
                        "type": "string",
                        "format": "string",
                        "example": "user123456"
                      },
                      "quality": {
                        "$ref": "#/components/schemas/imageQuality"
                      },
                      "style": {
                        "$ref": "#/components/schemas/imageStyle"
                      }
                    },
                    "required": [
                      "prompt"
                    ]
                  },
                  "generateImagesResponse": {
                    "type": "object",
                    "properties": {
                      "created": {
                        "type": "integer",
                        "format": "unixtime",
                        "description": "The unix timestamp when the operation was created.",
                        "example": "1676540381"
                      },
                      "data": {
                        "type": "array",
                        "description": "The result data of the operation, if successful",
                        "items": {
                          "$ref": "#/components/schemas/imageResult"
                        }
                      }
                    },
                    "required": [
                      "created",
                      "data"
                    ]
                  },
                  "imageResult": {
                    "type": "object",
                    "description": "The image url or encoded image if successful, and an error otherwise.",
                    "properties": {
                      "url": {
                        "type": "string",
                        "description": "The image url.",
                        "example": "https://www.contoso.com"
                      },
                      "b64_json": {
                        "type": "string",
                        "description": "The base64 encoded image"
                      },
                      "content_filter_results": {
                        "$ref": "#/components/schemas/dalleContentFilterResults"
                      },
                      "revised_prompt": {
                        "type": "string",
                        "description": "The prompt that was used to generate the image, if there was any revision to the prompt."
                      },
                      "prompt_filter_results": {
                        "$ref": "#/components/schemas/dalleFilterResults"
                      }
                    }
                  }
                },
                "securitySchemes": {
                  "bearer": {
                    "type": "oauth2",
                    "flows": {
                      "implicit": {
                        "authorizationUrl": "https://login.microsoftonline.com/common/oauth2/v2.0/authorize",
                        "scopes": {}
                      }
                    },
                    "x-tokenInfoFunc": "api.middleware.auth.bearer_auth",
                    "x-scopeValidateFunc": "api.middleware.auth.validate_scopes"
                  },
                  "apiKey": {
                    "type": "apiKey",
                    "name": "api-key",
                    "in": "header"
                  }
                }
              }
            },
            "$fxv#1": "<policies>\n    <inbound>\n        <base />\n\n        <!-- AAD Authorization -->\n        <!-- Enabled if entra-validate named value is set to true -->\n        <include-fragment fragment-id=\"aad-auth\" />\n\n        <!-- Detecting streaming request to adjust token calculations -->\n        <choose>\n            <when condition=\"@{\n                try\n                {\n                    var body = context.Request.Body.As<JObject>(true);\n                    return body != null &&\n                        body[\"stream\"] != null &&\n                        body[\"stream\"].Type != JTokenType.Null;\n                }\n                catch\n                {\n                    return false;\n                }\n            }\">\n                <set-variable name=\"isStream\" value=\"@{\n                    var content = (context.Request.Body?.As<JObject>(true));\n                    string streamValue = content[\"stream\"].ToString().ToLower();\n                    return streamValue;\n                }\" />\n            </when>\n            <otherwise>\n                <set-variable name=\"isStream\" value=\"false\" />\n            </otherwise>\n        </choose>\n\n        <!-- Deleting api-key header to it is not passed to OpenAI endpoint-->\n        <set-header name=\"api-key\" exists-action=\"delete\" />\n\n        <!-- Setting cache keys -->\n        <set-variable name=\"deployment-id\" value=\"@((string)context.Request.MatchedParameters[\"deployment-id\"])\" />\n        <set-variable name=\"routesCacheKey\" value=\"@((string)context.Variables[\"deployment-id\"] + \"Routes\" + context.Deployment.Region + context.Api.Revision)\" />\n        <set-variable name=\"oaClustersCacheKey\" value=\"@(\"oaClusters\" + context.Deployment.Region + context.Api.Revision)\" />\n\n        <!-- RBAC: Set allowed backends (comma-separated backend-ids, empty means all are allowed) -->\n        <set-variable name=\"allowedBackend\" value=\"\" />\n\n        <!-- Getting OpenAI clusters configuration -->\n        <cache-lookup-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-CLUSTERS\"))\" variable-name=\"oaClusters\" />\n        <!-- If we can't find the configuration cached, it will be loaded -->\n        <choose>\n            <when condition=\"@(context.Variables.ContainsKey(\"oaClusters\") == false)\">\n                <set-variable name=\"oaClusters\" value=\"@{\n                        // route is an Azure OpenAI API endpoints\n                        JArray routes = new JArray();\n                        // cluster is a group of routes that are capable of serving a specific deployment name (model and version)\n                        JArray clusters = new JArray();\n                        // Update the below if condition when using multiple APIM gateway regions/SHGW to get different configuartions for each region\n                        if(context.Deployment.Region == \"West Europe\" || true)\n                        {\n                            // Adding all Azure OpenAI endpoints routes (which are set as APIM Backend)\n                            routes.Add(new JObject()\n                            {\n                                { \"name\", \"OpenAI 1\" },\n                                { \"location\", \"East US\" },\n                                { \"backend-id\", \"openai-backend-0\" },\n                                { \"priority\", 1},\n                                { \"isThrottling\", false },\n                                { \"retryAfter\", DateTime.MinValue }\n                            });\n\n                            routes.Add(new JObject()\n                            {\n                                { \"name\", \"OpenAI 2\" },\n                                { \"location\", \"North Central US\" },\n                                { \"backend-id\", \"openai-backend-1\" },\n                                { \"priority\", 2},\n                                { \"isThrottling\", false },\n                                { \"retryAfter\", DateTime.MinValue }\n                            });\n\n                            routes.Add(new JObject()\n                            {\n                                { \"name\", \"OpenAI 3\" },\n                                { \"location\", \"East US 2\" },\n                                { \"backend-id\", \"openai-backend-2\" },\n                                { \"priority\", 2},\n                                { \"isThrottling\", false },\n                                { \"retryAfter\", DateTime.MinValue }\n                            });\n\n                            // For each deployment name, create a cluster with the routes that can serve it\n                            // It is important in you OpenAI deployments to use the same name across instances\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"chat\" },\n                                { \"routes\", new JArray(routes[0], routes[1], routes[2]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"embedding\" },\n                                { \"routes\", new JArray(routes[0], routes[2]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"gpt-4o\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                        }\n                        else\n                        {\n                            //No clusters found for selected region, either return error (defult behavior) or set default cluster in the else section\n                        }\n\n                        return clusters;\n                    }\" />\n                <!-- Add cluster configurations to cache -->\n                <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-CLUSTERS\"))\" value=\"@((JArray)context.Variables[\"oaClusters\"])\" duration=\"86400\" />\n            </when>\n        </choose>\n\n        <include-fragment fragment-id=\"validate-routes\" />\n\n        <!-- Backend Managed Identity -->\n        <!-- <authentication-managed-identity resource=\"https://cognitiveservices.azure.com\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" /> -->\n        <authentication-managed-identity resource=\"https://cognitiveservices.azure.com\" output-token-variable-name=\"msi-access-token\" ignore-error=\"false\" />\n        <set-header name=\"Authorization\" exists-action=\"override\">\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\n        </set-header>\n\n        <!-- NEW: Semantic cache lookup (only for NON-streaming requests) -->\n        <choose>\n            <when condition=\"@(((string)context.Variables.GetValueOrDefault<string>(\"isStream\",\"false\")) != \"true\")\">\n                <include-fragment fragment-id=\"semantic-cache-lookup\" />\n            </when>\n        </choose>\n\n        <!-- Setting gobal TPM limit to collect usage for streaming requests -->\n        <azure-openai-token-limit counter-key=\"APIMOpenAI\" tokens-per-minute=\"50000000\" estimate-prompt-tokens=\"false\" tokens-consumed-variable-name=\"TotalConsumedTokens\" remaining-tokens-variable-name=\"TotalRemainingTokens\" />\n\n        <!-- Handling usage for streaming requests -->\n        <include-fragment fragment-id=\"openai-usage-streaming\" />\n    </inbound>\n\n    <backend>\n        <include-fragment fragment-id=\"backend-routing\" />\n    </backend>\n\n    <outbound>\n        <base />\n\n        <!-- NEW: Semantic cache store (only for NON-streaming requests) -->\n        <choose>\n            <when condition=\"@(((string)context.Variables.GetValueOrDefault<string>(\"isStream\",\"false\")) != \"true\")\">\n                <include-fragment fragment-id=\"semantic-cache-store\" />\n            </when>\n        </choose>\n\n        <!-- Handling usage for non-streaming requests -->\n        <include-fragment fragment-id=\"openai-usage\" />\n    </outbound>\n\n    <on-error>\n        <base />\n        <!-- This is used to push custom metrics related to 429 throttleing errors -->\n        <!-- It is designed to premit setting up Azure Monitor Alerts notifying the team of potential service degredation -->\n        <set-variable name=\"service-name\" value=\"Azure Open AI\" />\n        <set-variable name=\"target-deployment\" value=\"@((string)context.Request.MatchedParameters[\"deployment-id\"])\" />\n        <include-fragment fragment-id=\"throttling-events\" />\n    </on-error>\n</policies>\n",
            "$fxv#10": "<fragment>\n    <!-- Getting OpenAI routes configuration based on deployment name, region and api revision -->\n    <cache-lookup-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" variable-name=\"routes\" />\n    <!-- If we can't find the configuration, it will be loaded -->\n    <choose>\n        <when condition=\"@(context.Variables.ContainsKey(\"routes\") == false)\">\n            <set-variable name=\"routes\" value=\"@{\n                    string deploymentName = (string)context.Variables[\"deployment-id\"];\n                    JArray clusters = (JArray)context.Variables[\"oaClusters\"];\n                    JObject cluster = (JObject)clusters.FirstOrDefault(o => o[\"deploymentName\"]?.Value<string>() == deploymentName);\n                    if(cluster == null)\n                    {\n                        //Error: No cluster matched the requested deployment name\n                        return new JArray() { new JObject()\n                            {\n                                { \"name\", deploymentName },\n                                { \"location\", \"NA\" },\n                                { \"url\", \"No routes found for the deployment (\" + deploymentName + \") in the region (\" + context.Deployment.Region + \")\" }\n                            }\n                        };\n                    }\n                    JArray routes = (JArray)cluster[\"routes\"];\n                    return routes;\n                }\" />\n            <!-- If no routes found for deployment, return bad request with content of routes variable -->\n            <choose>\n                <when condition=\"@(((JArray)context.Variables[\"routes\"]).ToString().Contains(\"No routes\"))\">\n                    <return-response>\n                        <set-status code=\"400\" reason=\"No routes\" />\n                        <set-body>@(((JArray)context.Variables[\"routes\"]).ToString())</set-body>\n                    </return-response>\n                </when>\n            </choose>\n            <!-- Add cluster configurations to cache -->\n            <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" value=\"@((JArray)context.Variables[\"routes\"])\" duration=\"86400\" />\n        </when>\n    </choose>\n    <set-variable name=\"routeIndex\" value=\"-1\" />\n    <set-variable name=\"remainingRoutes\" value=\"1\" />\n</fragment>",
            "$fxv#11": "<fragment>\n    <retry condition=\"@(context.Response != null && (context.Response.StatusCode == 429 || context.Response.StatusCode >= 500) && ((Int32)context.Variables[\"remainingRoutes\"]) > 0)\" count=\"3\" interval=\"0\">\n        <!-- Before picking the route, let's verify if there is any that should be set to not throttling anymore -->\n        <set-variable name=\"routes\" value=\"@{\n                JArray routes = (JArray)context.Variables[\"routes\"];\n                \n                for (int i = 0; i < routes.Count; i++)\n                {\n                    JObject route = (JObject)routes[i];\n\n                    if (route.Value<bool>(\"isThrottling\") && DateTime.Now >= route.Value<DateTime>(\"retryAfter\"))\n                    {\n                        route[\"isThrottling\"] = false;\n                        route[\"retryAfter\"] = DateTime.MinValue;\n                    }\n                }\n\n                return routes; \n            }\" />\n        <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" value=\"@((JArray)context.Variables[\"routes\"])\" duration=\"86400\" />\n        <!-- This is the main logic to pick the route to be used with RBAC validation -->\n        <set-variable name=\"routeIndex\" value=\"@{\n                JArray routes = (JArray)context.Variables[\"routes\"];\n                string allowedBackend = (string)context.Variables.GetValueOrDefault(\"allowedBackend\", \"\");\n                string[] allowedBackends = string.IsNullOrEmpty(allowedBackend) ? new string[0] : allowedBackend.Split(',');\n                int selectedPriority = Int32.MaxValue;\n                List<int> availableRoutesIndexes = new List<int>();\n\n                for (int i = 0; i < routes.Count; i++)\n                {\n                    JObject route = (JObject)routes[i];\n                    string backendId = route.Value<string>(\"backend-id\");\n\n                    // Check if backend is allowed (empty allowedBackend means all are allowed)\n                    bool isBackendAllowed = string.IsNullOrEmpty(allowedBackend) || \n                                          allowedBackends.Contains(backendId.Trim());\n\n                    if (!route.Value<bool>(\"isThrottling\") && isBackendAllowed)\n                    {\n                        int routePriority = route.Value<int>(\"priority\");\n\n                        if (routePriority < selectedPriority)\n                        {\n                            selectedPriority = routePriority;\n                            availableRoutesIndexes.Clear();\n                            availableRoutesIndexes.Add(i);\n                        } \n                        else if (routePriority == selectedPriority)\n                        {\n                            availableRoutesIndexes.Add(i);\n                        }\n                    }\n                }\n\n                if (availableRoutesIndexes.Count == 1)\n                {\n                    return availableRoutesIndexes[0];\n                }\n            \n                if (availableRoutesIndexes.Count > 0)\n                {\n                    //Returns a random route from the list if we have more than one available with the same priority\n                    return availableRoutesIndexes[new Random().Next(0, availableRoutesIndexes.Count)];\n                }\n                else\n                {\n                    //If there are no available allowed routes, return -1 to indicate failure\n                    return -1;    \n                }\n                }\" />\n\n        <!-- Check if no allowed backend is available and return appropriate error -->\n        <choose>\n            <when condition=\"@((Int32)context.Variables[\"routeIndex\"] == -1)\">\n                <!-- Find the last error from allowed backends to return meaningful error -->\n                <set-variable name=\"lastAllowedBackendError\" value=\"@{\n                        JArray routes = (JArray)context.Variables[\"routes\"];\n                        string allowedBackend = (string)context.Variables.GetValueOrDefault(\"allowedBackend\", \"\");\n                        \n                        // If no specific backends are allowed, return generic error\n                        if (string.IsNullOrEmpty(allowedBackend))\n                        {\n                            return \"503|Service Unavailable|No backends are currently available\";\n                        }\n                        \n                        string[] allowedBackends = allowedBackend.Split(',');\n                        \n                        // Find the most recent error from allowed backends\n                        DateTime latestRetryAfter = DateTime.MinValue;\n                        string errorDetails = \"503|Service Unavailable|No allowed backends are currently available\";\n                        \n                        for (int i = 0; i < routes.Count; i++)\n                        {\n                            JObject route = (JObject)routes[i];\n                            string backendId = route.Value<string>(\"backend-id\");\n                            \n                            if (allowedBackends.Contains(backendId.Trim()) && route.Value<bool>(\"isThrottling\"))\n                            {\n                                DateTime retryAfter = route.Value<DateTime>(\"retryAfter\");\n                                if (retryAfter > latestRetryAfter)\n                                {\n                                    latestRetryAfter = retryAfter;\n                                    errorDetails = \"429|Too Many Requests|Rate limit exceeded for allowed backends\";\n                                }\n                            }\n                        }\n                        \n                        return errorDetails;\n                    }\" />\n                <set-variable name=\"errorCode\" value=\"@(((string)context.Variables[\"lastAllowedBackendError\"]).Split('|')[0])\" />\n                <set-variable name=\"errorReason\" value=\"@(((string)context.Variables[\"lastAllowedBackendError\"]).Split('|')[1])\" />\n                <set-variable name=\"errorMessage\" value=\"@(((string)context.Variables[\"lastAllowedBackendError\"]).Split('|')[2])\" />\n                <return-response>\n                    <set-status code=\"@(Convert.ToInt32((string)context.Variables[\"errorCode\"]))\" reason=\"@((string)context.Variables[\"errorReason\"])\" />\n                    <set-body>@((string)context.Variables[\"errorMessage\"])</set-body>\n                </return-response>\n            </when>\n        </choose>\n\n        <set-variable name=\"backendId\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"routeIndex\"]]).Value<string>(\"backend-id\"))\" />\n        <set-variable name=\"routeLocation\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"routeIndex\"]]).Value<string>(\"location\"))\" />\n        <set-variable name=\"routeName\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"routeIndex\"]]).Value<string>(\"name\"))\" />\n        <set-variable name=\"deploymentName\" value=\"@((string)context.Variables[\"deployment-id\"])\" />\n        <set-backend-service backend-id=\"@((string)context.Variables[\"backendId\"])\" />\n        <choose>\n            <when condition=\"@(context.Variables.GetValueOrDefault<string>(\"isStream\", \"false\") == \"true\")\">\n                <forward-request buffer-response=\"false\" />\n            </when>\n            <otherwise>\n                <forward-request buffer-response=\"true\" />\n            </otherwise>\n        </choose>\n        <choose>\n            <!-- In case we got 429 or 5xx from a route, update the list with its status -->\n            <when condition=\"@(context.Response != null && (context.Response.StatusCode == 429 || context.Response.StatusCode >= 500) )\">\n                <cache-lookup-value key=\"@(context.Request.MatchedParameters[\"deployment-id\"] + \"Routes\" + context.Deployment.Region + context.Api.Revision)\" variable-name=\"routes\" />\n                <set-variable name=\"routes\" value=\"@{\n                        JArray routes = (JArray)context.Variables[\"routes\"];\n                        int currentrouteIndex = context.Variables.GetValueOrDefault<int>(\"routeIndex\");\n                        int retryAfter = Convert.ToInt32(context.Response.Headers.GetValueOrDefault(\"Retry-After\", \"-1\"));\n\n                        if (retryAfter == -1)\n                        {\n                            retryAfter = Convert.ToInt32(context.Response.Headers.GetValueOrDefault(\"x-ratelimit-reset-requests\", \"-1\"));\n                        }\n\n                        if (retryAfter == -1)\n                        {\n                            retryAfter = Convert.ToInt32(context.Response.Headers.GetValueOrDefault(\"x-ratelimit-reset-tokens\", \"10\"));\n                        }\n\n                        JObject route = (JObject)routes[currentrouteIndex];\n                        route[\"isThrottling\"] = true;\n                        route[\"retryAfter\"] = DateTime.Now.AddSeconds(retryAfter);\n\n                        return routes;      \n                    }\" />\n                <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" value=\"@((JArray)context.Variables[\"routes\"])\" duration=\"86400\" />\n                <set-variable name=\"remainingRoutes\" value=\"@{\n                        JArray routes = (JArray)context.Variables[\"routes\"];\n                        string allowedBackend = (string)context.Variables.GetValueOrDefault(\"allowedBackend\", \"\");\n                        int remainingRoutes = 0;\n\n                        for (int i = 0; i < routes.Count; i++)\n                        {\n                            JObject route = (JObject)routes[i];\n                            string backendId = route.Value<string>(\"backend-id\");\n                            \n                            // Check if backend is allowed (empty allowedBackend means all are allowed)\n                            bool isBackendAllowed = string.IsNullOrEmpty(allowedBackend) || \n                                                  allowedBackend.Split(',').Contains(backendId.Trim());\n\n                            if (!route.Value<bool>(\"isThrottling\") && isBackendAllowed)\n                            {\n                                remainingRoutes++;\n                            }\n                        }\n\n                        return remainingRoutes;\n                    }\" />\n            </when>\n        </choose>\n    </retry>\n</fragment>",
            "$fxv#12": "<fragment>\n\t<!-- Usage logs for non-streaming requests only -->\n\t<choose>\n\t\t<when condition=\"@(context.Variables.GetValueOrDefault<string>(\"isStream\",\"false\").Equals(\"false\", StringComparison.OrdinalIgnoreCase))\">\n\t\t\t<!-- Set the response body as a variable to be used in various policies -->\n\t\t\t<set-variable name=\"responseBody\" value=\"@(context.Response.Body.As<JObject>())\" />\n\t\t\t<!-- Log OpenAI usage to EventHub -->\n\t\t\t<choose>\n\t\t\t\t<when condition=\"@(context.Response.StatusCode == 200)\">\n\t\t\t\t\t<log-to-eventhub logger-id=\"usage-eventhub-logger\">@{\n                    //Avoid reading response body as it can only be ready once, instead, before calling this fragement, a variable call responseBody will be set in the outbound policy\n                    //var responseBody = context.Response.Body?.As<JObject>(true); //Avoid this one\n                    var responseBody = (JObject)context.Variables[\"responseBody\"]; //It is set in the outbound policy before calling the fragment\n                    return new JObject(\n                        new JProperty(\"id\", responseBody?[\"id\"]?.ToString() ?? Guid.NewGuid().ToString()),\n                        new JProperty(\"timestamp\", DateTime.UtcNow.ToString()),\n                        new JProperty(\"appId\", (string)context.Variables.GetValueOrDefault<string>(\"appId\", \"NA\")),\n                        new JProperty(\"subscriptionId\", context.Subscription?.Id?.ToString() ?? \"Portal-Admin\"),\n                        new JProperty(\"productName\", context.Product?.Name?.ToString() ?? \"Portal-Admin\"),\n                        new JProperty(\"targetService\", responseBody?[\"object\"]?.ToString() ?? \"NA\"),\n                        new JProperty(\"model\", responseBody?[\"model\"]?.ToString() ?? \"NA\"),\n                        new JProperty(\"gatewayName\", context.Deployment?.ServiceName ?? \"NA\"),\n                        new JProperty(\"gatewayRegion\", context.Deployment?.Region ?? \"NA\"),\n                        new JProperty(\"aiGatewayId\", context.Deployment?.Gateway?.Id ?? \"NA\"),\n                        new JProperty(\"RequestIp\", context.Request?.IpAddress ?? \"NA\"),\n                        new JProperty(\"operationName\", context.Operation?.Name ?? \"NA\"),\n                        new JProperty(\"sessionId\", (string)context.Variables.GetValueOrDefault<string>(\"sessionId\", \"NA\")),\n                        new JProperty(\"endUserId\", (string)context.Variables.GetValueOrDefault<string>(\"endUserId\", \"NA\")),\n                        new JProperty(\"backendId\", (string)context.Variables.GetValueOrDefault<string>(\"backendId\", \"NA\")),\n                        new JProperty(\"routeLocation\", (string)context.Variables.GetValueOrDefault<string>(\"routeLocation\", \"NA\")),\n                        new JProperty(\"routeName\", (string)context.Variables.GetValueOrDefault<string>(\"routeName\", \"NA\")),\n                        new JProperty(\"deploymentName\", (string)context.Variables.GetValueOrDefault<string>(\"deploymentName\", \"NA\")),\n                        new JProperty(\"promptTokens\", responseBody?[\"usage\"]?[\"prompt_tokens\"]?.Value<int>() ?? 1),\n                        new JProperty(\"responseTokens\", responseBody?[\"usage\"]?[\"completion_tokens\"]?.Value<int>() ?? 0),\n                        new JProperty(\"totalTokens\", responseBody?[\"usage\"]?[\"total_tokens\"]?.Value<int>() ?? 1)\n                ).ToString();\n                }</log-to-eventhub>\n\t\t\t\t</when>\n\t\t\t</choose>\n\t\t\t<set-body>@{\n                    return ((JObject)context.Variables[\"responseBody\"]).ToString();\n            }</set-body>\n\t\t</when>\n\t</choose>\n</fragment>",
            "$fxv#13": "<fragment>\n\t<!-- Usage logs for \"streaming\" requests only -->\n\t<choose>\n\t\t<!-- Usage logs for streaming requests -->\n\t\t<when condition=\"@(context.Variables.GetValueOrDefault<string>(\"isStream\",\"false\").Equals(\"true\", StringComparison.OrdinalIgnoreCase))\">\n\t\t\t<set-variable name=\"potentialRouteIndex\" value=\"@{\n                JArray routes = (JArray)context.Variables[\"routes\"];\n                int selectedPriority = Int32.MaxValue;\n                List<int> availableRoutesIndexes = new List<int>();\n\n                for (int i = 0; i < routes.Count; i++)\n                {\n                    JObject route = (JObject)routes[i];\n\n                    if (!route.Value<bool>(\"isThrottling\"))\n                    {\n                        int routePriority = route.Value<int>(\"priority\");\n\n                        if (routePriority < selectedPriority)\n                        {\n                            selectedPriority = routePriority;\n                            availableRoutesIndexes.Clear();\n                            availableRoutesIndexes.Add(i);\n                        } \n                        else if (routePriority == selectedPriority)\n                        {\n                            availableRoutesIndexes.Add(i);\n                        }\n                    }\n                }\n\n                if (availableRoutesIndexes.Count == 1)\n                {\n                    return availableRoutesIndexes[0];\n                }\n            \n                if (availableRoutesIndexes.Count > 0)\n                {\n                    //Returns a random route from the list if we have more than one available with the same priority\n                    return availableRoutesIndexes[new Random().Next(0, availableRoutesIndexes.Count)];\n                }\n                else\n                {\n                    //If there are no available routes, the request will be sent to the first one\n                    return 0;    \n                }\n                }\" />\n\t\t\t<set-variable name=\"backendId\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"potentialRouteIndex\"]]).Value<string>(\"backend-id\"))\" />\n\t\t\t<set-variable name=\"routeLocation\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"potentialRouteIndex\"]]).Value<string>(\"location\"))\" />\n\t\t\t<set-variable name=\"routeName\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"potentialRouteIndex\"]]).Value<string>(\"name\"))\" />\n\t\t\t<set-variable name=\"deploymentName\" value=\"@((string)context.Variables[\"deployment-id\"])\" />\n\t\t\t<!-- NOTE: azure-openai-emit-token-metric has limited support to custom dimensions -->\n            <azure-openai-emit-token-metric namespace=\"ai-streaming\">\n                <dimension name=\"SubscriptionId\" value=\"@(context.Subscription?.Id ?? \"Portal-Admin-Sub\")\" />\n\t\t\t\t<dimension name=\"productName\" value=\"@(context.Product?.Name?.ToString() ?? \"Portal-Admin\")\" />\n\t\t\t\t<dimension name=\"routeName\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"routeName\", \"Streaming\"))\" />\n                <dimension name=\"routeLocation\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"routeLocation\", \"DefaultStreaming\"))\" />\n\t\t\t\t<dimension name=\"deploymentName\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deploymentName\", \"Streaming\"))\" />\n\t\t\t\t<dimension name=\"backendId\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"backendId\", \"DefaultStreaming\"))\" />\n                <!-- <dimension name=\"operationName\" value=\"@(context.Operation?.Id ?? \"Streaming\")\" /> -->\n                <!-- <dimension name=\"sessionId\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"sessionId\", \"NA\"))\" /> -->\n                <!-- <dimension name=\"endUserId\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"endUserId\", \"NA\"))\" /> -->\n                <!-- <dimension name=\"appId\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"appId\", \"NA\"))\" /> -->\n                <!-- <dimension name=\"gatewayName\" value=\"@(context.Deployment?.ServiceName ?? \"NA\")\" /> -->\n\t\t\t</azure-openai-emit-token-metric>\n\t\t</when>\n\t</choose>\n</fragment>",
            "$fxv#14": "<fragment>\n    <!-- Log OpenAI usage to EventHub -->\n    <choose>\n        <when condition=\"@(context.Response.StatusCode == 200)\">\n            <log-to-eventhub logger-id=\"usage-eventhub-logger\">@{\n            return new JObject(\n                new JProperty(\"id\", (string)context.Variables.GetValueOrDefault<string>(\"idPrefix\", \"ai\") + \"-\" + Guid.NewGuid().ToString()),\n                new JProperty(\"timestamp\", DateTime.UtcNow.ToString()),\n                new JProperty(\"appId\", (string)context.Variables.GetValueOrDefault<string>(\"appId\", \"NA\")),\n                new JProperty(\"subscriptionId\", context.Subscription?.Id?.ToString() ?? \"Portal-Admin\"),\n                new JProperty(\"productName\", context.Product?.Name?.ToString() ?? \"Portal-Admin\"),\n                new JProperty(\"targetService\", (string)context.Variables.GetValueOrDefault<string>(\"targetService\", \"NA\")),\n                new JProperty(\"model\", (string)context.Variables.GetValueOrDefault<string>(\"model\", \"NA\")),\n                new JProperty(\"gatewayName\", context.Deployment?.ServiceName ?? \"NA\"),\n                new JProperty(\"gatewayRegion\", context.Deployment?.Region ?? \"NA\"),\n                new JProperty(\"aiGatewayId\", context.Deployment?.Gateway?.Id ?? \"NA\"),\n                new JProperty(\"RequestIp\", context.Request?.IpAddress ?? \"NA\"),\n                new JProperty(\"operationName\", context.Operation?.Name ?? \"NA\"),\n                new JProperty(\"sessionId\", (string)context.Variables.GetValueOrDefault<string>(\"sessionId\", \"NA\")),\n                new JProperty(\"endUserId\", (string)context.Variables.GetValueOrDefault<string>(\"endUserId\", \"NA\")),\n                new JProperty(\"backendId\", (string)context.Variables.GetValueOrDefault<string>(\"backendId\", \"NA\")),\n                new JProperty(\"routeLocation\", (string)context.Variables.GetValueOrDefault<string>(\"routeLocation\", \"NA\")),\n                new JProperty(\"routeName\", (string)context.Variables.GetValueOrDefault<string>(\"routeName\", \"NA\")),\n                new JProperty(\"deploymentName\", (string)context.Variables.GetValueOrDefault<string>(\"deploymentName\", \"NA\")),\n                new JProperty(\"promptTokens\", (int)context.Variables.GetValueOrDefault<int>(\"promptTokens\", 1)),\n                new JProperty(\"responseTokens\", (int)context.Variables.GetValueOrDefault<int>(\"responseTokens\", 0)),\n                new JProperty(\"totalTokens\", (int)context.Variables.GetValueOrDefault<int>(\"totalTokens\", 1))\n        ).ToString();\n        }</log-to-eventhub>\n        </when>\n    </choose>\n</fragment>",
            "$fxv#15": "<fragment>\n    <choose>\n        <when condition=\"@(context.Response.StatusCode == 429)\">\n            <emit-metric name=\"AI Throttling\" value=\"1\" namespace=\"throttling-events\">\n                <dimension name=\"API ID\" />\n                <dimension name=\"Operation ID\" />\n                <!-- <dimension name=\"Subscription ID\" /> -->\n                <dimension name=\"Location\" />\n                <dimension name=\"Product Name\" value=\"@(context.Product?.Name?.ToString() ?? \"Portal-Admin\")\" />\n                <dimension name=\"Deployment Name\" value=\"@((string)context.Variables[\"target-deployment\"])\" />\n                <dimension name=\"Service Name\" value=\"@((string)context.Variables[\"service-name\"] ?? \"NA\")\" />\n            </emit-metric>\n        </when>\n    </choose>\n</fragment>",
            "$fxv#16": "<fragment>\n    <set-variable name=\"routes\" value=\"@{\n                JArray routes = (JArray)context.Variables[\"routes\"];\n                JArray outputRoutes = new JArray();\n                string activeBackendId = (string)context.Variables[\"backendId\"];\n                string targetDeployment = (string)context.Variables[\"deployment-id\"];\n                for (int i = 0; i < routes.Count; i++)\n                {\n                    JObject route = (JObject)routes[i];\n                    int targetTPMLimit = route.Value<int?>(\"targetTPMLimit\") ?? -1;\n                    int consumedTPM = route.Value<int?>(\"consumedTPM\") ?? 0;\n\n                    if (targetTPMLimit == -1)\n                    {\n                        outputRoutes.Add(route);\n                        continue;\n                    }\n\n                    string consumedTokensKey = route.Value<string>(\"backend-id\") + \"-\" + targetDeployment + \"-ConsumedTokens\";\n                    string remainingTokensKey = route.Value<string>(\"backend-id\") + \"-\" + targetDeployment + \"-RemainingTokens\";\n                    \n                    if (context.Variables.ContainsKey(consumedTokensKey) && route[\"backend-id\"].ToString() == activeBackendId)\n                    {\n                        int requestConsumedTokens = (int)context.Variables[consumedTokensKey];\n                        int remainingTokens = (int)context.Variables[remainingTokensKey];\n                        \n                        // Calcualting the total consumed tokens so far\n                        int consumedTokens = 1000000 - remainingTokens - requestConsumedTokens;\n\n                        double consumedPercentage = (double)consumedTokens / (double)targetTPMLimit;\n                        \n                        route[\"consumedPercentage\"] = consumedPercentage;\n\n                        if (consumedPercentage > 0.8)\n                        {\n                            if((bool)route[\"isThrottling\"] == false)\n                            {\n                                route[\"isThrottling\"] = true;\n                                route[\"retryAfter\"] = DateTime.Now.AddSeconds(30);\n                            }\n                        }\n                        else\n                        {\n                            route[\"isThrottling\"] = false;\n                            route[\"retryAfter\"] = DateTime.MinValue;\n                        }\n                    }\n                    \n                    outputRoutes.Add(route);\n                }\n\n                return outputRoutes; \n            }\" />\n    <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" value=\"@((JArray)context.Variables[\"routes\"])\" duration=\"86400\" />\n</fragment>",
            "$fxv#17": "<fragment>\n    <choose>\n        <when condition=\"@(context.Variables.GetValueOrDefault<string>(\"piiAnonymizationEnabled\") == \"true\")\">\n            <!-- Get configuration values -->\n            <set-variable name=\"piiConfidenceThreshold\" value=\"@(double.Parse(context.Variables.GetValueOrDefault<string>(\"piiConfidenceThreshold\", \"0.8\")))\" />\n            <set-variable name=\"piiEntityCategoryExclusions\" value=\"@(context.Variables.GetValueOrDefault<string>(\"piiEntityCategoryExclusions\", \"\"))\" />\n            <set-variable name=\"piiDetectionLanguage\" value=\"@(context.Variables.GetValueOrDefault<string>(\"piiDetectionLanguage\", \"en\"))\" />\n            <!-- <authentication-managed-identity resource=\"https://cognitiveservices.azure.com\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" /> -->\n            <authentication-managed-identity resource=\"https://cognitiveservices.azure.com\" output-token-variable-name=\"msi-access-token\" ignore-error=\"false\" />\n            \n            <!-- Process regex patterns if provided -->\n            <set-variable name=\"piiRegexMappings\" value=\"@{\n                var content = context.Variables.GetValueOrDefault<string>(\"piiInputContent\");\n                var regexPatterns = context.Variables.GetValueOrDefault<string>(\"piiRegexPatterns\");\n                var mappings = new JArray();\n                \n                if (!string.IsNullOrEmpty(regexPatterns))\n                {\n                    var patterns = JArray.Parse(regexPatterns);\n                    var categoryCounts = new Dictionary<string, int>();\n                    var processedTexts = new HashSet<string>(); // Track already processed texts\n                    \n                    foreach (var pattern in patterns)\n                    {\n                        var regex = new Regex(pattern[\"pattern\"].ToString());\n                        var category = pattern[\"category\"].ToString();\n                        \n                        if (!categoryCounts.ContainsKey(category))\n                        {\n                            categoryCounts[category] = 0;\n                        }\n                        \n                        var matches = regex.Matches(content);\n                        foreach (Match match in matches)\n                        {\n                            if (!string.IsNullOrEmpty(match.Value))\n                            {\n                                // Skip if we already have a mapping for this text\n                                if (processedTexts.Contains(match.Value))\n                                {\n                                    continue;\n                                }\n                                \n                                var placeholder = $\"<{category}_{categoryCounts[category]}>\";\n                                mappings.Add(new JObject {\n                                    [\"original\"] = match.Value,\n                                    [\"placeholder\"] = placeholder,\n                                    [\"source\"] = \"regex\"\n                                });\n                                categoryCounts[category]++;\n                                processedTexts.Add(match.Value); // Mark this text as processed\n                            }\n                        }\n                    }\n                }\n                return mappings.ToString();\n            }\" />\n\n            <!-- Apply regex-based masking -->\n            <set-variable name=\"piiRegexProcessedContent\" value=\"@{\n                var content = context.Variables.GetValueOrDefault<string>(\"piiInputContent\");\n                var mappings = JArray.Parse(\n                    context.Variables.GetValueOrDefault<string>(\"piiRegexMappings\"));\n                \n                foreach (var mapping in mappings)\n                {\n                    content = content.Replace(\n                        mapping[\"original\"].ToString(),\n                        mapping[\"placeholder\"].ToString()\n                    );\n                }\n                return content;\n            }\" />\n\n            <!-- Update input content for API processing -->\n            <set-variable name=\"piiInputContent\" value=\"@(context.Variables.GetValueOrDefault<string>(\"piiRegexProcessedContent\"))\" />\n            \n            <!-- Call PII Anonymization API -->\n            <send-request mode=\"new\" response-variable-name=\"piiAnalysisResponse\" timeout=\"20\" ignore-error=\"true\">\n                <set-url>{{piiServiceUrl}}/language/:analyze-text?api-version=2022-05-01</set-url>\n                <set-method>POST</set-method>\n                <set-header name=\"Content-Type\" exists-action=\"override\">\n                    <value>application/json</value>\n                </set-header>\n                <set-header name=\"Authorization\" exists-action=\"override\">\n                    <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\n                </set-header>\n                <!-- <set-header name=\"Ocp-Apim-Subscription-Key\" exists-action=\"override\">\n                    <value>{{piiServiceKey}}</value>\n                </set-header> -->\n\n                <set-body>@{\n                    var request = new JObject();\n                    request[\"kind\"] = \"PiiEntityRecognition\";\n                    request[\"parameters\"] = new JObject{\n                        {\"modelVersion\", \"latest\"},\n                        {\"redactionPolicy\", new JObject{\n                            {\"policyKind\", \"CharacterMask\"},\n                            {\"redactionCharacter\", \"#\"}\n                        }}\n                    };\n                    request[\"analysisInput\"] = new JObject{\n                        {\"documents\", new JArray{\n                            new JObject{\n                                {\"text\", context.Variables.GetValueOrDefault<string>(\"piiInputContent\")},\n                                {\"id\", \"1\"},\n                                {\"language\", context.Variables.GetValueOrDefault<string>(\"piiDetectionLanguage\")}\n                            }\n                        }}\n                    };\n                    return request.ToString();\n                }</set-body>\n            </send-request>\n            <!-- Process PII Analysis Response and store mappings -->\n            <set-variable name=\"piiMappings\" value=\"@{\n                var response = context.Variables.GetValueOrDefault<IResponse>(\"piiAnalysisResponse\");\n                var confidenceThreshold = context.Variables.GetValueOrDefault<double>(\"piiConfidenceThreshold\");\n                var exclusions = context.Variables.GetValueOrDefault<string>(\"piiEntityCategoryExclusions\")\n                    .Split(new[] { ',' }, StringSplitOptions.RemoveEmptyEntries)\n                    .Select(c => c.Trim())\n                    .ToList();\n                \n                var entities = JObject.Parse(response.Body.As<string>())\n                    .SelectToken(\"$.results.documents[0].entities\")\n                    .ToObject<JArray>()\n                    .Where(e => e[\"confidenceScore\"].Value<double>() >= confidenceThreshold)\n                    .Where(e => !exclusions.Contains(e[\"category\"].ToString()))\n                    .OrderByDescending(e => e[\"text\"].ToString().Length);\n                \n                var mappings = new JArray();\n                var categoryCounts = new Dictionary<string, int>();\n                var processedTexts = new HashSet<string>(); // Track already processed texts\n                \n                foreach (var entity in entities) {\n                    var text = entity[\"text\"].ToString().TrimEnd('.', ',', ' ');\n                    \n                    // Skip if this text has already been processed\n                    if (processedTexts.Contains(text)) {\n                        continue;\n                    }\n                    \n                    var category = entity[\"category\"].ToString();\n                    \n                    if (!categoryCounts.ContainsKey(category)) {\n                        categoryCounts[category] = 0;\n                    }\n                    \n                    var placeholder = $\"<{category}_{categoryCounts[category]}>\";\n                    mappings.Add(new JObject {\n                        [\"original\"] = text,\n                        [\"placeholder\"] = placeholder\n                    });\n                    \n                    categoryCounts[category]++;\n                    processedTexts.Add(text); // Mark this text as processed\n                }\n                \n                return mappings.ToString();\n            }\" />\n\n            <!-- Merge API and regex mappings -->\n            <set-variable name=\"piiMappings\" value=\"@{\n                var apiMappings = JArray.Parse(context.Variables.GetValueOrDefault<string>(\"piiMappings\") ?? \"[]\");\n                var regexMappings = JArray.Parse(context.Variables.GetValueOrDefault<string>(\"piiRegexMappings\") ?? \"[]\");\n                \n                foreach (var mapping in regexMappings)\n                {\n                    apiMappings.Add(mapping);\n                }\n                \n                return apiMappings.ToString();\n            }\" />\n\n            <!-- Replace PII with placeholders and set output variable -->\n            <set-variable name=\"piiAnonymizedContent\" value=\"@{\n                var content = context.Variables.GetValueOrDefault<string>(\"piiInputContent\");\n                var mappings = JArray.Parse(\n                    context.Variables.GetValueOrDefault<string>(\"piiMappings\"));\n                    \n                foreach (var mapping in mappings) {\n                    var original = mapping[\"original\"].ToString();\n                    var placeholder = mapping[\"placeholder\"].ToString();\n                    content = content.Replace(original, placeholder);\n                }\n                \n                return content;\n            }\" />\n        </when>\n        <otherwise>\n            <!-- When PII anonymization is disabled, just pass through the original content -->\n            <set-variable name=\"piiAnonymizedContent\" value=\"@(context.Variables.GetValueOrDefault<string>(\"piiInputContent\"))\" />\n        </otherwise>\n    </choose>\n</fragment>",
            "$fxv#18": "<fragment>\n    <!-- Replace placeholders with original PII -->\n    <set-variable name=\"piiDeanonymizedContentOutput\" value=\"@{\n        var content = context.Variables.GetValueOrDefault<string>(\"piiDeanonymizeContentInput\");\n        \n        // Pre-process content to replace common encoded symbols\n        content = System.Text.RegularExpressions.Regex.Replace(content, @\"\\\\u003c\", \"<\");\n        content = System.Text.RegularExpressions.Regex.Replace(content, @\"\\\\u003e\", \">\");\n        \n        var mappings = JArray.Parse(\n            context.Variables.GetValueOrDefault<string>(\"piiMappings\"));\n        \n        foreach (var mapping in mappings) {\n            var original = mapping[\"original\"].ToString();\n            var placeholder = mapping[\"placeholder\"].ToString();\n            content = content.Replace(placeholder, original);\n        }\n        return content;\n    }\" />\n</fragment>",
            "$fxv#19": "<fragment>\n    <!-- Save PII anonymization/deanonymization state to Event Hub using native log-to-eventhub policy -->\n    <choose>\n        <when condition=\"@(context.Variables.GetValueOrDefault<string>(\"piiStateSavingEnabled\") == \"true\")\">\n            <!-- Capture context information -->\n            <set-variable name=\"piiOperationId\" value=\"@(Guid.NewGuid().ToString())\" />\n            <set-variable name=\"piiOperationTimestamp\" value=\"@(DateTime.UtcNow.ToString(\"o\"))\" />\n            <set-variable name=\"piiApiName\" value=\"@(context.Api.Name ?? \"unknown\")\" />\n            <set-variable name=\"piiApiId\" value=\"@(context.Api.Id ?? \"unknown\")\" />\n            <set-variable name=\"piiProductName\" value=\"@(context.Product?.Name ?? \"unknown\")\" />\n            <set-variable name=\"piiProductId\" value=\"@(context.Product?.Id ?? \"unknown\")\" />\n            <set-variable name=\"piiSubscriptionName\" value=\"@(context.Subscription?.Name ?? \"unknown\")\" />\n            <set-variable name=\"piiSubscriptionId\" value=\"@(context.Subscription?.Id ?? \"unknown\")\" />\n            <set-variable name=\"piiOperationName\" value=\"@(context.Operation.Name ?? \"unknown\")\" />\n            <set-variable name=\"targetDeployment\" value=\"@(context.Variables.GetValueOrDefault<string>(\"targetDeployment\") ?? \"unknown\")\" />\n            \n            <!-- Log to Event Hub using native policy -->\n            <log-to-eventhub logger-id=\"pii-usage-eventhub-logger\">@{\n                var eventData = new JObject();\n                \n                // Operation metadata\n                eventData[\"id\"] = context.Variables.GetValueOrDefault<string>(\"piiOperationId\");\n                eventData[\"timestamp\"] = context.Variables.GetValueOrDefault<string>(\"piiOperationTimestamp\");\n                eventData[\"type\"] = \"PII_Processing\";\n                eventData[\"targetDeployment\"] = context.Variables.GetValueOrDefault<string>(\"targetDeployment\");\n                // Enhanced API and subscription context with content\n                eventData[\"context\"] = new JObject {\n                    [\"api\"] = new JObject {\n                        [\"id\"] = context.Variables.GetValueOrDefault<string>(\"piiApiId\"),\n                        [\"name\"] = context.Variables.GetValueOrDefault<string>(\"piiApiName\"),\n                        [\"operation\"] = new JObject {\n                            [\"id\"] = context.Operation.Id ?? \"unknown\",\n                            [\"name\"] = context.Variables.GetValueOrDefault<string>(\"piiOperationName\"),\n                            [\"method\"] = context.Operation.Method ?? \"unknown\",\n                            [\"urlTemplate\"] = context.Operation.UrlTemplate ?? \"unknown\"\n                        },\n                        [\"content\"] = new JObject {\n                            [\"originalRequest\"] = context.Variables.GetValueOrDefault<string>(\"piiInputContent\"),\n                            [\"anonymizedRequest\"] = context.Variables.GetValueOrDefault<string>(\"piiAnonymizedContent\"),\n                            [\"originalResponse\"] = context.Variables.GetValueOrDefault<string>(\"originalResponse\"),\n                            [\"deanonymizedResponse\"] = context.Variables.GetValueOrDefault<string>(\"piiDeanonymizedContentOutput\")\n                        }\n                    },\n                    [\"product\"] = new JObject {\n                        [\"id\"] = context.Variables.GetValueOrDefault<string>(\"piiProductId\"),\n                        [\"name\"] = context.Variables.GetValueOrDefault<string>(\"piiProductName\")\n                    },\n                    [\"subscription\"] = new JObject {\n                        [\"id\"] = context.Variables.GetValueOrDefault<string>(\"piiSubscriptionId\"),\n                        [\"name\"] = context.Variables.GetValueOrDefault<string>(\"piiSubscriptionName\")\n                    }\n                };\n                \n                // Process information\n                eventData[\"process\"] = new JObject {\n                    [\"anonymizationEnabled\"] = context.Variables.GetValueOrDefault<string>(\"piiAnonymizationEnabled\") == \"true\",\n                    [\"confidenceThreshold\"] = context.Variables.GetValueOrDefault<double>(\"piiConfidenceThreshold\", 0.8),\n                    [\"entityCategoryExclusions\"] = context.Variables.GetValueOrDefault<string>(\"piiEntityCategoryExclusions\", \"\"),\n                    [\"deanonymizationPerformed\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\")\n                };\n                \n                // Results summary\n                var mappings = new JArray();\n                if (context.Variables.ContainsKey(\"piiMappings\")) {\n                    try {\n                        mappings = JArray.Parse(context.Variables.GetValueOrDefault<string>(\"piiMappings\"));\n                        eventData[\"entityCount\"] = mappings.Count;\n                        \n                        // Group entities by category for reporting\n                        var categories = new Dictionary<string, int>();\n                        foreach (var mapping in mappings) {\n                            var placeholder = mapping[\"placeholder\"].ToString();\n                            var category = placeholder.TrimStart('<').Split('_')[0];\n                            \n                            if (!categories.ContainsKey(category)) {\n                                categories[category] = 0;\n                            }\n                            categories[category]++;\n                        }\n                        \n                        var categoryDetails = new JObject();\n                        foreach (var category in categories) {\n                            categoryDetails[category.Key] = category.Value;\n                        }\n                        eventData[\"entityCategories\"] = categoryDetails;\n                        \n                        // Include mappings for detailed audit (can be removed if too verbose)\n                        eventData[\"mappings\"] = mappings;\n                    }\n                    catch (Exception ex) {\n                        eventData[\"error\"] = \"Failed to process mappings: \" + ex.Message;\n                    }\n                }\n                \n                // Content length metrics (not the actual content)\n                if (context.Variables.ContainsKey(\"piiInputContent\")) {\n                    eventData[\"metrics\"] = new JObject {\n                        [\"inputContentLength\"] = context.Variables.GetValueOrDefault<string>(\"piiInputContent\", \"\").Length\n                    };\n                    \n                    if (context.Variables.ContainsKey(\"piiAnonymizedContent\")) {\n                        eventData[\"metrics\"][\"anonymizedContentLength\"] = \n                            context.Variables.GetValueOrDefault<string>(\"piiAnonymizedContent\", \"\").Length;\n                    }\n                    \n                    // Add deanonymization metrics\n                    if (context.Variables.ContainsKey(\"piiDeanonymizeContentInput\")) {\n                        eventData[\"metrics\"][\"deanonymizeInputLength\"] = \n                            context.Variables.GetValueOrDefault<string>(\"piiDeanonymizeContentInput\", \"\").Length;\n                    }\n                    \n                    if (context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\")) {\n                        eventData[\"metrics\"][\"deanonymizedOutputLength\"] = \n                            context.Variables.GetValueOrDefault<string>(\"piiDeanonymizedContentOutput\", \"\").Length;\n                    }\n                }\n                \n                // Add deanonymization flow details\n                eventData[\"deanonymization\"] = new JObject {\n                    [\"performed\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\"),\n                    [\"inputSource\"] = context.Variables.ContainsKey(\"piiDeanonymizeContentInput\") ? \"present\" : \"missing\",\n                    [\"status\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\") ? \"completed\" : \"not_performed\",\n                    [\"timestamp\"] = DateTime.UtcNow.ToString(\"o\")\n                };\n                \n                // Track end-to-end flow\n                eventData[\"processingFlow\"] = new JObject {\n                    [\"anonymization\"] = new JObject {\n                        [\"performed\"] = context.Variables.ContainsKey(\"piiAnonymizedContent\"),\n                        [\"entityCount\"] = context.Variables.ContainsKey(\"piiMappings\") ? \n                            JArray.Parse(context.Variables.GetValueOrDefault<string>(\"piiMappings\")).Count : 0\n                    },\n                    [\"deanonymization\"] = new JObject {\n                        [\"performed\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\"),\n                        [\"success\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\")\n                    }\n                };\n                \n                return eventData.ToString();\n            }</log-to-eventhub>\n        </when>\n    </choose>\n</fragment>\n",
            "$fxv#2": "openapi: 3.0.1\ninfo:\n  title: AI Model Inference API\n  description: Reference for Azure AI Model Inference API\n  license:\n    name: MIT\n    url: https://opensource.org/licenses/MIT\n  version: '1.0'\nservers:\n  - url: https://REPLACE.services.ai.azure.com/models\npaths:\n  /info:\n    get:\n      summary: Get model information\n      description: Returns the information about the model deployed under the endpoint.\n      operationId: get-info-api-version-api-version\n      parameters:\n        - name: api-version\n          in: query\n          description: The version of the API in the format \"YYYY-MM-DD\" or \"YYYY-MM-DD-preview\".\n          required: true\n          schema:\n            enum:\n              - 2024-05-01-preview\n            type: string\n            default: 2024-05-01-preview\n        - name: Authorization\n          in: header\n          schema:\n            enum:\n              - ''\n            type: ''\n        - name: azureml-model-deployment\n          in: header\n          schema:\n            enum:\n              - ''\n            type: ''\n            default: ''\n      responses:\n        '200':\n          description: OK\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ModelInfo'\n              example:\n                model_name: string\n                model_provider_name: string\n                model_type: audio-generation\n  /chat/completions:\n    post:\n      summary: Create chat completion\n      description: Creates a model response for the given chat conversation.\n      operationId: post-chat-completions-api-version-api-version\n      parameters:\n        - name: api-version\n          in: query\n          description: The version of the API in the format \"YYYY-MM-DD\" or \"YYYY-MM-DD-preview\".\n          required: true\n          schema:\n            enum:\n              - 2024-05-01-preview\n            type: string\n            default: 2024-05-01-preview\n        - name: x-ms-model-mesh-model-name\n          in: header\n          description: Name of the target deployment model name (like phi-4)\n          required: true\n          schema:\n            enum:\n              - ''\n            type: ''\n            default: ''\n      requestBody:\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateChatCompletionRequest'\n            example:\n              messages:\n                - role: system\n                  content: You are a helpful assistant\n                - role: user\n                  content: Explain how distance between earth and the moon is calculated.\n              frequency_penalty: 0\n              presence_penalty: 0\n              max_tokens: 256\n              seed: 42\n              stop: <|endoftext|>\n              stream: false\n              temperature: 0\n              top_p: 1\n              response_format:\n                type: text\n      responses:\n        '200':\n          description: OK\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/CreateChatCompletionResponse'\n              example:\n                choices:\n                  - finish_reason: stop\n                    index: 0\n                    message:\n                      content: string\n                      role: assistant\n                      tool_calls:\n                        - function:\n                            arguments: string\n                            name: string\n                          id: string\n                          type: function\n                created: 0\n                id: string\n                model: string\n                object: chat.completion\n                system_fingerprint: string\n                usage:\n                  completion_tokens: 0\n                  prompt_tokens: 0\n                  total_tokens: 0\n        '401':\n          description: Unauthorized\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/UnauthorizedError'\n              example:\n                error: string\n                message: string\n                status: 0\n        '404':\n          description: Not Found\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/NotFoundError'\n              example:\n                error: string\n                message: string\n                status: 0\n        '422':\n          description: Unprocessable Entity\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/UnprocessableContentError'\n              example:\n                code: string\n                detail:\n                  loc:\n                    - string\n                  value: string\n                error: string\n                message: string\n                status: 0\n        '429':\n          description: Too Many Requests\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/TooManyRequestsError'\n              example:\n                error: string\n                message: string\n                status: 0\n        '500':\n          description: Content Filter Error\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ContentFilterError'\n              example:\n                code: string\n                error: string\n                message: string\n                param: string\n                status: 0\n  /embeddings:\n    post:\n      summary: Create text embeddings\n      description: Creates an embedding vector representing the input text.\n      operationId: post-embeddings-api-version-api-version\n      parameters:\n        - name: api-version\n          in: query\n          description: The version of the API in the format \"YYYY-MM-DD\" or \"YYYY-MM-DD-preview\".\n          required: true\n          schema:\n            enum:\n              - 2024-05-01-preview\n            type: string\n            default: 2024-05-01-preview\n        - name: x-ms-model-mesh-model-name\n          in: header\n          description: Name of the target AI deployment name\n          required: true\n          schema:\n            enum:\n              - ''\n            type: ''\n            default: ''\n      requestBody:\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateEmbeddingRequest'\n            example:\n              input:\n                - This is a very good text\n              input_type: text\n              encoding_format: float\n              dimensions: 1024\n      responses:\n        '200':\n          description: OK\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/CreateEmbeddingResponse'\n              example:\n                data:\n                  - embedding:\n                      - 0\n                    index: 0\n                    object: embedding\n                model: string\n                object: list\n                usage:\n                  prompt_patches: 0\n                  prompt_tokens: 0\n                  total_patches: 0\n                  total_tokens: 0\n        '401':\n          description: Unauthorized\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/UnauthorizedError'\n              example:\n                error: string\n                message: string\n                status: 0\n        '404':\n          description: Not Found\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/NotFoundError'\n              example:\n                error: string\n                message: string\n                status: 0\n        '422':\n          description: Unprocessable Entity\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/UnprocessableContentError'\n              example:\n                code: string\n                detail:\n                  loc:\n                    - string\n                  value: string\n                error: string\n                message: string\n                status: 0\n        '429':\n          description: Too Many Requests\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/TooManyRequestsError'\n              example:\n                error: string\n                message: string\n                status: 0\n        '500':\n          description: Content Filter Error\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ContentFilterError'\n              example:\n                code: string\n                error: string\n                message: string\n                param: string\n                status: 0\n  /images/embeddings:\n    post:\n      summary: Create image embeddings\n      description: Creates an embedding vector representing the input image and text pair.\n      operationId: post-images-embeddings-api-version-api-version\n      parameters:\n        - name: api-version\n          in: query\n          description: The version of the API in the format \"YYYY-MM-DD\" or \"YYYY-MM-DD-preview\".\n          required: true\n          schema:\n            enum:\n              - 2024-05-01-preview\n            type: string\n            default: 2024-05-01-preview\n        - name: x-ms-model-mesh-model-name\n          in: header\n          description: Target AI deployment name\n          required: true\n          schema:\n            enum:\n              - ''\n            type: ''\n      requestBody:\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateImageEmbeddingRequest'\n            example:\n              input:\n                - image: string\n                  text: string\n              dimensions: 0\n              encoding_format: base64\n      responses:\n        '200':\n          description: OK\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/CreateEmbeddingResponse'\n              example:\n                data:\n                  - embedding:\n                      - 0\n                    index: 0\n                    object: embedding\n                model: string\n                object: list\n                usage:\n                  prompt_patches: 0\n                  prompt_tokens: 0\n                  total_patches: 0\n                  total_tokens: 0\n        '401':\n          description: Unauthorized\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/UnauthorizedError'\n              example:\n                error: string\n                message: string\n                status: 0\n        '404':\n          description: Not Found\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/NotFoundError'\n              example:\n                error: string\n                message: string\n                status: 0\n        '422':\n          description: Unprocessable Entity\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/UnprocessableContentError'\n              example:\n                code: string\n                detail:\n                  loc:\n                    - string\n                  value: string\n                error: string\n                message: string\n                status: 0\n        '429':\n          description: Too Many Requests\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/TooManyRequestsError'\n              example:\n                error: string\n                message: string\n                status: 0\n        '500':\n          description: Content Filter Error\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ContentFilterError'\n              example:\n                code: string\n                error: string\n                message: string\n                param: string\n                status: 0\ncomponents:\n  schemas:\n    ModelInfo:\n      type: object\n      properties:\n        model_name:\n          type: string\n          description: The name of the model.\n        model_provider_name:\n          type: string\n          description: The provider of the model.\n        model_type:\n          $ref: '#/components/schemas/ModelType'\n    ModelType:\n      enum:\n        - audio-generation\n        - chat-completions\n        - embeddings\n        - image-embeddings\n        - image-generation\n        - text-generation\n      type: string\n    CreateChatCompletionRequest:\n      type: object\n      properties:\n        model:\n          type: string\n          description: The model name. This parameter is ignored if the endpoint serves only one model.\n        messages:\n          type: array\n          items:\n            $ref: '#/components/schemas/ChatCompletionRequestMessage'\n          description: A list of messages comprising the conversation so far.\n        frequency_penalty:\n          type: number\n          description: Helps prevent word repetitions by reducing the chance of a word being selected if it has already been used.\n        max_tokens:\n          type: integer\n          description: The maximum number of tokens that can be generated in the chat completion.\n        presence_penalty:\n          type: number\n          description: Helps prevent the same topics from being repeated by penalizing a word if it exists in the completion already.\n        response_format:\n          $ref: '#/components/schemas/ChatCompletionResponseFormat'\n        seed:\n          type: integer\n          description: 'If specified, our system will make a best effort to sample deterministically.'\n        stop:\n          type: array\n          items:\n            type: string\n          description: Sequences where the API will stop generating further tokens.\n        stream:\n          type: boolean\n          description: 'If set, partial message deltas will be sent.'\n        temperature:\n          type: number\n          description: Non-negative number.\n        tool_choice:\n          $ref: '#/components/schemas/ChatCompletionToolChoiceOption'\n        tools:\n          type: array\n          items:\n            $ref: '#/components/schemas/ChatCompletionTool'\n          description: A list of tools the model may call.\n        top_p:\n          type: number\n          description: 'An alternative to sampling with temperature, called nucleus sampling.'\n    ChatCompletionRequestMessage:\n      type: object\n      properties:\n        content:\n          type: string\n          description: The contents of the message.\n        role:\n          $ref: '#/components/schemas/ChatMessageRole'\n        tool_calls:\n          type: array\n          items:\n            $ref: '#/components/schemas/ChatCompletionMessageToolCall'\n    ChatMessageRole:\n      enum:\n        - assistant\n        - system\n        - tool\n        - user\n      type: string\n    ChatCompletionResponseFormat:\n      type: object\n      properties:\n        type:\n          $ref: '#/components/schemas/ChatCompletionResponseFormatType'\n    ChatCompletionResponseFormatType:\n      enum:\n        - json_object\n        - text\n      type: string\n    ChatCompletionToolChoiceOption:\n      enum:\n        - none\n        - auto\n        - required\n      type: string\n    ChatCompletionTool:\n      type: object\n      properties:\n        function:\n          $ref: '#/components/schemas/FunctionObject'\n        type:\n          $ref: '#/components/schemas/ToolType'\n    FunctionObject:\n      type: object\n      properties:\n        description:\n          type: string\n          description: A description of what the function does.\n        name:\n          type: string\n          description: The name of the function to be called.\n        parameters:\n          type: object\n          description: 'The parameters the functions accepts, described as a JSON Schema object.'\n    ToolType:\n      enum:\n        - function\n      type: string\n    CreateChatCompletionResponse:\n      type: object\n      properties:\n        choices:\n          type: array\n          items:\n            $ref: '#/components/schemas/Choices'\n        created:\n          type: integer\n          description: The Unix timestamp (in seconds) of when the chat completion was created.\n        id:\n          type: string\n          description: A unique identifier for the chat completion.\n        model:\n          type: string\n          description: The model used for the chat completion.\n        object:\n          $ref: '#/components/schemas/ChatCompletionObject'\n        system_fingerprint:\n          type: string\n          description: This fingerprint represents the backend configuration that the model runs with.\n        usage:\n          $ref: '#/components/schemas/CompletionUsage'\n    Choices:\n      type: object\n      properties:\n        finish_reason:\n          $ref: '#/components/schemas/ChatCompletionFinishReason'\n        index:\n          type: integer\n          description: The index of the choice in the list of choices.\n        message:\n          $ref: '#/components/schemas/ChatCompletionResponseMessage'\n    ChatCompletionFinishReason:\n      enum:\n        - stop\n        - length\n        - content_filter\n        - tool_calls\n      type: string\n    ChatCompletionResponseMessage:\n      type: object\n      properties:\n        content:\n          type: string\n          description: The contents of the message.\n        role:\n          $ref: '#/components/schemas/ChatMessageRole'\n        tool_calls:\n          type: array\n          items:\n            $ref: '#/components/schemas/ChatCompletionMessageToolCall'\n    ChatCompletionMessageToolCall:\n      type: object\n      properties:\n        function:\n          $ref: '#/components/schemas/Function'\n        id:\n          type: string\n          description: The ID of the tool call.\n        type:\n          $ref: '#/components/schemas/ToolType'\n    Function:\n      type: object\n      properties:\n        arguments:\n          type: string\n          description: 'The arguments to call the function with, as generated by the model in JSON format.'\n        name:\n          type: string\n          description: The name of the function to call.\n    ChatCompletionObject:\n      enum:\n        - chat.completion\n      type: string\n    CompletionUsage:\n      type: object\n      properties:\n        completion_tokens:\n          type: integer\n          description: Number of tokens in the generated completion.\n        prompt_tokens:\n          type: integer\n          description: Number of tokens in the prompt.\n        total_tokens:\n          type: integer\n          description: Total number of tokens used in the request (prompt + completion).\n    CreateEmbeddingRequest:\n      type: object\n      properties:\n        model:\n          type: string\n          description: The model name. This parameter is ignored if the endpoint serves only one model.\n        input:\n          type: array\n          items:\n            type: string\n          description: 'Input text to embed, encoded as a string or array of tokens.'\n        dimensions:\n          type: integer\n          description: The number of dimensions the resulting output embeddings should have.\n        encoding_format:\n          $ref: '#/components/schemas/EmbeddingEncodingFormat'\n        input_type:\n          $ref: '#/components/schemas/EmbeddingInputType'\n    CreateEmbeddingResponse:\n      type: object\n      properties:\n        data:\n          type: array\n          items:\n            $ref: '#/components/schemas/Embedding'\n        model:\n          type: string\n          description: The name of the model used to generate the embedding.\n        object:\n          $ref: '#/components/schemas/ListObject'\n        usage:\n          $ref: '#/components/schemas/Usage'\n    Embedding:\n      type: object\n      properties:\n        embedding:\n          type: array\n          items:\n            type: number\n          description: The embedding vector.\n        index:\n          type: integer\n          description: The index of the embedding in the list of embeddings.\n        object:\n          $ref: '#/components/schemas/EmbeddingObject'\n    EmbeddingEncodingFormat:\n      enum:\n        - base64\n        - float\n        - int8\n        - uint8\n        - binary\n        - ubinary\n      type: string\n    EmbeddingInputType:\n      enum:\n        - text\n        - query\n        - document\n      type: string\n    EmbeddingObject:\n      enum:\n        - embedding\n      type: string\n    ListObject:\n      enum:\n        - list\n      type: string\n    CreateImageEmbeddingRequest:\n      type: object\n      properties:\n        input:\n          type: array\n          items:\n            $ref: '#/components/schemas/EmbeddingInput'\n          description: Input image to embed.\n        dimensions:\n          type: integer\n          description: The number of dimensions the resulting output embeddings should have.\n        encoding_format:\n          $ref: '#/components/schemas/EmbeddingEncodingFormat'\n    EmbeddingInput:\n      type: object\n      properties:\n        image:\n          type: string\n          description: The input image encoded in `base64` string as a data URL.\n        text:\n          type: string\n          description: Optional. The text input to feed into the model.\n    UnauthorizedError:\n      type: object\n      properties:\n        error:\n          type: string\n          description: The error description.\n        message:\n          type: string\n          description: The error message.\n        status:\n          type: integer\n          description: The HTTP status code.\n    NotFoundError:\n      type: object\n      properties:\n        error:\n          type: string\n          description: The error description.\n        message:\n          type: string\n          description: The error message.\n        status:\n          type: integer\n          description: The HTTP status code.\n    UnprocessableContentError:\n      type: object\n      properties:\n        code:\n          type: string\n          description: The error code.\n        detail:\n          $ref: '#/components/schemas/Detail'\n        error:\n          type: string\n          description: The error description.\n        message:\n          type: string\n          description: The error message.\n        status:\n          type: integer\n          description: The HTTP status code.\n    Detail:\n      type: object\n      properties:\n        loc:\n          type: array\n          items:\n            type: string\n          description: The parameter causing the issue.\n        value:\n          type: string\n          description: The value passed to the parameter causing issues.\n    TooManyRequestsError:\n      type: object\n      properties:\n        error:\n          type: string\n          description: The error description.\n        message:\n          type: string\n          description: The error message.\n        status:\n          type: integer\n          description: The HTTP status code.\n    ContentFilterError:\n      type: object\n      properties:\n        code:\n          type: string\n          description: The error code.\n        error:\n          type: string\n          description: The error description.\n        message:\n          type: string\n          description: The error message.\n        param:\n          type: string\n          description: The parameter that triggered the content filter.\n        status:\n          type: integer\n          description: The HTTP status code.\n    Usage:\n      type: object\n      properties:\n        prompt_patches:\n          type: integer\n          description: The number of image patches used by the image prompt.\n        prompt_tokens:\n          type: integer\n          description: The number of tokens used by the prompt.\n        total_patches:\n          type: integer\n          description: The total number of patches used by the request.\n        total_tokens:\n          type: integer\n          description: The total number of tokens used by the request.\n  securitySchemes:\n    apiKeyHeader:\n      type: apiKey\n      name: api-key\n      in: header\n    apiKeyQuery:\n      type: apiKey\n      name: subscription-key\n      in: query\nsecurity:\n  - apiKeyHeader: [ ]\n  - apiKeyQuery: [ ]",
            "$fxv#3": "<policies>\n    <inbound>\n        <base />\n        <set-header name=\"api-key\" exists-action=\"delete\" />\n        <!-- <authentication-managed-identity resource=\"https://cognitiveservices.azure.com\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" /> -->\n        <authentication-managed-identity resource=\"https://cognitiveservices.azure.com\" output-token-variable-name=\"msi-access-token\" ignore-error=\"false\" />\n\n        <set-header name=\"Authorization\" exists-action=\"override\">\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\n        </set-header>\n    </inbound>\n    <backend>\n        <base />\n    </backend>\n    <outbound>\n        <base />\n    </outbound>\n    <on-error>\n        <base />\n    </on-error>\n</policies>",
            "$fxv#4": "<policies>\n    <inbound>\n        <base />\n        <!-- AAD Authorization -->\n        <!-- Enabled if entra-validate named value is set to true -->\n        <include-fragment fragment-id=\"aad-auth\" />\n        \n        <!-- Deleting api-key header to it is not passed to OpenAI endpoint-->\n        <set-header name=\"api-key\" exists-action=\"delete\" />\n        \n        <!-- Backend Managed Identity -->\n        <authentication-managed-identity resource=\"https://cognitiveservices.azure.com\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\n        <set-header name=\"Authorization\" exists-action=\"override\">\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\n        </set-header>\n        \n        <!-- Set the backend service URL based on the product name -->\n        <choose>\n            <when condition=\"@(context.Product.Name == \"REPLACE1\")\">\n                <set-backend-service base-url=\"wss://REPLACE.openai.azure.com/openai/realtime\" />\n            </when>\n            <when condition=\"@(context.Product.Name == \"REPLACE2\")\">\n                <set-backend-service base-url=\"wss://REPLACE.openai.azure.com/openai/realtime\" />\n            </when>\n            <otherwise>\n                <set-backend-service base-url=\"wss://REPLACE.openai.azure.com/openai/realtime\" />\n            </otherwise>\n        </choose>\n\n        \n    </inbound>\n    <!-- Control if and how the requests are forwarded to services  -->\n    <backend>\n        <base />\n        <!--<include-fragment fragment-id=\"backend-routing\" />-->\n    </backend>\n    <!-- Customize the responses -->\n    <outbound>\n        <base />\n    </outbound>\n    <!-- Handle exceptions and customize error responses  -->\n    <on-error>\n        <base />\n    </on-error>\n</policies>",
            "$fxv#5": "openapi: 3.0.1\ninfo:\n  title: Azure Document Intelligence\n  description: 'Extracts content, layout, and structured data from documents.'\n  version: '1.0'\nservers:\n  - url: https://REPLACED-BY-POLICY/documentintelligence\npaths:\n  /documentClassifiers:\n    get:\n      summary: DocumentClassifiers_ListClassifiers\n      description: List all document classifiers.\n      operationId: DocumentClassifiers_ListClassifiers\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/PagedDocumentClassifierDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentClassifiers/{classifierId}':\n    get:\n      summary: DocumentClassifiers_GetClassifier\n      description: Gets detailed document classifier information.\n      operationId: DocumentClassifiers_GetClassifier\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentClassifierDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n    delete:\n      summary: DocumentClassifiers_DeleteClassifier\n      description: Deletes document classifier.\n      operationId: DocumentClassifiers_DeleteClassifier\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '204':\n          description: 'There is no content to send for this request, but the headers may be useful. '\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentClassifiers/{classifierId}:analyze':\n    post:\n      summary: DocumentClassifiers_ClassifyDocumentFromStream\n      description: \"Classifies document with document classifier. This operation can be used in two ways:\\n1. With a binary document stream in the request body (current endpoint)\\n2. With a ClassifyDocumentRequest object containing URL or base64-encoded document (add '_overload=classifyDocument' query parameter)\"\n      operationId: DocumentClassifiers_ClassifyDocumentFromStream\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\n        - $ref: '#/components/parameters/SplitParameter'\n        - $ref: '#/components/parameters/PagesParameter'\n        - name: _overload\n          in: query\n          description: Optional parameter to specify the operation variant. Use 'classifyDocument' for URL or base64 encoded document input.\n          schema:\n            enum:\n              - classifyDocument\n            type: string\n      requestBody:\n        description: Input content. Can be either a binary document stream or a ClassifyDocumentRequest object depending on the _overload parameter.\n        content:\n          application/octet-stream:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/pdf:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/jpeg:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/png:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/tiff:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/bmp:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/heif:\n            schema:\n              $ref: '#/components/schemas/Input'\n          text/html:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/vnd.openxmlformats-officedocument.wordprocessingml.document:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/vnd.openxmlformats-officedocument.presentationml.presentation:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/json:\n            schema:\n              $ref: '#/components/schemas/Input'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of AnalyzeOperation\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentClassifiers/{classifierId}:copyTo':\n    post:\n      summary: DocumentClassifiers_CopyClassifierTo\n      description: 'Copies document classifier to the target resource, region, and classifierId.'\n      operationId: DocumentClassifiers_CopyClassifierTo\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Copy to request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/ClassifierCopyAuthorization'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentClassifierCopyToOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentClassifiers/{classifierId}/analyzeResults/{resultId}':\n    get:\n      summary: DocumentClassifiers_GetClassifyResult\n      description: Gets the result of document classifier.\n      operationId: DocumentClassifiers_GetClassifyResult\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/AnalyzeOperation'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentClassifiers:authorizeCopy:\n    post:\n      summary: DocumentClassifiers_AuthorizeClassifierCopy\n      description: \"Generates authorization to copy a document classifier to this location with\\nspecified classifierId and optional description.\"\n      operationId: DocumentClassifiers_AuthorizeClassifierCopy\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Authorize copy request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/AuthorizeClassifierCopyRequest'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ClassifierCopyAuthorization'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentClassifiers:build:\n    post:\n      summary: DocumentClassifiers_BuildClassifier\n      description: Builds a custom document classifier.\n      operationId: DocumentClassifiers_BuildClassifier\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Build request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/BuildDocumentClassifierRequest'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentClassifierBuildOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentModels:\n    get:\n      summary: DocumentModels_ListModels\n      description: List all document models\n      operationId: DocumentModels_ListModels\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/PagedDocumentModelDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}:analyze':\n    post:\n      summary: DocumentModels_AnalyzeDocument\n      description: \"Analyzes document with document model. This operation can be used in two ways:\\n1. With a binary document stream in the request body (when _overload is not specified)\\n2. With an AnalyzeDocumentRequest object containing URL or base64-encoded document (add '_overload=analyzeDocument' query parameter)\"\n      operationId: DocumentModels_AnalyzeDocument\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/PagesParameter'\n        - $ref: '#/components/parameters/LocaleParameter'\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\n        - $ref: '#/components/parameters/FeaturesParameter'\n        - $ref: '#/components/parameters/QueryFieldsParameter'\n        - $ref: '#/components/parameters/OutputContentFormatParameter'\n        - $ref: '#/components/parameters/OutputParameter'\n        - name: _overload\n          in: query\n          description: Optional parameter to specify the operation variant. Use 'analyzeDocument' for URL or base64 encoded document input.\n          schema:\n            enum:\n              - analyzeDocument\n            type: string\n      requestBody:\n        description: Input content. Can be either a binary document stream or an AnalyzeDocumentRequest object depending on the _overload parameter.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/Input'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of AnalyzeOperation\n              schema:\n                type: string\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}:analyzeBatch':\n    post:\n      summary: DocumentModels_AnalyzeBatchDocuments\n      description: Analyzes batch documents with document model.\n      operationId: DocumentModels_AnalyzeBatchDocuments\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/PagesParameter'\n        - $ref: '#/components/parameters/LocaleParameter'\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\n        - $ref: '#/components/parameters/FeaturesParameter'\n        - $ref: '#/components/parameters/QueryFieldsParameter'\n        - $ref: '#/components/parameters/OutputContentFormatParameter'\n        - $ref: '#/components/parameters/OutputParameter'\n      requestBody:\n        description: Analyze batch request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/AnalyzeBatchDocumentsRequest'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of AnalyzeBatchOperation\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}':\n    get:\n      summary: DocumentModels_GetModel\n      description: Gets detailed document model information.\n      operationId: DocumentModels_GetModel\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentModelDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n    delete:\n      summary: DocumentModels_DeleteModel\n      description: Deletes document model.\n      operationId: DocumentModels_DeleteModel\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '204':\n          description: 'There is no content to send for this request, but the headers may be useful. '\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}:copyTo':\n    post:\n      summary: DocumentModels_CopyModelTo\n      description: 'Copies document model to the target resource, region, and modelId.'\n      operationId: DocumentModels_CopyModelTo\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Copy to request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/ModelCopyAuthorization'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentModelCopyToOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeBatchResults':\n    get:\n      summary: DocumentModels_ListAnalyzeBatchResults\n      description: List batch document analysis results.\n      operationId: DocumentModels_ListAnalyzeBatchResults\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/PagedAnalyzeBatchOperation'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeBatchResults/{resultId}':\n    get:\n      summary: DocumentModels_GetAnalyzeBatchResult\n      description: Gets the result of batch document analysis.\n      operationId: DocumentModels_GetAnalyzeBatchResult\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/AnalyzeBatchOperation'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n    delete:\n      summary: DocumentModels_DeleteAnalyzeBatchResult\n      description: Mark the batch document analysis result for deletion.\n      operationId: DocumentModels_DeleteAnalyzeBatchResult\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '204':\n          description: 'There is no content to send for this request, but the headers may be useful.'\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeResults/{resultId}':\n    get:\n      summary: DocumentModels_GetAnalyzeResult\n      description: Gets the result of document analysis.\n      operationId: DocumentModels_GetAnalyzeResult\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/AnalyzeOperation'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n    delete:\n      summary: DocumentModels_DeleteAnalyzeResult\n      description: Mark the result of document analysis for deletion.\n      operationId: DocumentModels_DeleteAnalyzeResult\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '204':\n          description: 'There is no content to send for this request, but the headers may be useful.'\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeResults/{resultId}/figures/{figureId}':\n    get:\n      summary: DocumentModels_GetAnalyzeResultFigure\n      description: Gets the generated cropped image of specified figure from document analysis.\n      operationId: DocumentModels_GetAnalyzeResultFigure\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/FigureIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            image/png:\n              schema:\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ImagePngResp'\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ApplicationJ'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeResults/{resultId}/pdf':\n    get:\n      summary: DocumentModels_GetAnalyzeResultPdf\n      description: Gets the generated searchable PDF output from document analysis.\n      operationId: DocumentModels_GetAnalyzeResultPdf\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/pdf:\n              schema:\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationPdfResponse'\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationJsonResponse'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentModels:authorizeCopy:\n    post:\n      summary: DocumentModels_AuthorizeModelCopy\n      description: \"Generates authorization to copy a document model to this location with\\nspecified modelId and optional description.\"\n      operationId: DocumentModels_AuthorizeModelCopy\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Authorize copy request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/AuthorizeCopyRequest'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ModelCopyAuthorization'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentModels:build:\n    post:\n      summary: DocumentModels_BuildModel\n      description: Builds a custom document analysis model.\n      operationId: DocumentModels_BuildModel\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Build request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/BuildDocumentModelRequest'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentModelBuildOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentModels:compose:\n    post:\n      summary: DocumentModels_ComposeModel\n      description: Creates a new document model from document types of existing document models.\n      operationId: DocumentModels_ComposeModel\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Compose request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/ComposeDocumentModelRequest'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentModelComposeOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /info:\n    get:\n      summary: MiscellaneousOperations_GetResourceDetails\n      description: Return information about the current resource.\n      operationId: MiscellaneousOperations_GetResourceDetails\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentIntelligenceResourceDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /operations:\n    get:\n      summary: MiscellaneousOperations_ListOperations\n      description: Lists all operations.\n      operationId: MiscellaneousOperations_ListOperations\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/PagedDocumentIntelligenceOperationDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/operations/{operationId}':\n    get:\n      summary: MiscellaneousOperations_GetOperation\n      description: \"Gets operation info. Different operation types can be retrieved:\\n1. General operation: no _overload parameter needed\\n2. Document Model Build operation: use _overload=getDocumentModelBuildOperation\\n3. Document Model Compose operation: use _overload=getDocumentModelComposeOperation\\n4. Document Model Copy To operation: use _overload=getDocumentModelCopyToOperation\\n5. Document Classifier Copy To operation: use _overload=getDocumentClassifierCopyToOperation\\n6. Document Classifier Build operation: use _overload=getDocumentClassifierBuildOperation\"\n      operationId: MiscellaneousOperations_GetOperation\n      parameters:\n        - name: operationId\n          in: path\n          description: Operation ID\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - name: _overload\n          in: query\n          description: Optional parameter to specify the operation type to retrieve.\n          schema:\n            enum:\n              - getOperation\n              - getDocumentModelBuildOperation\n              - getDocumentModelComposeOperation\n              - getDocumentModelCopyToOperation\n              - getDocumentClassifierCopyToOperation\n              - getDocumentClassifierBuildOperation\n            type: string\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\ncomponents:\n  parameters:\n    ApiVersionParameter:\n      name: api-version\n      in: query\n      description: The API version to use for this operation.\n      required: true\n      schema:\n        minLength: 1\n        type: string\n    ClientRequestIdParameter:\n      name: x-ms-client-request-id\n      in: header\n      description: 'An opaque, globally-unique, client-generated string identifier for the request.'\n      schema:\n        type: string\n        format: uuid\n    ClassifierIdParameter:\n      name: classifierId\n      in: path\n      description: Unique document classifier name.\n      required: true\n      schema:\n        maxLength: 64\n        pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n        type: string\n    ModelIdParameter:\n      name: modelId\n      in: path\n      description: Unique document model name.\n      required: true\n      schema:\n        maxLength: 64\n        pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n        type: string\n    ResultIdParameter:\n      name: resultId\n      in: path\n      description: Operation result ID.\n      required: true\n      schema:\n        type: string\n        format: uuid\n    PagesParameter:\n      name: pages\n      in: query\n      description: '1-based page numbers to analyze. Ex. \"1-3,5,7-9\"'\n      schema:\n        pattern: '^(\\d+(-\\d+)?)(,\\s*(\\d+(-\\d+)?))*$'\n        type: string\n    StringIndexTypeParameter:\n      name: stringIndexType\n      in: query\n      description: Method used to compute string offset and length.\n      schema:\n        enum:\n          - textElements\n          - unicodeCodePoint\n          - utf16CodeUnit\n        type: string\n        default: textElements\n    SplitParameter:\n      name: split\n      in: query\n      description: Document splitting mode.\n      schema:\n        enum:\n          - auto\n          - none\n          - perPage\n        type: string\n        default: none\n    LocaleParameter:\n      name: locale\n      in: query\n      description: \"Locale hint for text recognition and document analysis.  Value may contain only\\nthe language code (ex. \\\"en\\\", \\\"fr\\\") or BCP 47 language tag (ex. \\\"en-US\\\").\"\n      schema:\n        type: string\n    FeaturesParameter:\n      name: features\n      in: query\n      description: List of optional analysis features.\n      schema:\n        type: array\n        items:\n          enum:\n            - ocrHighResolution\n            - languages\n            - barcodes\n            - formulas\n            - keyValuePairs\n            - styleFont\n            - queryFields\n          type: string\n          x-ms-enum:\n            name: DocumentAnalysisFeature\n            modelAsString: true\n            values:\n              - name: ocrHighResolution\n                value: ocrHighResolution\n                description: Perform OCR at a higher resolution to handle documents with fine print.\n              - name: languages\n                value: languages\n                description: Enable the detection of the text content language.\n              - name: barcodes\n                value: barcodes\n                description: Enable the detection of barcodes in the document.\n              - name: formulas\n                value: formulas\n                description: Enable the detection of mathematical expressions in the document.\n              - name: keyValuePairs\n                value: keyValuePairs\n                description: Enable the detection of general key value pairs (form fields) in the document.\n              - name: styleFont\n                value: styleFont\n                description: Enable the recognition of various font styles.\n              - name: queryFields\n                value: queryFields\n                description: Enable the extraction of additional fields via the queryFields query parameter.\n    QueryFieldsParameter:\n      name: queryFields\n      in: query\n      description: 'List of additional fields to extract.  Ex. \"NumberOfGuests,StoreNumber\"'\n      schema:\n        type: array\n        items:\n          type: string\n    OutputContentFormatParameter:\n      name: outputContentFormat\n      in: query\n      description: Format of the analyze result top-level content.\n      schema:\n        enum:\n          - text\n          - markdown\n        type: string\n        default: text\n    OutputParameter:\n      name: output\n      in: query\n      description: Additional outputs to generate during analysis.\n      schema:\n        type: array\n        items:\n          enum:\n            - pdf\n            - figures\n          type: string\n          x-ms-enum:\n            name: AnalyzeOutputOption\n            modelAsString: true\n            values:\n              - name: pdf\n                value: pdf\n                description: Generate searchable PDF output.\n              - name: figures\n                value: figures\n                description: Generate cropped images of detected figures.\n    FigureIdParameter:\n      name: figureId\n      in: path\n      description: Figure ID.\n      required: true\n      schema:\n        type: string\n  headers:\n    ClientRequestIdHeader:\n      description: 'An opaque, globally-unique, client-generated string identifier for the request.'\n      schema:\n        type: string\n        format: uuid\n  responses:\n    ErrorResponse:\n      description: An unexpected error response.\n      content:\n        application/json:\n          schema:\n            $ref: '#/components/schemas/DocumentIntelligenceErrorResponse'\n    NoContentResponse:\n      description: 'There is no content to send for this request, but the headers may be useful.'\n      headers:\n        x-ms-client-request-id:\n          $ref: '#/components/headers/ClientRequestIdHeader'\n      content:\n        application/json: {}\n    AcceptedResponse:\n      description: 'The request has been accepted for processing, but processing has not yet completed.'\n      headers:\n        Operation-Location:\n          description: The location of an instance of the operation\n          schema:\n            type: string\n            format: uri\n        Retry-After:\n          description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n          schema:\n            type: integer\n            format: int32\n      content:\n        application/json: {}\n  schemas:\n    AddressValue:\n      type: object\n      properties:\n        houseNumber:\n          type: string\n          description: House or building number.\n        poBox:\n          type: string\n          description: Post office box number.\n        road:\n          type: string\n          description: Street name.\n        city:\n          type: string\n          description: 'Name of city, town, village, etc.'\n        state:\n          type: string\n          description: First-level administrative division.\n        postalCode:\n          type: string\n          description: Postal code used for mail sorting.\n        countryRegion:\n          type: string\n          description: Country/region.\n        streetAddress:\n          type: string\n          description: 'Street-level address, excluding city, state, countryRegion, and postalCode.'\n        unit:\n          type: string\n          description: Apartment or office number\n        cityDistrict:\n          type: string\n          description: \"Districts or boroughs within a city, such as Brooklyn in New York City or City\\nof Westminster in London.\"\n        stateDistrict:\n          type: string\n          description: Second-level administrative division used in certain locales.\n        suburb:\n          type: string\n          description: 'Unofficial neighborhood name, like Chinatown.'\n        house:\n          type: string\n          description: 'Build name, such as World Trade Center.'\n        level:\n          type: string\n          description: 'Floor number, such as 3F.'\n      description: Address field value.\n    AnalyzeBatchDocumentsRequest:\n      required:\n        - resultContainerUrl\n      type: object\n      properties:\n        azureBlobSource:\n          $ref: '#/components/schemas/AzureBlobContentSource'\n        azureBlobFileListSource:\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\n        resultContainerUrl:\n          type: string\n          description: Azure Blob Storage container URL where analyze result files will be stored.\n          format: uri\n        resultPrefix:\n          type: string\n          description: Blob name prefix of result files.\n        overwriteExisting:\n          type: boolean\n          description: Overwrite existing analyze result files?\n          default: false\n      description: Batch document analysis parameters.\n    AnalyzeBatchOperation:\n      required:\n        - status\n        - createdDateTime\n        - lastUpdatedDateTime\n      type: object\n      properties:\n        resultId:\n          $ref: '#/components/schemas/Azure.Core.uuid'\n        status:\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the operation was submitted.\n          format: date-time\n        lastUpdatedDateTime:\n          type: string\n          description: Date and time (UTC) when the status was last updated.\n          format: date-time\n        percentCompleted:\n          maximum: 100\n          minimum: 0\n          type: integer\n          description: Operation progress (0-100).\n          format: int32\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n        result:\n          $ref: '#/components/schemas/AnalyzeBatchResult'\n      description: Status and result of the analyze batch operation.\n    AnalyzeBatchOperationDetail:\n      required:\n        - status\n        - sourceUrl\n      type: object\n      properties:\n        status:\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\n        sourceUrl:\n          type: string\n          description: URL of the source document.\n          format: uri\n        resultUrl:\n          type: string\n          description: URL of the analyze result JSON.\n          format: uri\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n      description: Operation detail for a document in a batch analysis.\n    AnalyzeBatchResult:\n      required:\n        - succeededCount\n        - failedCount\n        - skippedCount\n      type: object\n      properties:\n        succeededCount:\n          type: integer\n          description: Number of documents that completed with status succeeded.\n          format: int32\n        failedCount:\n          type: integer\n          description: Number of documents that completed with status failed.\n          format: int32\n        skippedCount:\n          type: integer\n          description: Number of documents that completed with status skipped.\n          format: int32\n        details:\n          type: array\n          items:\n            $ref: '#/components/schemas/AnalyzeBatchOperationDetail'\n          description: Operation detail for each document in the batch.\n          x-ms-identifiers: [ ]\n      description: Batch document analysis result.\n    AnalyzeDocumentRequest:\n      type: object\n      properties:\n        urlSource:\n          type: string\n          description: Document URL to analyze.  Either urlSource or base64Source must be specified.\n          format: uri\n        base64Source:\n          type: string\n          description: \"Base64 encoding of the document to analyze.  Either urlSource or base64Source\\nmust be specified.\"\n          format: byte\n      description: Document analysis parameters.\n    AnalyzeOperation:\n      required:\n        - status\n        - createdDateTime\n        - lastUpdatedDateTime\n      type: object\n      properties:\n        status:\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the analyze operation was submitted.\n          format: date-time\n        lastUpdatedDateTime:\n          type: string\n          description: Date and time (UTC) when the status was last updated.\n          format: date-time\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n        analyzeResult:\n          $ref: '#/components/schemas/AnalyzeResult'\n      description: Status and result of the analyze operation.\n    AnalyzeResult:\n      required:\n        - apiVersion\n        - modelId\n        - stringIndexType\n        - content\n        - pages\n      type: object\n      properties:\n        apiVersion:\n          type: string\n          description: API version used to produce this result.\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Document model ID used to produce this result.\n        stringIndexType:\n          $ref: '#/components/schemas/StringIndexType'\n        contentFormat:\n          $ref: '#/components/schemas/DocumentContentFormat'\n        content:\n          type: string\n          description: \"Concatenate string representation of all textual and visual elements in reading\\norder.\"\n        pages:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentPage'\n          description: Analyzed pages.\n          x-ms-identifiers: [ ]\n        paragraphs:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentParagraph'\n          description: Extracted paragraphs.\n          x-ms-identifiers: [ ]\n        tables:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentTable'\n          description: Extracted tables.\n          x-ms-identifiers: [ ]\n        figures:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentFigure'\n          description: Extracted figures.\n        sections:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSection'\n          description: Extracted sections.\n          x-ms-identifiers: [ ]\n        keyValuePairs:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentKeyValuePair'\n          description: Extracted key-value pairs.\n          x-ms-identifiers: [ ]\n        styles:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentStyle'\n          description: Extracted font styles.\n          x-ms-identifiers: [ ]\n        languages:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentLanguage'\n          description: Detected languages.\n          x-ms-identifiers: [ ]\n        documents:\n          type: array\n          items:\n            $ref: '#/components/schemas/AnalyzedDocument'\n          description: Extracted documents.\n          x-ms-identifiers: [ ]\n        warnings:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\n          description: List of warnings encountered.\n          x-ms-identifiers: [ ]\n      description: Document analysis result.\n    AnalyzedDocument:\n      required:\n        - docType\n        - spans\n        - confidence\n      type: object\n      properties:\n        docType:\n          maxLength: 64\n          minLength: 2\n          type: string\n          description: Document type.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the document.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the document in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        fields:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentField'\n          description: Dictionary of named field values.\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the document.\n          format: float\n      description: An object describing the location and semantic content of a document.\n    AuthorizeClassifierCopyRequest:\n      required:\n        - classifierId\n      type: object\n      properties:\n        classifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document classifier name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document classifier description.\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document classifier.\n      description: Request body to authorize document classifier copy.\n    AuthorizeCopyRequest:\n      required:\n        - modelId\n      type: object\n      properties:\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document model name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n      description: Request body to authorize document model copy.\n    Azure.Core.uuid:\n      type: string\n      description: Universally Unique Identifier\n      format: uuid\n    AzureBlobContentSource:\n      required:\n        - containerUrl\n      type: object\n      properties:\n        containerUrl:\n          type: string\n          description: Azure Blob Storage container URL.\n          format: uri\n        prefix:\n          type: string\n          description: Blob name prefix.\n      description: Azure Blob Storage content.\n    AzureBlobFileListContentSource:\n      required:\n        - containerUrl\n        - fileList\n      type: object\n      properties:\n        containerUrl:\n          type: string\n          description: Azure Blob Storage container URL.\n          format: uri\n        fileList:\n          type: string\n          description: Path to a JSONL file within the container specifying a subset of documents.\n      description: File list in Azure Blob Storage.\n    BoundingRegion:\n      required:\n        - pageNumber\n        - polygon\n      type: object\n      properties:\n        pageNumber:\n          minimum: 1\n          type: integer\n          description: 1-based page number of page containing the bounding region.\n          format: int32\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon on the page, or the entire page if not specified.\\nCoordinates specified relative to the top-left of the page. The numbers\\nrepresent the x, y values of the polygon vertices, clockwise from the left\\n(-180 degrees inclusive) relative to the element orientation.\"\n      description: Bounding polygon on a specific page of the input.\n    BuildDocumentClassifierRequest:\n      required:\n        - classifierId\n        - docTypes\n      type: object\n      properties:\n        classifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document classifier name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document classifier description.\n        baseClassifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Base classifierId on top of which to train the classifier.\n        docTypes:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/ClassifierDocumentTypeDetails'\n          description: List of document types to classify against.\n        allowOverwrite:\n          type: boolean\n          description: Allow overwriting an existing classifier with the same name.\n          default: false\n      description: Request body to build a new custom document classifier.\n    BuildDocumentModelRequest:\n      required:\n        - modelId\n        - buildMode\n      type: object\n      properties:\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document model name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        buildMode:\n          $ref: '#/components/schemas/DocumentBuildMode'\n        azureBlobSource:\n          $ref: '#/components/schemas/AzureBlobContentSource'\n        azureBlobFileListSource:\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n        maxTrainingHours:\n          type: number\n          description: Max number of V100-equivalent GPU hours to use for model training.  Default=0.5.\n          format: float\n          default: 0.5\n        allowOverwrite:\n          type: boolean\n          description: Allow overwriting an existing model with the same name.\n          default: false\n      description: Request body to build a new custom document model.\n    ClassifierCopyAuthorization:\n      required:\n        - targetResourceId\n        - targetResourceRegion\n        - targetClassifierId\n        - targetClassifierLocation\n        - accessToken\n        - expirationDateTime\n      type: object\n      properties:\n        targetResourceId:\n          type: string\n          description: ID of the target Azure resource where the document classifier should be copied to.\n        targetResourceRegion:\n          type: string\n          description: \"Location of the target Azure resource where the document classifier should be copied\\nto.\"\n        targetClassifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Identifier of the target document classifier.\n        targetClassifierLocation:\n          type: string\n          description: URL of the copied document classifier in the target account.\n          format: uri\n        accessToken:\n          type: string\n          description: Token used to authorize the request.\n        expirationDateTime:\n          type: string\n          description: Date/time when the access token expires.\n          format: date-time\n      description: \"Authorization to copy a document classifier to the specified target resource and\\nclassifierId.\"\n    ClassifierDocumentTypeDetails:\n      type: object\n      properties:\n        sourceKind:\n          $ref: '#/components/schemas/ContentSourceKind'\n        azureBlobSource:\n          $ref: '#/components/schemas/AzureBlobContentSource'\n        azureBlobFileListSource:\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\n      description: Classifier document type info.\n    ClassifyDocumentRequest:\n      type: object\n      properties:\n        urlSource:\n          type: string\n          description: Document URL to classify.  Either urlSource or base64Source must be specified.\n          format: uri\n        base64Source:\n          type: string\n          description: \"Base64 encoding of the document to classify.  Either urlSource or base64Source\\nmust be specified.\"\n          format: byte\n      description: Document classification parameters.\n    ComposeDocumentModelRequest:\n      required:\n        - modelId\n        - classifierId\n        - docTypes\n      type: object\n      properties:\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document model name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        classifierId:\n          type: string\n          description: Custom classifier to split and classify the input file.\n        split:\n          enum:\n            - auto\n            - none\n            - perPage\n          type: string\n          description: File splitting behavior.\n          default: none\n          x-ms-enum:\n            name: SplitMode\n            modelAsString: true\n            values:\n              - name: auto\n                value: auto\n                description: Automatically split file into documents.\n              - name: none\n                value: none\n                description: Treat the entire file as a single document.\n              - name: perPage\n                value: perPage\n                description: Treat each page in the file as a separate document.\n        docTypes:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentTypeDetails'\n          description: Dictionary mapping supported docTypes to the corresponding document models.\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n      description: Request body to create a composed document model from component document models.\n    ContentSourceKind:\n      enum:\n        - url\n        - base64\n        - azureBlob\n        - azureBlobFileList\n      type: string\n      description: Type of content source.\n      x-ms-enum:\n        name: ContentSourceKind\n        modelAsString: true\n        values:\n          - name: url\n            value: url\n            description: Content at a specific URL.\n          - name: base64\n            value: base64\n            description: Content represented via Base64 encoding.\n          - name: azureBlob\n            value: azureBlob\n            description: Files in a path within an Azure Blob Storage container.\n          - name: azureBlobFileList\n            value: azureBlobFileList\n            description: A file list specifying individual files in an Azure Blob Storage container.\n    CurrencyValue:\n      required:\n        - amount\n      type: object\n      properties:\n        amount:\n          type: number\n          description: Currency amount.\n          format: double\n        currencySymbol:\n          type: string\n          description: 'Currency symbol label, if any.'\n        currencyCode:\n          type: string\n          description: 'Resolved currency code (ISO 4217), if any.'\n      description: Currency field value.\n    CustomDocumentModelsDetails:\n      required:\n        - count\n        - limit\n      type: object\n      properties:\n        count:\n          type: integer\n          description: Number of custom document models in the current resource.\n          format: int32\n        limit:\n          type: integer\n          description: Maximum number of custom document models supported in the current resource.\n          format: int32\n      description: Details regarding custom document models.\n    DocumentAnalysisFeature:\n      enum:\n        - ocrHighResolution\n        - languages\n        - barcodes\n        - formulas\n        - keyValuePairs\n        - styleFont\n        - queryFields\n      type: string\n      description: Document analysis features to enable.\n      x-ms-enum:\n        name: DocumentAnalysisFeature\n        modelAsString: true\n        values:\n          - name: ocrHighResolution\n            value: ocrHighResolution\n            description: Perform OCR at a higher resolution to handle documents with fine print.\n          - name: languages\n            value: languages\n            description: Enable the detection of the text content language.\n          - name: barcodes\n            value: barcodes\n            description: Enable the detection of barcodes in the document.\n          - name: formulas\n            value: formulas\n            description: Enable the detection of mathematical expressions in the document.\n          - name: keyValuePairs\n            value: keyValuePairs\n            description: Enable the detection of general key value pairs (form fields) in the document.\n          - name: styleFont\n            value: styleFont\n            description: Enable the recognition of various font styles.\n          - name: queryFields\n            value: queryFields\n            description: Enable the extraction of additional fields via the queryFields query parameter.\n    DocumentBarcode:\n      required:\n        - kind\n        - value\n        - span\n        - confidence\n      type: object\n      properties:\n        kind:\n          $ref: '#/components/schemas/DocumentBarcodeKind'\n        value:\n          type: string\n          description: Barcode value.\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the barcode, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\n        span:\n          $ref: '#/components/schemas/DocumentSpan'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the barcode.\n          format: float\n      description: A barcode object.\n    DocumentBarcodeKind:\n      enum:\n        - QRCode\n        - PDF417\n        - UPCA\n        - UPCE\n        - Code39\n        - Code128\n        - EAN8\n        - EAN13\n        - DataBar\n        - Code93\n        - Codabar\n        - DataBarExpanded\n        - ITF\n        - MicroQRCode\n        - Aztec\n        - DataMatrix\n        - MaxiCode\n      type: string\n      description: Barcode kind.\n      x-ms-enum:\n        name: DocumentBarcodeKind\n        modelAsString: true\n        values:\n          - name: QRCode\n            value: QRCode\n            description: 'QR code, as defined in ISO/IEC 18004:2015.'\n          - name: PDF417\n            value: PDF417\n            description: 'PDF417, as defined in ISO 15438.'\n          - name: UPCA\n            value: UPCA\n            description: GS1 12-digit Universal Product Code.\n          - name: UPCE\n            value: UPCE\n            description: GS1 6-digit Universal Product Code.\n          - name: Code39\n            value: Code39\n            description: 'Code 39 barcode, as defined in ISO/IEC 16388:2007.'\n          - name: Code128\n            value: Code128\n            description: 'Code 128 barcode, as defined in ISO/IEC 15417:2007.'\n          - name: EAN8\n            value: EAN8\n            description: GS1 8-digit International Article Number (European Article Number).\n          - name: EAN13\n            value: EAN13\n            description: GS1 13-digit International Article Number (European Article Number).\n          - name: DataBar\n            value: DataBar\n            description: GS1 DataBar barcode.\n          - name: Code93\n            value: Code93\n            description: 'Code 93 barcode, as defined in ANSI/AIM BC5-1995.'\n          - name: Codabar\n            value: Codabar\n            description: 'Codabar barcode, as defined in ANSI/AIM BC3-1995.'\n          - name: DataBarExpanded\n            value: DataBarExpanded\n            description: GS1 DataBar Expanded barcode.\n          - name: ITF\n            value: ITF\n            description: 'Interleaved 2 of 5 barcode, as defined in ANSI/AIM BC2-1995.'\n          - name: MicroQRCode\n            value: MicroQRCode\n            description: 'Micro QR code, as defined in ISO/IEC 23941:2022.'\n          - name: Aztec\n            value: Aztec\n            description: 'Aztec code, as defined in ISO/IEC 24778:2008.'\n          - name: DataMatrix\n            value: DataMatrix\n            description: 'Data matrix code, as defined in ISO/IEC 16022:2006.'\n          - name: MaxiCode\n            value: MaxiCode\n            description: 'MaxiCode, as defined in ISO/IEC 16023:2000.'\n    DocumentBuildMode:\n      enum:\n        - template\n        - neural\n      type: string\n      description: Custom document model build mode.\n      x-ms-enum:\n        name: DocumentBuildMode\n        modelAsString: true\n        values:\n          - name: template\n            value: template\n            description: Target documents with similar visual templates.\n          - name: neural\n            value: neural\n            description: Support documents with diverse visual templates.\n    DocumentCaption:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        content:\n          type: string\n          description: Content of the caption.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the caption.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the caption in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: Child elements of the caption.\n      description: A caption object describing a table or figure.\n    DocumentClassifierBuildOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentClassifierDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentClassifierBuild\n    DocumentClassifierCopyToOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentClassifierDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentClassifierCopyTo\n    DocumentClassifierDetails:\n      required:\n        - classifierId\n        - createdDateTime\n        - apiVersion\n        - docTypes\n      type: object\n      properties:\n        classifierId:\n          maxLength: 64\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document classifier name.\n          x-ms-mutability:\n            - read\n            - create\n        description:\n          maxLength: 4096\n          type: string\n          description: Document classifier description.\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the document classifier was created.\n          format: date-time\n        expirationDateTime:\n          type: string\n          description: Date and time (UTC) when the document classifier will expire.\n          format: date-time\n        modifiedDateTime:\n          type: string\n          description: Date and time (UTC) when the document model was last modified.\n          format: date-time\n          readOnly: true\n        apiVersion:\n          type: string\n          description: API version used to create this document classifier.\n        baseClassifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Base classifierId on top of which the classifier was trained.\n        docTypes:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/ClassifierDocumentTypeDetails'\n          description: List of document types to classify against.\n        warnings:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\n          description: List of warnings encountered while building the classifier.\n          x-ms-identifiers: [ ]\n      description: Document classifier info.\n    DocumentContentFormat:\n      enum:\n        - text\n        - markdown\n      type: string\n      description: Format of the content in analyzed result.\n      x-ms-enum:\n        name: DocumentContentFormat\n        modelAsString: true\n        values:\n          - name: text\n            value: text\n            description: Plain text representation of the document content without any formatting.\n          - name: markdown\n            value: markdown\n            description: \"Markdown representation of the document content with section headings, tables,\\netc.\"\n    DocumentElement:\n      type: string\n      description: \"An JSON pointer referencing an element of the document, such as paragraph,\\ntable, section, etc.\"\n    DocumentField:\n      required:\n        - type\n      type: object\n      properties:\n        type:\n          $ref: '#/components/schemas/DocumentFieldType'\n        valueString:\n          type: string\n          description: String value.\n        valueDate:\n          type: string\n          description: Date value in YYYY-MM-DD format (ISO 8601).\n          format: date\n        valueTime:\n          type: string\n          description: Time value in hh:mm:ss format (ISO 8601).\n          format: time\n        valuePhoneNumber:\n          type: string\n          description: Phone number value in E.164 format (ex. +19876543210).\n        valueNumber:\n          type: number\n          description: Floating point value.\n          format: double\n        valueInteger:\n          type: integer\n          description: Integer value.\n          format: int64\n        valueSelectionMark:\n          $ref: '#/components/schemas/DocumentSelectionMarkState'\n        valueSignature:\n          $ref: '#/components/schemas/DocumentSignatureType'\n        valueCountryRegion:\n          type: string\n          description: 3-letter country code value (ISO 3166-1 alpha-3).\n        valueArray:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentField'\n          description: Array of field values.\n          x-ms-identifiers: [ ]\n        valueObject:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentField'\n          description: Dictionary of named field values.\n        valueCurrency:\n          $ref: '#/components/schemas/CurrencyValue'\n        valueAddress:\n          $ref: '#/components/schemas/AddressValue'\n        valueBoolean:\n          type: boolean\n          description: Boolean value.\n        valueSelectionGroup:\n          type: array\n          items:\n            type: string\n          description: Selection group value.\n        content:\n          type: string\n          description: Field content.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the field.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the field in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the field.\n          format: float\n      description: An object representing the content and location of a field value.\n    DocumentFieldSchema:\n      required:\n        - type\n      type: object\n      properties:\n        type:\n          $ref: '#/components/schemas/DocumentFieldType'\n        description:\n          maxLength: 4096\n          type: string\n          description: Field description.\n        example:\n          type: string\n          description: Example field content.\n        items:\n          $ref: '#/components/schemas/DocumentFieldSchema'\n        properties:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentFieldSchema'\n          description: Named sub-fields of the object field.\n      description: Description of the field semantic schema using a JSON Schema style syntax.\n    DocumentFieldType:\n      enum:\n        - string\n        - date\n        - time\n        - phoneNumber\n        - number\n        - integer\n        - selectionMark\n        - countryRegion\n        - signature\n        - array\n        - object\n        - currency\n        - address\n        - boolean\n        - selectionGroup\n      type: string\n      description: Semantic data type of the field value.\n      x-ms-enum:\n        name: DocumentFieldType\n        modelAsString: true\n        values:\n          - name: string\n            value: string\n            description: Plain text.\n          - name: date\n            value: date\n            description: 'Date, normalized to ISO 8601 (YYYY-MM-DD) format.'\n          - name: time\n            value: time\n            description: 'Time, normalized to ISO 8601 (hh:mm:ss) format.'\n          - name: phoneNumber\n            value: phoneNumber\n            description: 'Phone number, normalized to E.164 (+{CountryCode}{SubscriberNumber}) format.'\n          - name: number\n            value: number\n            description: 'Floating point number, normalized to double precision floating point.'\n          - name: integer\n            value: integer\n            description: 'Integer number, normalized to 64-bit signed integer.'\n          - name: selectionMark\n            value: selectionMark\n            description: Is field selected?\n          - name: countryRegion\n            value: countryRegion\n            description: 'Country/region, normalized to ISO 3166-1 alpha-3 format (ex. USA).'\n          - name: signature\n            value: signature\n            description: Is signature present?\n          - name: array\n            value: array\n            description: List of subfields of the same type.\n          - name: object\n            value: object\n            description: Named list of subfields of potentially different types.\n          - name: currency\n            value: currency\n            description: Currency amount with optional currency symbol and unit.\n          - name: address\n            value: address\n            description: Parsed address.\n          - name: boolean\n            value: boolean\n            description: 'Boolean value, normalized to true or false.'\n          - name: selectionGroup\n            value: selectionGroup\n            description: Array of selected string values.\n    DocumentFigure:\n      required:\n        - spans\n      type: object\n      properties:\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the figure.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the figure in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: 'Child elements of the figure, excluding any caption or footnotes.'\n        caption:\n          $ref: '#/components/schemas/DocumentCaption'\n        footnotes:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentFootnote'\n          description: List of footnotes associated with the figure.\n          x-ms-identifiers: [ ]\n        id:\n          type: string\n          description: Figure ID.\n      description: An object representing a figure in the document.\n    DocumentFontStyle:\n      enum:\n        - normal\n        - italic\n      type: string\n      description: Font style.\n      x-ms-enum:\n        name: DocumentFontStyle\n        modelAsString: true\n        values:\n          - name: normal\n            value: normal\n            description: Characters are represented normally.\n          - name: italic\n            value: italic\n            description: Characters are visually slanted to the right.\n    DocumentFontWeight:\n      enum:\n        - normal\n        - bold\n      type: string\n      description: Font weight.\n      x-ms-enum:\n        name: DocumentFontWeight\n        modelAsString: true\n        values:\n          - name: normal\n            value: normal\n            description: Characters are represented normally.\n          - name: bold\n            value: bold\n            description: Characters are represented with thicker strokes.\n    DocumentFootnote:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        content:\n          type: string\n          description: Content of the footnote.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the footnote.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the footnote in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: Child elements of the footnote.\n      description: A footnote object describing a table or figure.\n    DocumentFormula:\n      required:\n        - kind\n        - value\n        - span\n        - confidence\n      type: object\n      properties:\n        kind:\n          $ref: '#/components/schemas/DocumentFormulaKind'\n        value:\n          type: string\n          description: LaTex expression describing the formula.\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the formula, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\n        span:\n          $ref: '#/components/schemas/DocumentSpan'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the formula.\n          format: float\n      description: A formula object.\n    DocumentFormulaKind:\n      enum:\n        - inline\n        - display\n      type: string\n      description: Formula kind.\n      x-ms-enum:\n        name: DocumentFormulaKind\n        modelAsString: true\n        values:\n          - name: inline\n            value: inline\n            description: A formula embedded within the content of a paragraph.\n          - name: display\n            value: display\n            description: A formula in display mode that takes up an entire line.\n    DocumentIntelligenceError:\n      required:\n        - code\n        - message\n      type: object\n      properties:\n        code:\n          type: string\n          description: One of a server-defined set of error codes.\n        message:\n          type: string\n          description: A human-readable representation of the error.\n        target:\n          type: string\n          description: The target of the error.\n        details:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceError'\n          description: An array of details about specific errors that led to this reported error.\n          x-ms-identifiers: [ ]\n        innererror:\n          $ref: '#/components/schemas/DocumentIntelligenceInnerError'\n      description: The error object.\n    DocumentIntelligenceErrorResponse:\n      required:\n        - error\n      type: object\n      properties:\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n      description: Error response object.\n    DocumentIntelligenceInnerError:\n      type: object\n      properties:\n        code:\n          type: string\n          description: One of a server-defined set of error codes.\n        message:\n          type: string\n          description: A human-readable representation of the error.\n        innererror:\n          $ref: '#/components/schemas/DocumentIntelligenceInnerError'\n      description: An object containing more specific information about the error.\n    DocumentIntelligenceOperationDetails:\n      required:\n        - operationId\n        - status\n        - createdDateTime\n        - lastUpdatedDateTime\n        - kind\n        - resourceLocation\n      type: object\n      properties:\n        operationId:\n          type: string\n          description: Operation ID\n          x-ms-mutability:\n            - read\n            - create\n        status:\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\n        percentCompleted:\n          maximum: 100\n          minimum: 0\n          type: integer\n          description: Operation progress (0-100).\n          format: int32\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the operation was created.\n          format: date-time\n        lastUpdatedDateTime:\n          type: string\n          description: Date and time (UTC) when the status was last updated.\n          format: date-time\n        kind:\n          $ref: '#/components/schemas/OperationKind'\n        resourceLocation:\n          type: string\n          description: URL of the resource targeted by this operation.\n          format: uri\n        apiVersion:\n          type: string\n          description: API version used to create this operation.\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n      description: Operation info.\n      discriminator:\n        propertyName: kind\n    DocumentIntelligenceOperationStatus:\n      enum:\n        - notStarted\n        - running\n        - failed\n        - succeeded\n        - canceled\n        - skipped\n\n      type: string\n      description: Operation status.\n      x-ms-enum:\n        name: DocumentIntelligenceOperationStatus\n        modelAsString: true\n        values:\n          - name: notStarted\n            value: notStarted\n            description: The operation has not started yet.\n          - name: running\n            value: running\n            description: The operation is in progress.\n          - name: failed\n            value: failed\n            description: The operation has failed.\n          - name: succeeded\n            value: succeeded\n            description: The operation has succeeded.\n          - name: canceled\n            value: canceled\n            description: The operation has been canceled.\n          - name: skipped\n            value: skipped\n            description: The operation has been skipped.\n    DocumentIntelligenceResourceDetails:\n      required:\n        - customDocumentModels\n      type: object\n      properties:\n        customDocumentModels:\n          $ref: '#/components/schemas/CustomDocumentModelsDetails'\n      description: General information regarding the current resource.\n    DocumentIntelligenceWarning:\n      required:\n        - code\n        - message\n      type: object\n      properties:\n        code:\n          type: string\n          description: One of a server-defined set of warning codes.\n        message:\n          type: string\n          description: A human-readable representation of the warning.\n        target:\n          type: string\n          description: The target of the error.\n      description: The error object.\n    DocumentKeyValueElement:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        content:\n          type: string\n          description: Concatenated content of the key-value element in reading order.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the key-value element.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the key-value element in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n      description: An object representing the field key or value in a key-value pair.\n    DocumentKeyValuePair:\n      required:\n        - key\n        - confidence\n      type: object\n      properties:\n        key:\n          $ref: '#/components/schemas/DocumentKeyValueElement'\n        value:\n          $ref: '#/components/schemas/DocumentKeyValueElement'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the key-value pair.\n          format: float\n      description: \"An object representing a form field with distinct field label (key) and field\\nvalue (may be empty).\"\n    DocumentLanguage:\n      required:\n        - locale\n        - spans\n        - confidence\n      type: object\n      properties:\n        locale:\n          type: string\n          description: \"Detected language.  Value may an ISO 639-1 language code (ex. \\\"en\\\", \\\"fr\\\")\\nor BCP 47 language tag (ex. \\\"zh-Hans\\\").\"\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: \"Location of the text elements in the concatenated content the language applies\\nto.\"\n          x-ms-identifiers: [ ]\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly identifying the language.\n          format: float\n      description: An object representing the detected language for a given text span.\n    DocumentLine:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        content:\n          type: string\n          description: Concatenated content of the contained elements in reading order.\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the line, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the line in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n      description: \"A content line object consisting of an adjacent sequence of content elements,\\nsuch as words and selection marks.\"\n    DocumentModelBuildOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentModelDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentModelBuild\n    DocumentModelComposeOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentModelDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentModelCompose\n    DocumentModelCopyToOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentModelDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentModelCopyTo\n    DocumentModelDetails:\n      required:\n        - modelId\n        - createdDateTime\n      type: object\n      properties:\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document model name.\n          x-ms-mutability:\n            - read\n            - create\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the document model was created.\n          format: date-time\n          readOnly: true\n        expirationDateTime:\n          type: string\n          description: Date and time (UTC) when the document model will expire.\n          format: date-time\n          readOnly: true\n        modifiedDateTime:\n          type: string\n          description: Date and time (UTC) when the document model was last modified.\n          format: date-time\n          readOnly: true\n        apiVersion:\n          type: string\n          description: API version used to create this document model.\n          readOnly: true\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n        buildMode:\n          $ref: '#/components/schemas/DocumentBuildMode'\n        azureBlobSource:\n          $ref: '#/components/schemas/AzureBlobContentSource'\n        azureBlobFileListSource:\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\n        classifierId:\n          type: string\n          description: 'For composed models, the custom classifier to split and classify the input file.'\n        split:\n          enum:\n            - auto\n            - none\n            - perPage\n          type: string\n          description: 'For composed models, the file splitting behavior.'\n          default: none\n          x-ms-enum:\n            name: SplitMode\n            modelAsString: true\n            values:\n              - name: auto\n                value: auto\n                description: Automatically split file into documents.\n              - name: none\n                value: none\n                description: Treat the entire file as a single document.\n              - name: perPage\n                value: perPage\n                description: Treat each page in the file as a separate document.\n        docTypes:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentTypeDetails'\n          description: Supported document types.\n          readOnly: true\n        warnings:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\n          description: List of warnings encountered while building the model.\n          readOnly: true\n          x-ms-identifiers: [ ]\n        trainingHours:\n          type: number\n          description: Number of V100-equivalent GPU hours consumed for model training.\n          format: float\n          readOnly: true\n      description: Document model info.\n    DocumentPage:\n      required:\n        - pageNumber\n        - spans\n      type: object\n      properties:\n        pageNumber:\n          minimum: 1\n          type: integer\n          description: 1-based page number in the input document.\n          format: int32\n        angle:\n          maximum: 180\n          type: number\n          description: \"The general orientation of the content in clockwise direction, measured in\\ndegrees between (-180, 180].\"\n          format: float\n        width:\n          minimum: 0\n          type: number\n          description: 'The width of the image/PDF in pixels/inches, respectively.'\n          format: float\n        height:\n          minimum: 0\n          type: number\n          description: 'The height of the image/PDF in pixels/inches, respectively.'\n          format: float\n        unit:\n          $ref: '#/components/schemas/LengthUnit'\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the page in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        words:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentWord'\n          description: Extracted words from the page.\n          x-ms-identifiers: [ ]\n        selectionMarks:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSelectionMark'\n          description: Extracted selection marks from the page.\n          x-ms-identifiers: [ ]\n        lines:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentLine'\n          description: \"Extracted lines from the page, potentially containing both textual and visual\\nelements.\"\n          x-ms-identifiers: [ ]\n        barcodes:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentBarcode'\n          description: Extracted barcodes from the page.\n          x-ms-identifiers: [ ]\n        formulas:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentFormula'\n          description: Extracted formulas from the page.\n          x-ms-identifiers: [ ]\n      description: Content and layout elements extracted from a page from the input.\n    DocumentParagraph:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        role:\n          $ref: '#/components/schemas/ParagraphRole'\n        content:\n          type: string\n          description: Concatenated content of the paragraph in reading order.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the paragraph.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the paragraph in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n      description: \"A paragraph object consisting with contiguous lines generally with common\\nalignment and spacing.\"\n    DocumentSection:\n      required:\n        - spans\n      type: object\n      properties:\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the section in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: Child elements of the section.\n      description: An object representing a section in the document.\n    DocumentSelectionMark:\n      required:\n        - state\n        - span\n        - confidence\n      type: object\n      properties:\n        state:\n          $ref: '#/components/schemas/DocumentSelectionMarkState'\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the selection mark, with coordinates specified relative\\nto the top-left of the page. The numbers represent the x, y values of the\\npolygon vertices, clockwise from the left (-180 degrees inclusive) relative\\nto the element orientation.\"\n        span:\n          $ref: '#/components/schemas/DocumentSpan'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the selection mark.\n          format: float\n      description: \"A selection mark object representing check boxes, radio buttons, and other\\nelements indicating a selection.\"\n    DocumentSelectionMarkState:\n      enum:\n        - selected\n        - unselected\n      type: string\n      description: State of the selection mark.\n      x-ms-enum:\n        name: DocumentSelectionMarkState\n        modelAsString: true\n        values:\n          - name: selected\n            value: selected\n            description: \"The selection mark is selected, often indicated by a check  or cross X inside\\nthe selection mark.\"\n          - name: unselected\n            value: unselected\n            description: The selection mark is not selected.\n    DocumentSignatureType:\n      enum:\n        - signed\n        - unsigned\n      type: string\n      description: Presence of signature.\n      x-ms-enum:\n        name: DocumentSignatureType\n        modelAsString: true\n        values:\n          - name: signed\n            value: signed\n            description: A signature is detected.\n          - name: unsigned\n            value: unsigned\n            description: No signatures are detected.\n    DocumentSpan:\n      required:\n        - offset\n        - length\n      type: object\n      properties:\n        offset:\n          minimum: 0\n          type: integer\n          description: Zero-based index of the content represented by the span.\n          format: int32\n        length:\n          minimum: 0\n          type: integer\n          description: Number of characters in the content represented by the span.\n          format: int32\n      description: \"Contiguous region of the concatenated content property, specified as an offset\\nand length.\"\n    DocumentStyle:\n      required:\n        - spans\n        - confidence\n      type: object\n      properties:\n        isHandwritten:\n          type: boolean\n          description: Is content handwritten?\n        similarFontFamily:\n          type: string\n          description: \"Visually most similar font from among the set of supported font families, with\\nfallback fonts following CSS convention (ex. 'Arial, sans-serif').\"\n        fontStyle:\n          $ref: '#/components/schemas/DocumentFontStyle'\n        fontWeight:\n          $ref: '#/components/schemas/DocumentFontWeight'\n        color:\n          pattern: '^#[0-9a-f]{6}$'\n          type: string\n          description: 'Foreground color in #rrggbb hexadecimal format.'\n        backgroundColor:\n          pattern: '^#[0-9a-f]{6}$'\n          type: string\n          description: 'Background color in #rrggbb hexadecimal format..'\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the text elements in the concatenated content the style applies to.\n          x-ms-identifiers: [ ]\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly identifying the style.\n          format: float\n      description: An object representing observed text styles.\n    DocumentTable:\n      required:\n        - rowCount\n        - columnCount\n        - cells\n        - spans\n      type: object\n      properties:\n        rowCount:\n          minimum: 1\n          type: integer\n          description: Number of rows in the table.\n          format: int32\n        columnCount:\n          minimum: 1\n          type: integer\n          description: Number of columns in the table.\n          format: int32\n        cells:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentTableCell'\n          description: Cells contained within the table.\n          x-ms-identifiers: [ ]\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the table.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the table in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        caption:\n          $ref: '#/components/schemas/DocumentCaption'\n        footnotes:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentFootnote'\n          description: List of footnotes associated with the table.\n          x-ms-identifiers: [ ]\n      description: A table object consisting table cells arranged in a rectangular layout.\n    DocumentTableCell:\n      required:\n        - rowIndex\n        - columnIndex\n        - content\n        - spans\n      type: object\n      properties:\n        kind:\n          enum:\n            - content\n            - rowHeader\n            - columnHeader\n            - stubHead\n            - description\n          type: string\n          description: Table cell kind.\n          default: content\n          x-ms-enum:\n            name: DocumentTableCellKind\n            modelAsString: true\n            values:\n              - name: content\n                value: content\n                description: Contains the main content/data.\n              - name: rowHeader\n                value: rowHeader\n                description: Describes the content of the row.\n              - name: columnHeader\n                value: columnHeader\n                description: Describes the content of the column.\n              - name: stubHead\n                value: stubHead\n                description: 'Describes the row headers, usually located at the top left corner of a table.'\n              - name: description\n                value: description\n                description: Describes the content in (parts of) the table.\n        rowIndex:\n          type: integer\n          description: Row index of the cell.\n          format: int32\n        columnIndex:\n          type: integer\n          description: Column index of the cell.\n          format: int32\n        rowSpan:\n          minimum: 1\n          type: integer\n          description: Number of rows spanned by this cell.\n          format: int32\n          default: 1\n        columnSpan:\n          minimum: 1\n          type: integer\n          description: Number of columns spanned by this cell.\n          format: int32\n          default: 1\n        content:\n          type: string\n          description: Concatenated content of the table cell in reading order.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the table cell.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the table cell in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: Child elements of the table cell.\n      description: An object representing the location and content of a table cell.\n    DocumentTypeDetails:\n      type: object\n      properties:\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        buildMode:\n          $ref: '#/components/schemas/DocumentBuildMode'\n        fieldSchema:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentFieldSchema'\n          description: Description of the document semantic schema using a JSON Schema style syntax.\n        fieldConfidence:\n          type: object\n          additionalProperties:\n            type: number\n            format: float\n          description: Estimated confidence for each field.\n        modelId:\n          maxLength: 64\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Document model to use for analyzing documents with specified type.\n        confidenceThreshold:\n          type: number\n          description: Only perform analysis if docType confidence is above threshold.\n          format: float\n        features:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentAnalysisFeature'\n          description: List of optional analysis features.\n        queryFields:\n          type: array\n          items:\n            type: string\n          description: 'List of additional fields to extract.  Ex. \"NumberOfGuests,StoreNumber\"'\n        maxDocumentsToAnalyze:\n          type: integer\n          description: Maximum number of documents of specified type to analyze.  Default=all.\n          format: int32\n      description: Document type info.\n    DocumentWord:\n      required:\n        - content\n        - span\n        - confidence\n      type: object\n      properties:\n        content:\n          type: string\n          description: Text content of the word.\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the word, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\n        span:\n          $ref: '#/components/schemas/DocumentSpan'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the word.\n          format: float\n      description: \"A word object consisting of a contiguous sequence of characters.  For non-space\\ndelimited languages, such as Chinese, Japanese, and Korean, each character is\\nrepresented as its own word.\"\n    LengthUnit:\n      enum:\n        - pixel\n        - inch\n      type: string\n      description: 'The unit used by the width, height, and polygon properties. For images, the unit is \"pixel\". For PDF, the unit is \"inch\".'\n      x-ms-enum:\n        name: LengthUnit\n        modelAsString: true\n        values:\n          - name: pixel\n            value: pixel\n            description: Length unit for image files.\n          - name: inch\n            value: inch\n            description: Length unit for PDF files.\n    ModelCopyAuthorization:\n      required:\n        - targetResourceId\n        - targetResourceRegion\n        - targetModelId\n        - targetModelLocation\n        - accessToken\n        - expirationDateTime\n      type: object\n      properties:\n        targetResourceId:\n          type: string\n          description: ID of the target Azure resource where the document model should be copied to.\n        targetResourceRegion:\n          type: string\n          description: \"Location of the target Azure resource where the document model should be copied\\nto.\"\n        targetModelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Identifier of the target document model.\n        targetModelLocation:\n          type: string\n          description: URL of the copied document model in the target account.\n          format: uri\n        accessToken:\n          type: string\n          description: Token used to authorize the request.\n        expirationDateTime:\n          type: string\n          description: Date/time when the access token expires.\n          format: date-time\n      description: \"Authorization to copy a document model to the specified target resource and\\nmodelId.\"\n    OperationKind:\n      enum:\n        - documentModelBuild\n        - documentModelCompose\n        - documentModelCopyTo\n        - documentClassifierCopyTo\n        - documentClassifierBuild\n      type: string\n      description: Type of operation.\n      x-ms-enum:\n        name: OperationKind\n        modelAsString: true\n        values:\n          - name: documentModelBuild\n            value: documentModelBuild\n            description: Build a new custom document model.\n          - name: documentModelCompose\n            value: documentModelCompose\n            description: Compose a new custom document model from existing models.\n          - name: documentModelCopyTo\n            value: documentModelCopyTo\n            description: \"Copy an existing document model to potentially a different resource, region, or\\nsubscription.\"\n          - name: documentClassifierCopyTo\n            value: documentClassifierCopyTo\n            description: \"Copy an existing document classifier to potentially a different resource, region, or\\nsubscription.\"\n          - name: documentClassifierBuild\n            value: documentClassifierBuild\n            description: Build a new custom classifier model.\n    PagedAnalyzeBatchOperation:\n      required:\n        - value\n      type: object\n      properties:\n        value:\n          type: array\n          items:\n            $ref: '#/components/schemas/AnalyzeBatchOperation'\n          description: The AnalyzeBatchOperation items on this page\n          x-ms-identifiers: [ ]\n        nextLink:\n          type: string\n          description: The link to the next page of items\n          format: uri\n      description: Paged collection of AnalyzeBatchOperation items\n    PagedDocumentClassifierDetails:\n      required:\n        - value\n      type: object\n      properties:\n        value:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentClassifierDetails'\n          description: The DocumentClassifierDetails items on this page\n          x-ms-identifiers: [ ]\n        nextLink:\n          type: string\n          description: The link to the next page of items\n          format: uri\n      description: Paged collection of DocumentClassifierDetails items\n    PagedDocumentIntelligenceOperationDetails:\n      required:\n        - value\n      type: object\n      properties:\n        value:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n          description: The DocumentIntelligenceOperationDetails items on this page\n          x-ms-identifiers: [ ]\n        nextLink:\n          type: string\n          description: The link to the next page of items\n          format: uri\n      description: Paged collection of DocumentIntelligenceOperationDetails items\n    PagedDocumentModelDetails:\n      required:\n        - value\n      type: object\n      properties:\n        value:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentModelDetails'\n          description: The DocumentModelDetails items on this page\n          x-ms-identifiers: [ ]\n        nextLink:\n          type: string\n          description: The link to the next page of items\n          format: uri\n      description: Paged collection of DocumentModelDetails items\n    ParagraphRole:\n      enum:\n        - pageHeader\n        - pageFooter\n        - pageNumber\n        - title\n        - sectionHeading\n        - footnote\n        - formulaBlock\n      type: string\n      description: Semantic role of the paragraph.\n      x-ms-enum:\n        name: ParagraphRole\n        modelAsString: true\n        values:\n          - name: pageHeader\n            value: pageHeader\n            description: Text near the top edge of the page.\n          - name: pageFooter\n            value: pageFooter\n            description: Text near the bottom edge of the page.\n          - name: pageNumber\n            value: pageNumber\n            description: Page number.\n          - name: title\n            value: title\n            description: Top-level title describing the entire document.\n          - name: sectionHeading\n            value: sectionHeading\n            description: Sub heading describing a section of the document.\n          - name: footnote\n            value: footnote\n            description: A note usually placed after the main content on a page.\n          - name: formulaBlock\n            value: formulaBlock\n            description: 'A block of formulas, often with shared alignment.'\n    StringIndexType:\n      enum:\n        - textElements\n        - unicodeCodePoint\n        - utf16CodeUnit\n      type: string\n      description: Method used to compute string offset and length.\n      x-ms-enum:\n        name: StringIndexType\n        modelAsString: true\n        values:\n          - name: textElements\n            value: textElements\n            description: \"User-perceived display character, or grapheme cluster, as defined by Unicode\\n8.0.0.\"\n          - name: unicodeCodePoint\n            value: unicodeCodePoint\n            description: Character unit represented by a single unicode code point.  Used by Python 3.\n          - name: utf16CodeUnit\n            value: utf16CodeUnit\n            description: \"Character unit represented by a 16-bit Unicode code unit.  Used by JavaScript,\\nJava, and .NET.\"\n    Input:\n      type: object\n    DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ImagePngResp:\n      type: file\n    DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ApplicationJ:\n      type: file\n    DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationPdfResponse:\n      type: file\n    DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationJsonResponse:\n      type: file\n  securitySchemes:\n    apiKeyHeader:\n      type: apiKey\n      name: Ocp-Apim-Subscription-Key\n      in: header\n    apiKeyQuery:\n      type: apiKey\n      name: subscription-key\n      in: query\nsecurity:\n  - apiKeyHeader: [ ]\n  - apiKeyQuery: [ ]",
            "$fxv#6": "<policies>\n    <inbound>\n        <base />\n        <!-- AAD Authorization -->\n        <!-- Enabled if entra-validate named value is set to true -->\n        <include-fragment fragment-id=\"aad-auth\" />\n\n        <set-header name=\"api-key\" exists-action=\"delete\" />\n        \n        <!-- Setting cache keys -->\n        <set-variable name=\"deployment-id\" value=\"@{\n            var modelId = context.Request.MatchedParameters.GetValueOrDefault(\"modelId\", \"\");\n            var classifierId = context.Request.MatchedParameters.GetValueOrDefault(\"classifierId\", \"\");\n            \n            if (!string.IsNullOrEmpty(modelId))\n            {\n                return modelId;\n            }\n            else if (!string.IsNullOrEmpty(classifierId))\n            {\n                return classifierId;\n            }\n            else\n            {\n                return \"Document-Intelligence\";\n            }\n        }\" />\n        \n        <set-variable name=\"routesCacheKey\" value=\"@((string)context.Variables[\"deployment-id\"] + \"Routes\" + context.Deployment.Region + context.Api.Revision)\" />\n        <set-variable name=\"oaClustersCacheKey\" value=\"@(\"aiDocIntelInstance\" + context.Deployment.Region + context.Api.Revision)\" />\n        <cache-lookup-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-DOCINTELL\"))\" variable-name=\"oaClusters\" />\n        <!-- If we can't find the configuration cached, it will be loaded -->\n        <choose>\n            <when condition=\"@(context.Variables.ContainsKey(\"oaClusters\") == false)\">\n                <set-variable name=\"oaClusters\" value=\"@{\n                        // route is an Azure Document Intelligence endpoint\n                        JArray routes = new JArray();\n\n                        // cluster is a group of routes that are capable of serving a specific model name\n                        JArray clusters = new JArray();\n\n                        // Update the below if condition when using multiple APIM gateway regions/SHGW to get different configurations for each region\n                        if(context.Deployment.Region == \"ALL\" || true)\n                        {\n                            // Adding all Azure Document Intelligence endpoints routes (which are set as APIM Backend)\n                            routes.Add(new JObject()\n                            {\n                                { \"name\", \"Doc-Intelligence-EUS\" },\n                                { \"location\", \"East US\" },\n                                { \"backend-id\", \"REPLACE-BACKEND-ID\" },\n                                { \"priority\", 1},\n                                { \"isThrottling\", false }, \n                                { \"retryAfter\", DateTime.MinValue } \n                            });\n\n                            // For each model, create a cluster with the routes that can serve it\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-read\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-layout\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-healthInsuranceCard.us\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-invoice\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-receipt\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-idDocument\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n                        }\n                        else\n                        {\n                            //No clusters found for selected region, either return error (default behavior) or set default cluster in the else section\n                        }\n                        \n                        return clusters;   \n                    }\" />\n                <!-- Add cluster configurations to cache -->\n                <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-DOCINTELL\"))\" value=\"@((JArray)context.Variables[\"oaClusters\"])\" duration=\"86400\" />\n            </when>\n        </choose>\n        <include-fragment fragment-id=\"validate-routes\" />\n        <authentication-managed-identity resource=\"https://cognitiveservices.azure.com\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\n        <set-header name=\"Authorization\" exists-action=\"override\">\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\n        </set-header>\n    </inbound>\n    <backend>\n        <include-fragment fragment-id=\"backend-routing\" />\n    </backend>\n    <outbound>\n        <base />\n        <set-variable name=\"idPrefix\" value=\"doc-Intel\" />\n        <set-variable name=\"targetService\" value=\"AI-Document-Intelligence\" />\n        <set-variable name=\"model\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-Document-Intelligence-Model\"))\" />\n        <set-variable name=\"deploymentName\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-DOCUMENT-INTELLIGENCE\"))\" />\n\n        <!-- Store original response body -->\n        <set-variable name=\"responseBody\" value=\"@(context.Response.Body.As<string>())\" />\n\n        <!-- Attempt to parse JSON and set variables -->\n        <set-variable name=\"isValidJson\" value=\"@{\n            try \n            {\n                var responseJson = JObject.Parse((string)context.Variables[\"responseBody\"]);\n                return true;\n            }\n            catch\n            {\n                return false;\n            }\n        }\" />\n\n        <choose>\n            <when condition=\"@((bool)context.Variables[\"isValidJson\"])\">\n                <set-variable name=\"numberOfPages\" value=\"@{\n                    try \n                    {\n                        var parsedBody = (JObject)context.Variables[\"parsedBody\"];\n                        var pages = parsedBody.SelectToken(\"analyzeResult.pages\");\n                        return pages != null ? pages.Count() : 1;\n                    }\n                    catch\n                    {\n                        return 1;\n                    }\n                }\" />\n\n                <set-variable name=\"modelId\" value=\"@{\n                    try \n                    {\n                        var parsedBody = (JObject)context.Variables[\"parsedBody\"];\n                        var modelId = parsedBody.SelectToken(\"analyzeResult.modelId\");\n                        return modelId != null ? modelId.ToString() : \"Document-Intelligence\";\n                    }\n                    catch\n                    {\n                        return \"Document-Intelligence\";\n                    }\n                }\" />\n            </when>\n        </choose>\n\n        <!-- Add dynamic header transformation -->\n        <set-header name=\"operation-location\" exists-action=\"override\">\n            <value>@{\n                var originalLocation = context.Response.Headers.GetValueOrDefault(\"operation-location\",\"\");\n                if (!string.IsNullOrEmpty(originalLocation)) {\n                    var uri = new Uri(originalLocation);\n                    return originalLocation.Replace(\n                        uri.Host,\n                        context.Request.OriginalUrl.Host\n                    );\n                }\n                return originalLocation;\n            }</value>\n        </set-header>\n\n        <include-fragment fragment-id=\"ai-usage\" />\n\n        <!-- Return response body -->\n        <set-body>@((string)context.Variables[\"responseBody\"])</set-body>\n    </outbound>\n    <on-error>\n        <base />\n        <set-variable name=\"service-name\" value=\"Azure Document Intelligence\" />\n        <set-variable name=\"target-deployment\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-Document-Intelligence-Model\"))\" />\n        \n        <!-- <include-fragment fragment-id=\"throttling-events\" /> -->\n    </on-error>\n</policies>",
            "$fxv#7": "openapi: 3.0.1\ninfo:\n  title: Azure Document Intelligence\n  description: 'Extracts content, layout, and structured data from documents.'\n  version: '1.0'\nservers:\n  - url: https://REPLACED-BY-POLICY/documentintelligence\npaths:\n  /documentClassifiers:\n    get:\n      summary: DocumentClassifiers_ListClassifiers\n      description: List all document classifiers.\n      operationId: DocumentClassifiers_ListClassifiers\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/PagedDocumentClassifierDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentClassifiers/{classifierId}':\n    get:\n      summary: DocumentClassifiers_GetClassifier\n      description: Gets detailed document classifier information.\n      operationId: DocumentClassifiers_GetClassifier\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentClassifierDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n    delete:\n      summary: DocumentClassifiers_DeleteClassifier\n      description: Deletes document classifier.\n      operationId: DocumentClassifiers_DeleteClassifier\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '204':\n          description: 'There is no content to send for this request, but the headers may be useful. '\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentClassifiers/{classifierId}:analyze':\n    post:\n      summary: DocumentClassifiers_ClassifyDocumentFromStream\n      description: \"Classifies document with document classifier. This operation can be used in two ways:\\n1. With a binary document stream in the request body (current endpoint)\\n2. With a ClassifyDocumentRequest object containing URL or base64-encoded document (add '_overload=classifyDocument' query parameter)\"\n      operationId: DocumentClassifiers_ClassifyDocumentFromStream\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\n        - $ref: '#/components/parameters/SplitParameter'\n        - $ref: '#/components/parameters/PagesParameter'\n        - name: _overload\n          in: query\n          description: Optional parameter to specify the operation variant. Use 'classifyDocument' for URL or base64 encoded document input.\n          schema:\n            enum:\n              - classifyDocument\n            type: string\n      requestBody:\n        description: Input content. Can be either a binary document stream or a ClassifyDocumentRequest object depending on the _overload parameter.\n        content:\n          application/octet-stream:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/pdf:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/jpeg:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/png:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/tiff:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/bmp:\n            schema:\n              $ref: '#/components/schemas/Input'\n          image/heif:\n            schema:\n              $ref: '#/components/schemas/Input'\n          text/html:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/vnd.openxmlformats-officedocument.wordprocessingml.document:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/vnd.openxmlformats-officedocument.presentationml.presentation:\n            schema:\n              $ref: '#/components/schemas/Input'\n          application/json:\n            schema:\n              $ref: '#/components/schemas/Input'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of AnalyzeOperation\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentClassifiers/{classifierId}:copyTo':\n    post:\n      summary: DocumentClassifiers_CopyClassifierTo\n      description: 'Copies document classifier to the target resource, region, and classifierId.'\n      operationId: DocumentClassifiers_CopyClassifierTo\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Copy to request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/ClassifierCopyAuthorization'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentClassifierCopyToOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentClassifiers/{classifierId}/analyzeResults/{resultId}':\n    get:\n      summary: DocumentClassifiers_GetClassifyResult\n      description: Gets the result of document classifier.\n      operationId: DocumentClassifiers_GetClassifyResult\n      parameters:\n        - $ref: '#/components/parameters/ClassifierIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/AnalyzeOperation'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentClassifiers:authorizeCopy:\n    post:\n      summary: DocumentClassifiers_AuthorizeClassifierCopy\n      description: \"Generates authorization to copy a document classifier to this location with\\nspecified classifierId and optional description.\"\n      operationId: DocumentClassifiers_AuthorizeClassifierCopy\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Authorize copy request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/AuthorizeClassifierCopyRequest'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ClassifierCopyAuthorization'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentClassifiers:build:\n    post:\n      summary: DocumentClassifiers_BuildClassifier\n      description: Builds a custom document classifier.\n      operationId: DocumentClassifiers_BuildClassifier\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Build request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/BuildDocumentClassifierRequest'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentClassifierBuildOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentModels:\n    get:\n      summary: DocumentModels_ListModels\n      description: List all document models\n      operationId: DocumentModels_ListModels\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/PagedDocumentModelDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}:analyze':\n    post:\n      summary: DocumentModels_AnalyzeDocument\n      description: \"Analyzes document with document model. This operation can be used in two ways:\\n1. With a binary document stream in the request body (when _overload is not specified)\\n2. With an AnalyzeDocumentRequest object containing URL or base64-encoded document (add '_overload=analyzeDocument' query parameter)\"\n      operationId: DocumentModels_AnalyzeDocument\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/PagesParameter'\n        - $ref: '#/components/parameters/LocaleParameter'\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\n        - $ref: '#/components/parameters/FeaturesParameter'\n        - $ref: '#/components/parameters/QueryFieldsParameter'\n        - $ref: '#/components/parameters/OutputContentFormatParameter'\n        - $ref: '#/components/parameters/OutputParameter'\n        - name: _overload\n          in: query\n          description: Optional parameter to specify the operation variant. Use 'analyzeDocument' for URL or base64 encoded document input.\n          schema:\n            enum:\n              - analyzeDocument\n            type: string\n      requestBody:\n        description: Input content. Can be either a binary document stream or an AnalyzeDocumentRequest object depending on the _overload parameter.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/Input'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of AnalyzeOperation\n              schema:\n                type: string\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}:analyzeBatch':\n    post:\n      summary: DocumentModels_AnalyzeBatchDocuments\n      description: Analyzes batch documents with document model.\n      operationId: DocumentModels_AnalyzeBatchDocuments\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/PagesParameter'\n        - $ref: '#/components/parameters/LocaleParameter'\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\n        - $ref: '#/components/parameters/FeaturesParameter'\n        - $ref: '#/components/parameters/QueryFieldsParameter'\n        - $ref: '#/components/parameters/OutputContentFormatParameter'\n        - $ref: '#/components/parameters/OutputParameter'\n      requestBody:\n        description: Analyze batch request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/AnalyzeBatchDocumentsRequest'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of AnalyzeBatchOperation\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}':\n    get:\n      summary: DocumentModels_GetModel\n      description: Gets detailed document model information.\n      operationId: DocumentModels_GetModel\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentModelDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n    delete:\n      summary: DocumentModels_DeleteModel\n      description: Deletes document model.\n      operationId: DocumentModels_DeleteModel\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '204':\n          description: 'There is no content to send for this request, but the headers may be useful. '\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}:copyTo':\n    post:\n      summary: DocumentModels_CopyModelTo\n      description: 'Copies document model to the target resource, region, and modelId.'\n      operationId: DocumentModels_CopyModelTo\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Copy to request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/ModelCopyAuthorization'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentModelCopyToOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeBatchResults':\n    get:\n      summary: DocumentModels_ListAnalyzeBatchResults\n      description: List batch document analysis results.\n      operationId: DocumentModels_ListAnalyzeBatchResults\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/PagedAnalyzeBatchOperation'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeBatchResults/{resultId}':\n    get:\n      summary: DocumentModels_GetAnalyzeBatchResult\n      description: Gets the result of batch document analysis.\n      operationId: DocumentModels_GetAnalyzeBatchResult\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/AnalyzeBatchOperation'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n    delete:\n      summary: DocumentModels_DeleteAnalyzeBatchResult\n      description: Mark the batch document analysis result for deletion.\n      operationId: DocumentModels_DeleteAnalyzeBatchResult\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '204':\n          description: 'There is no content to send for this request, but the headers may be useful.'\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeResults/{resultId}':\n    get:\n      summary: DocumentModels_GetAnalyzeResult\n      description: Gets the result of document analysis.\n      operationId: DocumentModels_GetAnalyzeResult\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/AnalyzeOperation'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n    delete:\n      summary: DocumentModels_DeleteAnalyzeResult\n      description: Mark the result of document analysis for deletion.\n      operationId: DocumentModels_DeleteAnalyzeResult\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '204':\n          description: 'There is no content to send for this request, but the headers may be useful.'\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeResults/{resultId}/figures/{figureId}':\n    get:\n      summary: DocumentModels_GetAnalyzeResultFigure\n      description: Gets the generated cropped image of specified figure from document analysis.\n      operationId: DocumentModels_GetAnalyzeResultFigure\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/FigureIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            image/png:\n              schema:\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ImagePngResp'\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ApplicationJ'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/documentModels/{modelId}/analyzeResults/{resultId}/pdf':\n    get:\n      summary: DocumentModels_GetAnalyzeResultPdf\n      description: Gets the generated searchable PDF output from document analysis.\n      operationId: DocumentModels_GetAnalyzeResultPdf\n      parameters:\n        - $ref: '#/components/parameters/ModelIdParameter'\n        - $ref: '#/components/parameters/ResultIdParameter'\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/pdf:\n              schema:\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationPdfResponse'\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationJsonResponse'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentModels:authorizeCopy:\n    post:\n      summary: DocumentModels_AuthorizeModelCopy\n      description: \"Generates authorization to copy a document model to this location with\\nspecified modelId and optional description.\"\n      operationId: DocumentModels_AuthorizeModelCopy\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Authorize copy request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/AuthorizeCopyRequest'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ModelCopyAuthorization'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentModels:build:\n    post:\n      summary: DocumentModels_BuildModel\n      description: Builds a custom document analysis model.\n      operationId: DocumentModels_BuildModel\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Build request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/BuildDocumentModelRequest'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentModelBuildOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /documentModels:compose:\n    post:\n      summary: DocumentModels_ComposeModel\n      description: Creates a new document model from document types of existing document models.\n      operationId: DocumentModels_ComposeModel\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      requestBody:\n        description: Compose request parameters.\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/ComposeDocumentModelRequest'\n      responses:\n        '202':\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\n          headers:\n            Operation-Location:\n              description: The location of an instance of DocumentModelComposeOperationDetails\n              schema:\n                type: string\n                format: uri\n            Retry-After:\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n              schema:\n                type: integer\n                format: int32\n          content:\n            application/json: { }\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /info:\n    get:\n      summary: MiscellaneousOperations_GetResourceDetails\n      description: Return information about the current resource.\n      operationId: MiscellaneousOperations_GetResourceDetails\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentIntelligenceResourceDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  /operations:\n    get:\n      summary: MiscellaneousOperations_ListOperations\n      description: Lists all operations.\n      operationId: MiscellaneousOperations_ListOperations\n      parameters:\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/PagedDocumentIntelligenceOperationDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\n  '/operations/{operationId}':\n    get:\n      summary: MiscellaneousOperations_GetOperation\n      description: \"Gets operation info. Different operation types can be retrieved:\\n1. General operation: no _overload parameter needed\\n2. Document Model Build operation: use _overload=getDocumentModelBuildOperation\\n3. Document Model Compose operation: use _overload=getDocumentModelComposeOperation\\n4. Document Model Copy To operation: use _overload=getDocumentModelCopyToOperation\\n5. Document Classifier Copy To operation: use _overload=getDocumentClassifierCopyToOperation\\n6. Document Classifier Build operation: use _overload=getDocumentClassifierBuildOperation\"\n      operationId: MiscellaneousOperations_GetOperation\n      parameters:\n        - name: operationId\n          in: path\n          description: Operation ID\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/ApiVersionParameter'\n        - name: _overload\n          in: query\n          description: Optional parameter to specify the operation type to retrieve.\n          schema:\n            enum:\n              - getOperation\n              - getDocumentModelBuildOperation\n              - getDocumentModelComposeOperation\n              - getDocumentModelCopyToOperation\n              - getDocumentClassifierCopyToOperation\n              - getDocumentClassifierBuildOperation\n            type: string\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\n      responses:\n        '200':\n          description: The request has succeeded.\n          headers:\n            x-ms-client-request-id:\n              $ref: '#/components/headers/ClientRequestIdHeader'\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n        '500':\n          $ref: '#/components/responses/ErrorResponse'\ncomponents:\n  parameters:\n    ApiVersionParameter:\n      name: api-version\n      in: query\n      description: The API version to use for this operation.\n      required: true\n      schema:\n        minLength: 1\n        type: string\n    ClientRequestIdParameter:\n      name: x-ms-client-request-id\n      in: header\n      description: 'An opaque, globally-unique, client-generated string identifier for the request.'\n      schema:\n        type: string\n        format: uuid\n    ClassifierIdParameter:\n      name: classifierId\n      in: path\n      description: Unique document classifier name.\n      required: true\n      schema:\n        maxLength: 64\n        pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n        type: string\n    ModelIdParameter:\n      name: modelId\n      in: path\n      description: Unique document model name.\n      required: true\n      schema:\n        maxLength: 64\n        pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n        type: string\n    ResultIdParameter:\n      name: resultId\n      in: path\n      description: Operation result ID.\n      required: true\n      schema:\n        type: string\n        format: uuid\n    PagesParameter:\n      name: pages\n      in: query\n      description: '1-based page numbers to analyze. Ex. \"1-3,5,7-9\"'\n      schema:\n        pattern: '^(\\d+(-\\d+)?)(,\\s*(\\d+(-\\d+)?))*$'\n        type: string\n    StringIndexTypeParameter:\n      name: stringIndexType\n      in: query\n      description: Method used to compute string offset and length.\n      schema:\n        enum:\n          - textElements\n          - unicodeCodePoint\n          - utf16CodeUnit\n        type: string\n        default: textElements\n    SplitParameter:\n      name: split\n      in: query\n      description: Document splitting mode.\n      schema:\n        enum:\n          - auto\n          - none\n          - perPage\n        type: string\n        default: none\n    LocaleParameter:\n      name: locale\n      in: query\n      description: \"Locale hint for text recognition and document analysis.  Value may contain only\\nthe language code (ex. \\\"en\\\", \\\"fr\\\") or BCP 47 language tag (ex. \\\"en-US\\\").\"\n      schema:\n        type: string\n    FeaturesParameter:\n      name: features\n      in: query\n      description: List of optional analysis features.\n      schema:\n        type: array\n        items:\n          enum:\n            - ocrHighResolution\n            - languages\n            - barcodes\n            - formulas\n            - keyValuePairs\n            - styleFont\n            - queryFields\n          type: string\n          x-ms-enum:\n            name: DocumentAnalysisFeature\n            modelAsString: true\n            values:\n              - name: ocrHighResolution\n                value: ocrHighResolution\n                description: Perform OCR at a higher resolution to handle documents with fine print.\n              - name: languages\n                value: languages\n                description: Enable the detection of the text content language.\n              - name: barcodes\n                value: barcodes\n                description: Enable the detection of barcodes in the document.\n              - name: formulas\n                value: formulas\n                description: Enable the detection of mathematical expressions in the document.\n              - name: keyValuePairs\n                value: keyValuePairs\n                description: Enable the detection of general key value pairs (form fields) in the document.\n              - name: styleFont\n                value: styleFont\n                description: Enable the recognition of various font styles.\n              - name: queryFields\n                value: queryFields\n                description: Enable the extraction of additional fields via the queryFields query parameter.\n    QueryFieldsParameter:\n      name: queryFields\n      in: query\n      description: 'List of additional fields to extract.  Ex. \"NumberOfGuests,StoreNumber\"'\n      schema:\n        type: array\n        items:\n          type: string\n    OutputContentFormatParameter:\n      name: outputContentFormat\n      in: query\n      description: Format of the analyze result top-level content.\n      schema:\n        enum:\n          - text\n          - markdown\n        type: string\n        default: text\n    OutputParameter:\n      name: output\n      in: query\n      description: Additional outputs to generate during analysis.\n      schema:\n        type: array\n        items:\n          enum:\n            - pdf\n            - figures\n          type: string\n          x-ms-enum:\n            name: AnalyzeOutputOption\n            modelAsString: true\n            values:\n              - name: pdf\n                value: pdf\n                description: Generate searchable PDF output.\n              - name: figures\n                value: figures\n                description: Generate cropped images of detected figures.\n    FigureIdParameter:\n      name: figureId\n      in: path\n      description: Figure ID.\n      required: true\n      schema:\n        type: string\n  headers:\n    ClientRequestIdHeader:\n      description: 'An opaque, globally-unique, client-generated string identifier for the request.'\n      schema:\n        type: string\n        format: uuid\n  responses:\n    ErrorResponse:\n      description: An unexpected error response.\n      content:\n        application/json:\n          schema:\n            $ref: '#/components/schemas/DocumentIntelligenceErrorResponse'\n    NoContentResponse:\n      description: 'There is no content to send for this request, but the headers may be useful.'\n      headers:\n        x-ms-client-request-id:\n          $ref: '#/components/headers/ClientRequestIdHeader'\n      content:\n        application/json: {}\n    AcceptedResponse:\n      description: 'The request has been accepted for processing, but processing has not yet completed.'\n      headers:\n        Operation-Location:\n          description: The location of an instance of the operation\n          schema:\n            type: string\n            format: uri\n        Retry-After:\n          description: The Retry-After header can indicate how long the client should wait before polling the operation status.\n          schema:\n            type: integer\n            format: int32\n      content:\n        application/json: {}\n  schemas:\n    AddressValue:\n      type: object\n      properties:\n        houseNumber:\n          type: string\n          description: House or building number.\n        poBox:\n          type: string\n          description: Post office box number.\n        road:\n          type: string\n          description: Street name.\n        city:\n          type: string\n          description: 'Name of city, town, village, etc.'\n        state:\n          type: string\n          description: First-level administrative division.\n        postalCode:\n          type: string\n          description: Postal code used for mail sorting.\n        countryRegion:\n          type: string\n          description: Country/region.\n        streetAddress:\n          type: string\n          description: 'Street-level address, excluding city, state, countryRegion, and postalCode.'\n        unit:\n          type: string\n          description: Apartment or office number\n        cityDistrict:\n          type: string\n          description: \"Districts or boroughs within a city, such as Brooklyn in New York City or City\\nof Westminster in London.\"\n        stateDistrict:\n          type: string\n          description: Second-level administrative division used in certain locales.\n        suburb:\n          type: string\n          description: 'Unofficial neighborhood name, like Chinatown.'\n        house:\n          type: string\n          description: 'Build name, such as World Trade Center.'\n        level:\n          type: string\n          description: 'Floor number, such as 3F.'\n      description: Address field value.\n    AnalyzeBatchDocumentsRequest:\n      required:\n        - resultContainerUrl\n      type: object\n      properties:\n        azureBlobSource:\n          $ref: '#/components/schemas/AzureBlobContentSource'\n        azureBlobFileListSource:\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\n        resultContainerUrl:\n          type: string\n          description: Azure Blob Storage container URL where analyze result files will be stored.\n          format: uri\n        resultPrefix:\n          type: string\n          description: Blob name prefix of result files.\n        overwriteExisting:\n          type: boolean\n          description: Overwrite existing analyze result files?\n          default: false\n      description: Batch document analysis parameters.\n    AnalyzeBatchOperation:\n      required:\n        - status\n        - createdDateTime\n        - lastUpdatedDateTime\n      type: object\n      properties:\n        resultId:\n          $ref: '#/components/schemas/Azure.Core.uuid'\n        status:\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the operation was submitted.\n          format: date-time\n        lastUpdatedDateTime:\n          type: string\n          description: Date and time (UTC) when the status was last updated.\n          format: date-time\n        percentCompleted:\n          maximum: 100\n          minimum: 0\n          type: integer\n          description: Operation progress (0-100).\n          format: int32\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n        result:\n          $ref: '#/components/schemas/AnalyzeBatchResult'\n      description: Status and result of the analyze batch operation.\n    AnalyzeBatchOperationDetail:\n      required:\n        - status\n        - sourceUrl\n      type: object\n      properties:\n        status:\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\n        sourceUrl:\n          type: string\n          description: URL of the source document.\n          format: uri\n        resultUrl:\n          type: string\n          description: URL of the analyze result JSON.\n          format: uri\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n      description: Operation detail for a document in a batch analysis.\n    AnalyzeBatchResult:\n      required:\n        - succeededCount\n        - failedCount\n        - skippedCount\n      type: object\n      properties:\n        succeededCount:\n          type: integer\n          description: Number of documents that completed with status succeeded.\n          format: int32\n        failedCount:\n          type: integer\n          description: Number of documents that completed with status failed.\n          format: int32\n        skippedCount:\n          type: integer\n          description: Number of documents that completed with status skipped.\n          format: int32\n        details:\n          type: array\n          items:\n            $ref: '#/components/schemas/AnalyzeBatchOperationDetail'\n          description: Operation detail for each document in the batch.\n          x-ms-identifiers: [ ]\n      description: Batch document analysis result.\n    AnalyzeDocumentRequest:\n      type: object\n      properties:\n        urlSource:\n          type: string\n          description: Document URL to analyze.  Either urlSource or base64Source must be specified.\n          format: uri\n        base64Source:\n          type: string\n          description: \"Base64 encoding of the document to analyze.  Either urlSource or base64Source\\nmust be specified.\"\n          format: byte\n      description: Document analysis parameters.\n    AnalyzeOperation:\n      required:\n        - status\n        - createdDateTime\n        - lastUpdatedDateTime\n      type: object\n      properties:\n        status:\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the analyze operation was submitted.\n          format: date-time\n        lastUpdatedDateTime:\n          type: string\n          description: Date and time (UTC) when the status was last updated.\n          format: date-time\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n        analyzeResult:\n          $ref: '#/components/schemas/AnalyzeResult'\n      description: Status and result of the analyze operation.\n    AnalyzeResult:\n      required:\n        - apiVersion\n        - modelId\n        - stringIndexType\n        - content\n        - pages\n      type: object\n      properties:\n        apiVersion:\n          type: string\n          description: API version used to produce this result.\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Document model ID used to produce this result.\n        stringIndexType:\n          $ref: '#/components/schemas/StringIndexType'\n        contentFormat:\n          $ref: '#/components/schemas/DocumentContentFormat'\n        content:\n          type: string\n          description: \"Concatenate string representation of all textual and visual elements in reading\\norder.\"\n        pages:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentPage'\n          description: Analyzed pages.\n          x-ms-identifiers: [ ]\n        paragraphs:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentParagraph'\n          description: Extracted paragraphs.\n          x-ms-identifiers: [ ]\n        tables:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentTable'\n          description: Extracted tables.\n          x-ms-identifiers: [ ]\n        figures:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentFigure'\n          description: Extracted figures.\n        sections:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSection'\n          description: Extracted sections.\n          x-ms-identifiers: [ ]\n        keyValuePairs:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentKeyValuePair'\n          description: Extracted key-value pairs.\n          x-ms-identifiers: [ ]\n        styles:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentStyle'\n          description: Extracted font styles.\n          x-ms-identifiers: [ ]\n        languages:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentLanguage'\n          description: Detected languages.\n          x-ms-identifiers: [ ]\n        documents:\n          type: array\n          items:\n            $ref: '#/components/schemas/AnalyzedDocument'\n          description: Extracted documents.\n          x-ms-identifiers: [ ]\n        warnings:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\n          description: List of warnings encountered.\n          x-ms-identifiers: [ ]\n      description: Document analysis result.\n    AnalyzedDocument:\n      required:\n        - docType\n        - spans\n        - confidence\n      type: object\n      properties:\n        docType:\n          maxLength: 64\n          minLength: 2\n          type: string\n          description: Document type.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the document.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the document in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        fields:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentField'\n          description: Dictionary of named field values.\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the document.\n          format: float\n      description: An object describing the location and semantic content of a document.\n    AuthorizeClassifierCopyRequest:\n      required:\n        - classifierId\n      type: object\n      properties:\n        classifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document classifier name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document classifier description.\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document classifier.\n      description: Request body to authorize document classifier copy.\n    AuthorizeCopyRequest:\n      required:\n        - modelId\n      type: object\n      properties:\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document model name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n      description: Request body to authorize document model copy.\n    Azure.Core.uuid:\n      type: string\n      description: Universally Unique Identifier\n      format: uuid\n    AzureBlobContentSource:\n      required:\n        - containerUrl\n      type: object\n      properties:\n        containerUrl:\n          type: string\n          description: Azure Blob Storage container URL.\n          format: uri\n        prefix:\n          type: string\n          description: Blob name prefix.\n      description: Azure Blob Storage content.\n    AzureBlobFileListContentSource:\n      required:\n        - containerUrl\n        - fileList\n      type: object\n      properties:\n        containerUrl:\n          type: string\n          description: Azure Blob Storage container URL.\n          format: uri\n        fileList:\n          type: string\n          description: Path to a JSONL file within the container specifying a subset of documents.\n      description: File list in Azure Blob Storage.\n    BoundingRegion:\n      required:\n        - pageNumber\n        - polygon\n      type: object\n      properties:\n        pageNumber:\n          minimum: 1\n          type: integer\n          description: 1-based page number of page containing the bounding region.\n          format: int32\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon on the page, or the entire page if not specified.\\nCoordinates specified relative to the top-left of the page. The numbers\\nrepresent the x, y values of the polygon vertices, clockwise from the left\\n(-180 degrees inclusive) relative to the element orientation.\"\n      description: Bounding polygon on a specific page of the input.\n    BuildDocumentClassifierRequest:\n      required:\n        - classifierId\n        - docTypes\n      type: object\n      properties:\n        classifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document classifier name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document classifier description.\n        baseClassifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Base classifierId on top of which to train the classifier.\n        docTypes:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/ClassifierDocumentTypeDetails'\n          description: List of document types to classify against.\n        allowOverwrite:\n          type: boolean\n          description: Allow overwriting an existing classifier with the same name.\n          default: false\n      description: Request body to build a new custom document classifier.\n    BuildDocumentModelRequest:\n      required:\n        - modelId\n        - buildMode\n      type: object\n      properties:\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document model name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        buildMode:\n          $ref: '#/components/schemas/DocumentBuildMode'\n        azureBlobSource:\n          $ref: '#/components/schemas/AzureBlobContentSource'\n        azureBlobFileListSource:\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n        maxTrainingHours:\n          type: number\n          description: Max number of V100-equivalent GPU hours to use for model training.  Default=0.5.\n          format: float\n          default: 0.5\n        allowOverwrite:\n          type: boolean\n          description: Allow overwriting an existing model with the same name.\n          default: false\n      description: Request body to build a new custom document model.\n    ClassifierCopyAuthorization:\n      required:\n        - targetResourceId\n        - targetResourceRegion\n        - targetClassifierId\n        - targetClassifierLocation\n        - accessToken\n        - expirationDateTime\n      type: object\n      properties:\n        targetResourceId:\n          type: string\n          description: ID of the target Azure resource where the document classifier should be copied to.\n        targetResourceRegion:\n          type: string\n          description: \"Location of the target Azure resource where the document classifier should be copied\\nto.\"\n        targetClassifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Identifier of the target document classifier.\n        targetClassifierLocation:\n          type: string\n          description: URL of the copied document classifier in the target account.\n          format: uri\n        accessToken:\n          type: string\n          description: Token used to authorize the request.\n        expirationDateTime:\n          type: string\n          description: Date/time when the access token expires.\n          format: date-time\n      description: \"Authorization to copy a document classifier to the specified target resource and\\nclassifierId.\"\n    ClassifierDocumentTypeDetails:\n      type: object\n      properties:\n        sourceKind:\n          $ref: '#/components/schemas/ContentSourceKind'\n        azureBlobSource:\n          $ref: '#/components/schemas/AzureBlobContentSource'\n        azureBlobFileListSource:\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\n      description: Classifier document type info.\n    ClassifyDocumentRequest:\n      type: object\n      properties:\n        urlSource:\n          type: string\n          description: Document URL to classify.  Either urlSource or base64Source must be specified.\n          format: uri\n        base64Source:\n          type: string\n          description: \"Base64 encoding of the document to classify.  Either urlSource or base64Source\\nmust be specified.\"\n          format: byte\n      description: Document classification parameters.\n    ComposeDocumentModelRequest:\n      required:\n        - modelId\n        - classifierId\n        - docTypes\n      type: object\n      properties:\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document model name.\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        classifierId:\n          type: string\n          description: Custom classifier to split and classify the input file.\n        split:\n          enum:\n            - auto\n            - none\n            - perPage\n          type: string\n          description: File splitting behavior.\n          default: none\n          x-ms-enum:\n            name: SplitMode\n            modelAsString: true\n            values:\n              - name: auto\n                value: auto\n                description: Automatically split file into documents.\n              - name: none\n                value: none\n                description: Treat the entire file as a single document.\n              - name: perPage\n                value: perPage\n                description: Treat each page in the file as a separate document.\n        docTypes:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentTypeDetails'\n          description: Dictionary mapping supported docTypes to the corresponding document models.\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n      description: Request body to create a composed document model from component document models.\n    ContentSourceKind:\n      enum:\n        - url\n        - base64\n        - azureBlob\n        - azureBlobFileList\n      type: string\n      description: Type of content source.\n      x-ms-enum:\n        name: ContentSourceKind\n        modelAsString: true\n        values:\n          - name: url\n            value: url\n            description: Content at a specific URL.\n          - name: base64\n            value: base64\n            description: Content represented via Base64 encoding.\n          - name: azureBlob\n            value: azureBlob\n            description: Files in a path within an Azure Blob Storage container.\n          - name: azureBlobFileList\n            value: azureBlobFileList\n            description: A file list specifying individual files in an Azure Blob Storage container.\n    CurrencyValue:\n      required:\n        - amount\n      type: object\n      properties:\n        amount:\n          type: number\n          description: Currency amount.\n          format: double\n        currencySymbol:\n          type: string\n          description: 'Currency symbol label, if any.'\n        currencyCode:\n          type: string\n          description: 'Resolved currency code (ISO 4217), if any.'\n      description: Currency field value.\n    CustomDocumentModelsDetails:\n      required:\n        - count\n        - limit\n      type: object\n      properties:\n        count:\n          type: integer\n          description: Number of custom document models in the current resource.\n          format: int32\n        limit:\n          type: integer\n          description: Maximum number of custom document models supported in the current resource.\n          format: int32\n      description: Details regarding custom document models.\n    DocumentAnalysisFeature:\n      enum:\n        - ocrHighResolution\n        - languages\n        - barcodes\n        - formulas\n        - keyValuePairs\n        - styleFont\n        - queryFields\n      type: string\n      description: Document analysis features to enable.\n      x-ms-enum:\n        name: DocumentAnalysisFeature\n        modelAsString: true\n        values:\n          - name: ocrHighResolution\n            value: ocrHighResolution\n            description: Perform OCR at a higher resolution to handle documents with fine print.\n          - name: languages\n            value: languages\n            description: Enable the detection of the text content language.\n          - name: barcodes\n            value: barcodes\n            description: Enable the detection of barcodes in the document.\n          - name: formulas\n            value: formulas\n            description: Enable the detection of mathematical expressions in the document.\n          - name: keyValuePairs\n            value: keyValuePairs\n            description: Enable the detection of general key value pairs (form fields) in the document.\n          - name: styleFont\n            value: styleFont\n            description: Enable the recognition of various font styles.\n          - name: queryFields\n            value: queryFields\n            description: Enable the extraction of additional fields via the queryFields query parameter.\n    DocumentBarcode:\n      required:\n        - kind\n        - value\n        - span\n        - confidence\n      type: object\n      properties:\n        kind:\n          $ref: '#/components/schemas/DocumentBarcodeKind'\n        value:\n          type: string\n          description: Barcode value.\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the barcode, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\n        span:\n          $ref: '#/components/schemas/DocumentSpan'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the barcode.\n          format: float\n      description: A barcode object.\n    DocumentBarcodeKind:\n      enum:\n        - QRCode\n        - PDF417\n        - UPCA\n        - UPCE\n        - Code39\n        - Code128\n        - EAN8\n        - EAN13\n        - DataBar\n        - Code93\n        - Codabar\n        - DataBarExpanded\n        - ITF\n        - MicroQRCode\n        - Aztec\n        - DataMatrix\n        - MaxiCode\n      type: string\n      description: Barcode kind.\n      x-ms-enum:\n        name: DocumentBarcodeKind\n        modelAsString: true\n        values:\n          - name: QRCode\n            value: QRCode\n            description: 'QR code, as defined in ISO/IEC 18004:2015.'\n          - name: PDF417\n            value: PDF417\n            description: 'PDF417, as defined in ISO 15438.'\n          - name: UPCA\n            value: UPCA\n            description: GS1 12-digit Universal Product Code.\n          - name: UPCE\n            value: UPCE\n            description: GS1 6-digit Universal Product Code.\n          - name: Code39\n            value: Code39\n            description: 'Code 39 barcode, as defined in ISO/IEC 16388:2007.'\n          - name: Code128\n            value: Code128\n            description: 'Code 128 barcode, as defined in ISO/IEC 15417:2007.'\n          - name: EAN8\n            value: EAN8\n            description: GS1 8-digit International Article Number (European Article Number).\n          - name: EAN13\n            value: EAN13\n            description: GS1 13-digit International Article Number (European Article Number).\n          - name: DataBar\n            value: DataBar\n            description: GS1 DataBar barcode.\n          - name: Code93\n            value: Code93\n            description: 'Code 93 barcode, as defined in ANSI/AIM BC5-1995.'\n          - name: Codabar\n            value: Codabar\n            description: 'Codabar barcode, as defined in ANSI/AIM BC3-1995.'\n          - name: DataBarExpanded\n            value: DataBarExpanded\n            description: GS1 DataBar Expanded barcode.\n          - name: ITF\n            value: ITF\n            description: 'Interleaved 2 of 5 barcode, as defined in ANSI/AIM BC2-1995.'\n          - name: MicroQRCode\n            value: MicroQRCode\n            description: 'Micro QR code, as defined in ISO/IEC 23941:2022.'\n          - name: Aztec\n            value: Aztec\n            description: 'Aztec code, as defined in ISO/IEC 24778:2008.'\n          - name: DataMatrix\n            value: DataMatrix\n            description: 'Data matrix code, as defined in ISO/IEC 16022:2006.'\n          - name: MaxiCode\n            value: MaxiCode\n            description: 'MaxiCode, as defined in ISO/IEC 16023:2000.'\n    DocumentBuildMode:\n      enum:\n        - template\n        - neural\n      type: string\n      description: Custom document model build mode.\n      x-ms-enum:\n        name: DocumentBuildMode\n        modelAsString: true\n        values:\n          - name: template\n            value: template\n            description: Target documents with similar visual templates.\n          - name: neural\n            value: neural\n            description: Support documents with diverse visual templates.\n    DocumentCaption:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        content:\n          type: string\n          description: Content of the caption.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the caption.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the caption in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: Child elements of the caption.\n      description: A caption object describing a table or figure.\n    DocumentClassifierBuildOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentClassifierDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentClassifierBuild\n    DocumentClassifierCopyToOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentClassifierDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentClassifierCopyTo\n    DocumentClassifierDetails:\n      required:\n        - classifierId\n        - createdDateTime\n        - apiVersion\n        - docTypes\n      type: object\n      properties:\n        classifierId:\n          maxLength: 64\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document classifier name.\n          x-ms-mutability:\n            - read\n            - create\n        description:\n          maxLength: 4096\n          type: string\n          description: Document classifier description.\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the document classifier was created.\n          format: date-time\n        expirationDateTime:\n          type: string\n          description: Date and time (UTC) when the document classifier will expire.\n          format: date-time\n        modifiedDateTime:\n          type: string\n          description: Date and time (UTC) when the document model was last modified.\n          format: date-time\n          readOnly: true\n        apiVersion:\n          type: string\n          description: API version used to create this document classifier.\n        baseClassifierId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Base classifierId on top of which the classifier was trained.\n        docTypes:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/ClassifierDocumentTypeDetails'\n          description: List of document types to classify against.\n        warnings:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\n          description: List of warnings encountered while building the classifier.\n          x-ms-identifiers: [ ]\n      description: Document classifier info.\n    DocumentContentFormat:\n      enum:\n        - text\n        - markdown\n      type: string\n      description: Format of the content in analyzed result.\n      x-ms-enum:\n        name: DocumentContentFormat\n        modelAsString: true\n        values:\n          - name: text\n            value: text\n            description: Plain text representation of the document content without any formatting.\n          - name: markdown\n            value: markdown\n            description: \"Markdown representation of the document content with section headings, tables,\\netc.\"\n    DocumentElement:\n      type: string\n      description: \"An JSON pointer referencing an element of the document, such as paragraph,\\ntable, section, etc.\"\n    DocumentField:\n      required:\n        - type\n      type: object\n      properties:\n        type:\n          $ref: '#/components/schemas/DocumentFieldType'\n        valueString:\n          type: string\n          description: String value.\n        valueDate:\n          type: string\n          description: Date value in YYYY-MM-DD format (ISO 8601).\n          format: date\n        valueTime:\n          type: string\n          description: Time value in hh:mm:ss format (ISO 8601).\n          format: time\n        valuePhoneNumber:\n          type: string\n          description: Phone number value in E.164 format (ex. +19876543210).\n        valueNumber:\n          type: number\n          description: Floating point value.\n          format: double\n        valueInteger:\n          type: integer\n          description: Integer value.\n          format: int64\n        valueSelectionMark:\n          $ref: '#/components/schemas/DocumentSelectionMarkState'\n        valueSignature:\n          $ref: '#/components/schemas/DocumentSignatureType'\n        valueCountryRegion:\n          type: string\n          description: 3-letter country code value (ISO 3166-1 alpha-3).\n        valueArray:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentField'\n          description: Array of field values.\n          x-ms-identifiers: [ ]\n        valueObject:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentField'\n          description: Dictionary of named field values.\n        valueCurrency:\n          $ref: '#/components/schemas/CurrencyValue'\n        valueAddress:\n          $ref: '#/components/schemas/AddressValue'\n        valueBoolean:\n          type: boolean\n          description: Boolean value.\n        valueSelectionGroup:\n          type: array\n          items:\n            type: string\n          description: Selection group value.\n        content:\n          type: string\n          description: Field content.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the field.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the field in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the field.\n          format: float\n      description: An object representing the content and location of a field value.\n    DocumentFieldSchema:\n      required:\n        - type\n      type: object\n      properties:\n        type:\n          $ref: '#/components/schemas/DocumentFieldType'\n        description:\n          maxLength: 4096\n          type: string\n          description: Field description.\n        example:\n          type: string\n          description: Example field content.\n        items:\n          $ref: '#/components/schemas/DocumentFieldSchema'\n        properties:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentFieldSchema'\n          description: Named sub-fields of the object field.\n      description: Description of the field semantic schema using a JSON Schema style syntax.\n    DocumentFieldType:\n      enum:\n        - string\n        - date\n        - time\n        - phoneNumber\n        - number\n        - integer\n        - selectionMark\n        - countryRegion\n        - signature\n        - array\n        - object\n        - currency\n        - address\n        - boolean\n        - selectionGroup\n      type: string\n      description: Semantic data type of the field value.\n      x-ms-enum:\n        name: DocumentFieldType\n        modelAsString: true\n        values:\n          - name: string\n            value: string\n            description: Plain text.\n          - name: date\n            value: date\n            description: 'Date, normalized to ISO 8601 (YYYY-MM-DD) format.'\n          - name: time\n            value: time\n            description: 'Time, normalized to ISO 8601 (hh:mm:ss) format.'\n          - name: phoneNumber\n            value: phoneNumber\n            description: 'Phone number, normalized to E.164 (+{CountryCode}{SubscriberNumber}) format.'\n          - name: number\n            value: number\n            description: 'Floating point number, normalized to double precision floating point.'\n          - name: integer\n            value: integer\n            description: 'Integer number, normalized to 64-bit signed integer.'\n          - name: selectionMark\n            value: selectionMark\n            description: Is field selected?\n          - name: countryRegion\n            value: countryRegion\n            description: 'Country/region, normalized to ISO 3166-1 alpha-3 format (ex. USA).'\n          - name: signature\n            value: signature\n            description: Is signature present?\n          - name: array\n            value: array\n            description: List of subfields of the same type.\n          - name: object\n            value: object\n            description: Named list of subfields of potentially different types.\n          - name: currency\n            value: currency\n            description: Currency amount with optional currency symbol and unit.\n          - name: address\n            value: address\n            description: Parsed address.\n          - name: boolean\n            value: boolean\n            description: 'Boolean value, normalized to true or false.'\n          - name: selectionGroup\n            value: selectionGroup\n            description: Array of selected string values.\n    DocumentFigure:\n      required:\n        - spans\n      type: object\n      properties:\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the figure.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the figure in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: 'Child elements of the figure, excluding any caption or footnotes.'\n        caption:\n          $ref: '#/components/schemas/DocumentCaption'\n        footnotes:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentFootnote'\n          description: List of footnotes associated with the figure.\n          x-ms-identifiers: [ ]\n        id:\n          type: string\n          description: Figure ID.\n      description: An object representing a figure in the document.\n    DocumentFontStyle:\n      enum:\n        - normal\n        - italic\n      type: string\n      description: Font style.\n      x-ms-enum:\n        name: DocumentFontStyle\n        modelAsString: true\n        values:\n          - name: normal\n            value: normal\n            description: Characters are represented normally.\n          - name: italic\n            value: italic\n            description: Characters are visually slanted to the right.\n    DocumentFontWeight:\n      enum:\n        - normal\n        - bold\n      type: string\n      description: Font weight.\n      x-ms-enum:\n        name: DocumentFontWeight\n        modelAsString: true\n        values:\n          - name: normal\n            value: normal\n            description: Characters are represented normally.\n          - name: bold\n            value: bold\n            description: Characters are represented with thicker strokes.\n    DocumentFootnote:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        content:\n          type: string\n          description: Content of the footnote.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the footnote.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the footnote in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: Child elements of the footnote.\n      description: A footnote object describing a table or figure.\n    DocumentFormula:\n      required:\n        - kind\n        - value\n        - span\n        - confidence\n      type: object\n      properties:\n        kind:\n          $ref: '#/components/schemas/DocumentFormulaKind'\n        value:\n          type: string\n          description: LaTex expression describing the formula.\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the formula, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\n        span:\n          $ref: '#/components/schemas/DocumentSpan'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the formula.\n          format: float\n      description: A formula object.\n    DocumentFormulaKind:\n      enum:\n        - inline\n        - display\n      type: string\n      description: Formula kind.\n      x-ms-enum:\n        name: DocumentFormulaKind\n        modelAsString: true\n        values:\n          - name: inline\n            value: inline\n            description: A formula embedded within the content of a paragraph.\n          - name: display\n            value: display\n            description: A formula in display mode that takes up an entire line.\n    DocumentIntelligenceError:\n      required:\n        - code\n        - message\n      type: object\n      properties:\n        code:\n          type: string\n          description: One of a server-defined set of error codes.\n        message:\n          type: string\n          description: A human-readable representation of the error.\n        target:\n          type: string\n          description: The target of the error.\n        details:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceError'\n          description: An array of details about specific errors that led to this reported error.\n          x-ms-identifiers: [ ]\n        innererror:\n          $ref: '#/components/schemas/DocumentIntelligenceInnerError'\n      description: The error object.\n    DocumentIntelligenceErrorResponse:\n      required:\n        - error\n      type: object\n      properties:\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n      description: Error response object.\n    DocumentIntelligenceInnerError:\n      type: object\n      properties:\n        code:\n          type: string\n          description: One of a server-defined set of error codes.\n        message:\n          type: string\n          description: A human-readable representation of the error.\n        innererror:\n          $ref: '#/components/schemas/DocumentIntelligenceInnerError'\n      description: An object containing more specific information about the error.\n    DocumentIntelligenceOperationDetails:\n      required:\n        - operationId\n        - status\n        - createdDateTime\n        - lastUpdatedDateTime\n        - kind\n        - resourceLocation\n      type: object\n      properties:\n        operationId:\n          type: string\n          description: Operation ID\n          x-ms-mutability:\n            - read\n            - create\n        status:\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\n        percentCompleted:\n          maximum: 100\n          minimum: 0\n          type: integer\n          description: Operation progress (0-100).\n          format: int32\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the operation was created.\n          format: date-time\n        lastUpdatedDateTime:\n          type: string\n          description: Date and time (UTC) when the status was last updated.\n          format: date-time\n        kind:\n          $ref: '#/components/schemas/OperationKind'\n        resourceLocation:\n          type: string\n          description: URL of the resource targeted by this operation.\n          format: uri\n        apiVersion:\n          type: string\n          description: API version used to create this operation.\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n        error:\n          $ref: '#/components/schemas/DocumentIntelligenceError'\n      description: Operation info.\n      discriminator:\n        propertyName: kind\n    DocumentIntelligenceOperationStatus:\n      enum:\n        - notStarted\n        - running\n        - failed\n        - succeeded\n        - canceled\n        - skipped\n\n      type: string\n      description: Operation status.\n      x-ms-enum:\n        name: DocumentIntelligenceOperationStatus\n        modelAsString: true\n        values:\n          - name: notStarted\n            value: notStarted\n            description: The operation has not started yet.\n          - name: running\n            value: running\n            description: The operation is in progress.\n          - name: failed\n            value: failed\n            description: The operation has failed.\n          - name: succeeded\n            value: succeeded\n            description: The operation has succeeded.\n          - name: canceled\n            value: canceled\n            description: The operation has been canceled.\n          - name: skipped\n            value: skipped\n            description: The operation has been skipped.\n    DocumentIntelligenceResourceDetails:\n      required:\n        - customDocumentModels\n      type: object\n      properties:\n        customDocumentModels:\n          $ref: '#/components/schemas/CustomDocumentModelsDetails'\n      description: General information regarding the current resource.\n    DocumentIntelligenceWarning:\n      required:\n        - code\n        - message\n      type: object\n      properties:\n        code:\n          type: string\n          description: One of a server-defined set of warning codes.\n        message:\n          type: string\n          description: A human-readable representation of the warning.\n        target:\n          type: string\n          description: The target of the error.\n      description: The error object.\n    DocumentKeyValueElement:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        content:\n          type: string\n          description: Concatenated content of the key-value element in reading order.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the key-value element.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the key-value element in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n      description: An object representing the field key or value in a key-value pair.\n    DocumentKeyValuePair:\n      required:\n        - key\n        - confidence\n      type: object\n      properties:\n        key:\n          $ref: '#/components/schemas/DocumentKeyValueElement'\n        value:\n          $ref: '#/components/schemas/DocumentKeyValueElement'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the key-value pair.\n          format: float\n      description: \"An object representing a form field with distinct field label (key) and field\\nvalue (may be empty).\"\n    DocumentLanguage:\n      required:\n        - locale\n        - spans\n        - confidence\n      type: object\n      properties:\n        locale:\n          type: string\n          description: \"Detected language.  Value may an ISO 639-1 language code (ex. \\\"en\\\", \\\"fr\\\")\\nor BCP 47 language tag (ex. \\\"zh-Hans\\\").\"\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: \"Location of the text elements in the concatenated content the language applies\\nto.\"\n          x-ms-identifiers: [ ]\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly identifying the language.\n          format: float\n      description: An object representing the detected language for a given text span.\n    DocumentLine:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        content:\n          type: string\n          description: Concatenated content of the contained elements in reading order.\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the line, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the line in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n      description: \"A content line object consisting of an adjacent sequence of content elements,\\nsuch as words and selection marks.\"\n    DocumentModelBuildOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentModelDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentModelBuild\n    DocumentModelComposeOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentModelDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentModelCompose\n    DocumentModelCopyToOperationDetails:\n      type: object\n      allOf:\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n      properties:\n        result:\n          $ref: '#/components/schemas/DocumentModelDetails'\n      description: Get Operation response object.\n      x-ms-discriminator-value: documentModelCopyTo\n    DocumentModelDetails:\n      required:\n        - modelId\n        - createdDateTime\n      type: object\n      properties:\n        modelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Unique document model name.\n          x-ms-mutability:\n            - read\n            - create\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        createdDateTime:\n          type: string\n          description: Date and time (UTC) when the document model was created.\n          format: date-time\n          readOnly: true\n        expirationDateTime:\n          type: string\n          description: Date and time (UTC) when the document model will expire.\n          format: date-time\n          readOnly: true\n        modifiedDateTime:\n          type: string\n          description: Date and time (UTC) when the document model was last modified.\n          format: date-time\n          readOnly: true\n        apiVersion:\n          type: string\n          description: API version used to create this document model.\n          readOnly: true\n        tags:\n          type: object\n          additionalProperties:\n            type: string\n          description: List of key-value tag attributes associated with the document model.\n        buildMode:\n          $ref: '#/components/schemas/DocumentBuildMode'\n        azureBlobSource:\n          $ref: '#/components/schemas/AzureBlobContentSource'\n        azureBlobFileListSource:\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\n        classifierId:\n          type: string\n          description: 'For composed models, the custom classifier to split and classify the input file.'\n        split:\n          enum:\n            - auto\n            - none\n            - perPage\n          type: string\n          description: 'For composed models, the file splitting behavior.'\n          default: none\n          x-ms-enum:\n            name: SplitMode\n            modelAsString: true\n            values:\n              - name: auto\n                value: auto\n                description: Automatically split file into documents.\n              - name: none\n                value: none\n                description: Treat the entire file as a single document.\n              - name: perPage\n                value: perPage\n                description: Treat each page in the file as a separate document.\n        docTypes:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentTypeDetails'\n          description: Supported document types.\n          readOnly: true\n        warnings:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\n          description: List of warnings encountered while building the model.\n          readOnly: true\n          x-ms-identifiers: [ ]\n        trainingHours:\n          type: number\n          description: Number of V100-equivalent GPU hours consumed for model training.\n          format: float\n          readOnly: true\n      description: Document model info.\n    DocumentPage:\n      required:\n        - pageNumber\n        - spans\n      type: object\n      properties:\n        pageNumber:\n          minimum: 1\n          type: integer\n          description: 1-based page number in the input document.\n          format: int32\n        angle:\n          maximum: 180\n          type: number\n          description: \"The general orientation of the content in clockwise direction, measured in\\ndegrees between (-180, 180].\"\n          format: float\n        width:\n          minimum: 0\n          type: number\n          description: 'The width of the image/PDF in pixels/inches, respectively.'\n          format: float\n        height:\n          minimum: 0\n          type: number\n          description: 'The height of the image/PDF in pixels/inches, respectively.'\n          format: float\n        unit:\n          $ref: '#/components/schemas/LengthUnit'\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the page in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        words:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentWord'\n          description: Extracted words from the page.\n          x-ms-identifiers: [ ]\n        selectionMarks:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSelectionMark'\n          description: Extracted selection marks from the page.\n          x-ms-identifiers: [ ]\n        lines:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentLine'\n          description: \"Extracted lines from the page, potentially containing both textual and visual\\nelements.\"\n          x-ms-identifiers: [ ]\n        barcodes:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentBarcode'\n          description: Extracted barcodes from the page.\n          x-ms-identifiers: [ ]\n        formulas:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentFormula'\n          description: Extracted formulas from the page.\n          x-ms-identifiers: [ ]\n      description: Content and layout elements extracted from a page from the input.\n    DocumentParagraph:\n      required:\n        - content\n        - spans\n      type: object\n      properties:\n        role:\n          $ref: '#/components/schemas/ParagraphRole'\n        content:\n          type: string\n          description: Concatenated content of the paragraph in reading order.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the paragraph.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the paragraph in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n      description: \"A paragraph object consisting with contiguous lines generally with common\\nalignment and spacing.\"\n    DocumentSection:\n      required:\n        - spans\n      type: object\n      properties:\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the section in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: Child elements of the section.\n      description: An object representing a section in the document.\n    DocumentSelectionMark:\n      required:\n        - state\n        - span\n        - confidence\n      type: object\n      properties:\n        state:\n          $ref: '#/components/schemas/DocumentSelectionMarkState'\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the selection mark, with coordinates specified relative\\nto the top-left of the page. The numbers represent the x, y values of the\\npolygon vertices, clockwise from the left (-180 degrees inclusive) relative\\nto the element orientation.\"\n        span:\n          $ref: '#/components/schemas/DocumentSpan'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the selection mark.\n          format: float\n      description: \"A selection mark object representing check boxes, radio buttons, and other\\nelements indicating a selection.\"\n    DocumentSelectionMarkState:\n      enum:\n        - selected\n        - unselected\n      type: string\n      description: State of the selection mark.\n      x-ms-enum:\n        name: DocumentSelectionMarkState\n        modelAsString: true\n        values:\n          - name: selected\n            value: selected\n            description: \"The selection mark is selected, often indicated by a check  or cross X inside\\nthe selection mark.\"\n          - name: unselected\n            value: unselected\n            description: The selection mark is not selected.\n    DocumentSignatureType:\n      enum:\n        - signed\n        - unsigned\n      type: string\n      description: Presence of signature.\n      x-ms-enum:\n        name: DocumentSignatureType\n        modelAsString: true\n        values:\n          - name: signed\n            value: signed\n            description: A signature is detected.\n          - name: unsigned\n            value: unsigned\n            description: No signatures are detected.\n    DocumentSpan:\n      required:\n        - offset\n        - length\n      type: object\n      properties:\n        offset:\n          minimum: 0\n          type: integer\n          description: Zero-based index of the content represented by the span.\n          format: int32\n        length:\n          minimum: 0\n          type: integer\n          description: Number of characters in the content represented by the span.\n          format: int32\n      description: \"Contiguous region of the concatenated content property, specified as an offset\\nand length.\"\n    DocumentStyle:\n      required:\n        - spans\n        - confidence\n      type: object\n      properties:\n        isHandwritten:\n          type: boolean\n          description: Is content handwritten?\n        similarFontFamily:\n          type: string\n          description: \"Visually most similar font from among the set of supported font families, with\\nfallback fonts following CSS convention (ex. 'Arial, sans-serif').\"\n        fontStyle:\n          $ref: '#/components/schemas/DocumentFontStyle'\n        fontWeight:\n          $ref: '#/components/schemas/DocumentFontWeight'\n        color:\n          pattern: '^#[0-9a-f]{6}$'\n          type: string\n          description: 'Foreground color in #rrggbb hexadecimal format.'\n        backgroundColor:\n          pattern: '^#[0-9a-f]{6}$'\n          type: string\n          description: 'Background color in #rrggbb hexadecimal format..'\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the text elements in the concatenated content the style applies to.\n          x-ms-identifiers: [ ]\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly identifying the style.\n          format: float\n      description: An object representing observed text styles.\n    DocumentTable:\n      required:\n        - rowCount\n        - columnCount\n        - cells\n        - spans\n      type: object\n      properties:\n        rowCount:\n          minimum: 1\n          type: integer\n          description: Number of rows in the table.\n          format: int32\n        columnCount:\n          minimum: 1\n          type: integer\n          description: Number of columns in the table.\n          format: int32\n        cells:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentTableCell'\n          description: Cells contained within the table.\n          x-ms-identifiers: [ ]\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the table.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the table in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        caption:\n          $ref: '#/components/schemas/DocumentCaption'\n        footnotes:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentFootnote'\n          description: List of footnotes associated with the table.\n          x-ms-identifiers: [ ]\n      description: A table object consisting table cells arranged in a rectangular layout.\n    DocumentTableCell:\n      required:\n        - rowIndex\n        - columnIndex\n        - content\n        - spans\n      type: object\n      properties:\n        kind:\n          enum:\n            - content\n            - rowHeader\n            - columnHeader\n            - stubHead\n            - description\n          type: string\n          description: Table cell kind.\n          default: content\n          x-ms-enum:\n            name: DocumentTableCellKind\n            modelAsString: true\n            values:\n              - name: content\n                value: content\n                description: Contains the main content/data.\n              - name: rowHeader\n                value: rowHeader\n                description: Describes the content of the row.\n              - name: columnHeader\n                value: columnHeader\n                description: Describes the content of the column.\n              - name: stubHead\n                value: stubHead\n                description: 'Describes the row headers, usually located at the top left corner of a table.'\n              - name: description\n                value: description\n                description: Describes the content in (parts of) the table.\n        rowIndex:\n          type: integer\n          description: Row index of the cell.\n          format: int32\n        columnIndex:\n          type: integer\n          description: Column index of the cell.\n          format: int32\n        rowSpan:\n          minimum: 1\n          type: integer\n          description: Number of rows spanned by this cell.\n          format: int32\n          default: 1\n        columnSpan:\n          minimum: 1\n          type: integer\n          description: Number of columns spanned by this cell.\n          format: int32\n          default: 1\n        content:\n          type: string\n          description: Concatenated content of the table cell in reading order.\n        boundingRegions:\n          type: array\n          items:\n            $ref: '#/components/schemas/BoundingRegion'\n          description: Bounding regions covering the table cell.\n          x-ms-identifiers: [ ]\n        spans:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentSpan'\n          description: Location of the table cell in the reading order concatenated content.\n          x-ms-identifiers: [ ]\n        elements:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentElement'\n          description: Child elements of the table cell.\n      description: An object representing the location and content of a table cell.\n    DocumentTypeDetails:\n      type: object\n      properties:\n        description:\n          maxLength: 4096\n          type: string\n          description: Document model description.\n        buildMode:\n          $ref: '#/components/schemas/DocumentBuildMode'\n        fieldSchema:\n          type: object\n          additionalProperties:\n            $ref: '#/components/schemas/DocumentFieldSchema'\n          description: Description of the document semantic schema using a JSON Schema style syntax.\n        fieldConfidence:\n          type: object\n          additionalProperties:\n            type: number\n            format: float\n          description: Estimated confidence for each field.\n        modelId:\n          maxLength: 64\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Document model to use for analyzing documents with specified type.\n        confidenceThreshold:\n          type: number\n          description: Only perform analysis if docType confidence is above threshold.\n          format: float\n        features:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentAnalysisFeature'\n          description: List of optional analysis features.\n        queryFields:\n          type: array\n          items:\n            type: string\n          description: 'List of additional fields to extract.  Ex. \"NumberOfGuests,StoreNumber\"'\n        maxDocumentsToAnalyze:\n          type: integer\n          description: Maximum number of documents of specified type to analyze.  Default=all.\n          format: int32\n      description: Document type info.\n    DocumentWord:\n      required:\n        - content\n        - span\n        - confidence\n      type: object\n      properties:\n        content:\n          type: string\n          description: Text content of the word.\n        polygon:\n          type: array\n          items:\n            type: number\n            format: float\n          description: \"Bounding polygon of the word, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\n        span:\n          $ref: '#/components/schemas/DocumentSpan'\n        confidence:\n          maximum: 1\n          minimum: 0\n          type: number\n          description: Confidence of correctly extracting the word.\n          format: float\n      description: \"A word object consisting of a contiguous sequence of characters.  For non-space\\ndelimited languages, such as Chinese, Japanese, and Korean, each character is\\nrepresented as its own word.\"\n    LengthUnit:\n      enum:\n        - pixel\n        - inch\n      type: string\n      description: 'The unit used by the width, height, and polygon properties. For images, the unit is \"pixel\". For PDF, the unit is \"inch\".'\n      x-ms-enum:\n        name: LengthUnit\n        modelAsString: true\n        values:\n          - name: pixel\n            value: pixel\n            description: Length unit for image files.\n          - name: inch\n            value: inch\n            description: Length unit for PDF files.\n    ModelCopyAuthorization:\n      required:\n        - targetResourceId\n        - targetResourceRegion\n        - targetModelId\n        - targetModelLocation\n        - accessToken\n        - expirationDateTime\n      type: object\n      properties:\n        targetResourceId:\n          type: string\n          description: ID of the target Azure resource where the document model should be copied to.\n        targetResourceRegion:\n          type: string\n          description: \"Location of the target Azure resource where the document model should be copied\\nto.\"\n        targetModelId:\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\n          type: string\n          description: Identifier of the target document model.\n        targetModelLocation:\n          type: string\n          description: URL of the copied document model in the target account.\n          format: uri\n        accessToken:\n          type: string\n          description: Token used to authorize the request.\n        expirationDateTime:\n          type: string\n          description: Date/time when the access token expires.\n          format: date-time\n      description: \"Authorization to copy a document model to the specified target resource and\\nmodelId.\"\n    OperationKind:\n      enum:\n        - documentModelBuild\n        - documentModelCompose\n        - documentModelCopyTo\n        - documentClassifierCopyTo\n        - documentClassifierBuild\n      type: string\n      description: Type of operation.\n      x-ms-enum:\n        name: OperationKind\n        modelAsString: true\n        values:\n          - name: documentModelBuild\n            value: documentModelBuild\n            description: Build a new custom document model.\n          - name: documentModelCompose\n            value: documentModelCompose\n            description: Compose a new custom document model from existing models.\n          - name: documentModelCopyTo\n            value: documentModelCopyTo\n            description: \"Copy an existing document model to potentially a different resource, region, or\\nsubscription.\"\n          - name: documentClassifierCopyTo\n            value: documentClassifierCopyTo\n            description: \"Copy an existing document classifier to potentially a different resource, region, or\\nsubscription.\"\n          - name: documentClassifierBuild\n            value: documentClassifierBuild\n            description: Build a new custom classifier model.\n    PagedAnalyzeBatchOperation:\n      required:\n        - value\n      type: object\n      properties:\n        value:\n          type: array\n          items:\n            $ref: '#/components/schemas/AnalyzeBatchOperation'\n          description: The AnalyzeBatchOperation items on this page\n          x-ms-identifiers: [ ]\n        nextLink:\n          type: string\n          description: The link to the next page of items\n          format: uri\n      description: Paged collection of AnalyzeBatchOperation items\n    PagedDocumentClassifierDetails:\n      required:\n        - value\n      type: object\n      properties:\n        value:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentClassifierDetails'\n          description: The DocumentClassifierDetails items on this page\n          x-ms-identifiers: [ ]\n        nextLink:\n          type: string\n          description: The link to the next page of items\n          format: uri\n      description: Paged collection of DocumentClassifierDetails items\n    PagedDocumentIntelligenceOperationDetails:\n      required:\n        - value\n      type: object\n      properties:\n        value:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\n          description: The DocumentIntelligenceOperationDetails items on this page\n          x-ms-identifiers: [ ]\n        nextLink:\n          type: string\n          description: The link to the next page of items\n          format: uri\n      description: Paged collection of DocumentIntelligenceOperationDetails items\n    PagedDocumentModelDetails:\n      required:\n        - value\n      type: object\n      properties:\n        value:\n          type: array\n          items:\n            $ref: '#/components/schemas/DocumentModelDetails'\n          description: The DocumentModelDetails items on this page\n          x-ms-identifiers: [ ]\n        nextLink:\n          type: string\n          description: The link to the next page of items\n          format: uri\n      description: Paged collection of DocumentModelDetails items\n    ParagraphRole:\n      enum:\n        - pageHeader\n        - pageFooter\n        - pageNumber\n        - title\n        - sectionHeading\n        - footnote\n        - formulaBlock\n      type: string\n      description: Semantic role of the paragraph.\n      x-ms-enum:\n        name: ParagraphRole\n        modelAsString: true\n        values:\n          - name: pageHeader\n            value: pageHeader\n            description: Text near the top edge of the page.\n          - name: pageFooter\n            value: pageFooter\n            description: Text near the bottom edge of the page.\n          - name: pageNumber\n            value: pageNumber\n            description: Page number.\n          - name: title\n            value: title\n            description: Top-level title describing the entire document.\n          - name: sectionHeading\n            value: sectionHeading\n            description: Sub heading describing a section of the document.\n          - name: footnote\n            value: footnote\n            description: A note usually placed after the main content on a page.\n          - name: formulaBlock\n            value: formulaBlock\n            description: 'A block of formulas, often with shared alignment.'\n    StringIndexType:\n      enum:\n        - textElements\n        - unicodeCodePoint\n        - utf16CodeUnit\n      type: string\n      description: Method used to compute string offset and length.\n      x-ms-enum:\n        name: StringIndexType\n        modelAsString: true\n        values:\n          - name: textElements\n            value: textElements\n            description: \"User-perceived display character, or grapheme cluster, as defined by Unicode\\n8.0.0.\"\n          - name: unicodeCodePoint\n            value: unicodeCodePoint\n            description: Character unit represented by a single unicode code point.  Used by Python 3.\n          - name: utf16CodeUnit\n            value: utf16CodeUnit\n            description: \"Character unit represented by a 16-bit Unicode code unit.  Used by JavaScript,\\nJava, and .NET.\"\n    Input:\n      type: object\n    DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ImagePngResp:\n      type: file\n    DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ApplicationJ:\n      type: file\n    DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationPdfResponse:\n      type: file\n    DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationJsonResponse:\n      type: file\n  securitySchemes:\n    apiKeyHeader:\n      type: apiKey\n      name: Ocp-Apim-Subscription-Key\n      in: header\n    apiKeyQuery:\n      type: apiKey\n      name: subscription-key\n      in: query\nsecurity:\n  - apiKeyHeader: [ ]\n  - apiKeyQuery: [ ]",
            "$fxv#8": "<policies>\n    <inbound>\n        <base />\n        <!-- AAD Authorization -->\n        <!-- Enabled if entra-validate named value is set to true -->\n        <include-fragment fragment-id=\"aad-auth\" />\n\n        <set-header name=\"api-key\" exists-action=\"delete\" />\n        \n        <!-- Setting cache keys -->\n        <set-variable name=\"deployment-id\" value=\"@{\n            var modelId = context.Request.MatchedParameters.GetValueOrDefault(\"modelId\", \"\");\n            var classifierId = context.Request.MatchedParameters.GetValueOrDefault(\"classifierId\", \"\");\n            \n            if (!string.IsNullOrEmpty(modelId))\n            {\n                return modelId;\n            }\n            else if (!string.IsNullOrEmpty(classifierId))\n            {\n                return classifierId;\n            }\n            else\n            {\n                return \"Document-Intelligence\";\n            }\n        }\" />\n        \n        <set-variable name=\"routesCacheKey\" value=\"@((string)context.Variables[\"deployment-id\"] + \"Routes\" + context.Deployment.Region + context.Api.Revision)\" />\n        <set-variable name=\"oaClustersCacheKey\" value=\"@(\"aiDocIntelInstance\" + context.Deployment.Region + context.Api.Revision)\" />\n        <cache-lookup-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-DOCINTELL\"))\" variable-name=\"oaClusters\" />\n        <!-- If we can't find the configuration cached, it will be loaded -->\n        <choose>\n            <when condition=\"@(context.Variables.ContainsKey(\"oaClusters\") == false)\">\n                <set-variable name=\"oaClusters\" value=\"@{\n                        // route is an Azure Document Intelligence endpoint\n                        JArray routes = new JArray();\n\n                        // cluster is a group of routes that are capable of serving a specific model name\n                        JArray clusters = new JArray();\n\n                        // Update the below if condition when using multiple APIM gateway regions/SHGW to get different configurations for each region\n                        if(context.Deployment.Region == \"ALL\" || true)\n                        {\n                            // Adding all Azure Document Intelligence endpoints routes (which are set as APIM Backend)\n                            routes.Add(new JObject()\n                            {\n                                { \"name\", \"Doc-Intelligence-EUS\" },\n                                { \"location\", \"East US\" },\n                                { \"backend-id\", \"REPLACE-BACKEND-ID\" },\n                                { \"priority\", 1},\n                                { \"isThrottling\", false }, \n                                { \"retryAfter\", DateTime.MinValue } \n                            });\n\n                            // For each model, create a cluster with the routes that can serve it\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-read\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-layout\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-healthInsuranceCard.us\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-invoice\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-receipt\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n\n                            clusters.Add(new JObject()\n                            {\n                                { \"deploymentName\", \"prebuilt-idDocument\" },\n                                { \"routes\", new JArray(routes[0]) }\n                            });\n                        }\n                        else\n                        {\n                            //No clusters found for selected region, either return error (default behavior) or set default cluster in the else section\n                        }\n                        \n                        return clusters;   \n                    }\" />\n                <!-- Add cluster configurations to cache -->\n                <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-DOCINTELL\"))\" value=\"@((JArray)context.Variables[\"oaClusters\"])\" duration=\"86400\" />\n            </when>\n        </choose>\n        <include-fragment fragment-id=\"validate-routes\" />\n        <authentication-managed-identity resource=\"https://cognitiveservices.azure.com\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\n        <set-header name=\"Authorization\" exists-action=\"override\">\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\n        </set-header>\n    </inbound>\n    <backend>\n        <include-fragment fragment-id=\"backend-routing\" />\n    </backend>\n    <outbound>\n        <base />\n        <set-variable name=\"idPrefix\" value=\"doc-Intel\" />\n        <set-variable name=\"targetService\" value=\"AI-Document-Intelligence\" />\n        <set-variable name=\"model\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-Document-Intelligence-Model\"))\" />\n        <set-variable name=\"deploymentName\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-DOCUMENT-INTELLIGENCE\"))\" />\n\n        <!-- Store original response body -->\n        <set-variable name=\"responseBody\" value=\"@(context.Response.Body.As<string>())\" />\n\n        <!-- Attempt to parse JSON and set variables -->\n        <set-variable name=\"isValidJson\" value=\"@{\n            try \n            {\n                var responseJson = JObject.Parse((string)context.Variables[\"responseBody\"]);\n                return true;\n            }\n            catch\n            {\n                return false;\n            }\n        }\" />\n\n        <choose>\n            <when condition=\"@((bool)context.Variables[\"isValidJson\"])\">\n                <set-variable name=\"numberOfPages\" value=\"@{\n                    try \n                    {\n                        var parsedBody = (JObject)context.Variables[\"parsedBody\"];\n                        var pages = parsedBody.SelectToken(\"analyzeResult.pages\");\n                        return pages != null ? pages.Count() : 1;\n                    }\n                    catch\n                    {\n                        return 1;\n                    }\n                }\" />\n\n                <set-variable name=\"modelId\" value=\"@{\n                    try \n                    {\n                        var parsedBody = (JObject)context.Variables[\"parsedBody\"];\n                        var modelId = parsedBody.SelectToken(\"analyzeResult.modelId\");\n                        return modelId != null ? modelId.ToString() : \"Document-Intelligence\";\n                    }\n                    catch\n                    {\n                        return \"Document-Intelligence\";\n                    }\n                }\" />\n            </when>\n        </choose>\n\n        <!-- Add dynamic header transformation -->\n        <set-header name=\"operation-location\" exists-action=\"override\">\n            <value>@{\n                var originalLocation = context.Response.Headers.GetValueOrDefault(\"operation-location\",\"\");\n                if (!string.IsNullOrEmpty(originalLocation)) {\n                    var uri = new Uri(originalLocation);\n                    return originalLocation.Replace(\n                        uri.Host,\n                        context.Request.OriginalUrl.Host\n                    );\n                }\n                return originalLocation;\n            }</value>\n        </set-header>\n\n        <include-fragment fragment-id=\"ai-usage\" />\n\n        <!-- Return response body -->\n        <set-body>@((string)context.Variables[\"responseBody\"])</set-body>\n    </outbound>\n    <on-error>\n        <base />\n        <set-variable name=\"service-name\" value=\"Azure Document Intelligence\" />\n        <set-variable name=\"target-deployment\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-Document-Intelligence-Model\"))\" />\n        \n        <!-- <include-fragment fragment-id=\"throttling-events\" /> -->\n    </on-error>\n</policies>",
            "$fxv#9": "<fragment>\n    <!-- AAD Authorization -->\n    <!-- Enable AAD is named value set to true -->\n    <set-variable name=\"entra-validate\" value=\"{{entra-auth}}\" />\n    <choose>\n        <when condition=\"@(context.Variables.GetValueOrDefault(\"entra-auth\") == \"true\")\">\n            <validate-jwt header-name=\"Authorization\" failed-validation-httpcode=\"401\"\n                failed-validation-error-message=\"Unauthorized\" require-expiration-time=\"true\"\n                require-scheme=\"Bearer\" require-signed-tokens=\"true\">\n                <openid-config\n                    url=\"https://login.microsoftonline.com/{{tenant-id}}/v2.0/.well-known/openid-configuration\" />\n                <audiences>\n                    <audience>{{audience}}</audience>\n                </audiences>\n                <issuers>\n                    <issuer>https://sts.windows.net/{{tenant-id}}/</issuer>\n                </issuers>\n                <required-claims>\n                    <claim name=\"appid\">\n                        <value>{{client-id}}</value>\n                    </claim>\n                </required-claims>\n            </validate-jwt>\n        </when>\n    </choose>\n</fragment>",
            "isV2SKU": "[or(equals(parameters('sku'), 'StandardV2'), equals(parameters('sku'), 'PremiumV2'))]",
            "eventHubsDataSenderRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', '2b629674-e913-4c01-ae53-ef4638d8f975')]",
            "apimPublicNetworkAccess": "[if(parameters('apimV2PublicNetworkAccess'), 'Enabled', 'Disabled')]",
            "openAiApiBackendId": "openai-backend",
            "openAiApiEntraNamedValue": "entra-auth",
            "openAiApiClientNamedValue": "client-id",
            "openAiApiTenantNamedValue": "tenant-id",
            "openAiApiAudienceNamedValue": "audience",
            "apiManagementMinApiVersion": "2021-08-01",
            "apiManagementMinApiVersionV2": "2024-05-01",
            "apimZones": "[if(and(equals(parameters('sku'), 'Premium'), greater(parameters('skuCount'), 1)), if(equals(parameters('skuCount'), 2), createArray('1', '2'), createArray('1', '2', '3')), createArray())]",
            "ehEpNoScheme": "[replace(parameters('eventHubEndpoint'), 'https://', '')]",
            "ehEpNoPort": "[replace(variables('ehEpNoScheme'), ':443/', '')]",
            "eventHubHost": "[replace(variables('ehEpNoPort'), '/', '')]"
          },
          "resources": {
            "applicationInsights": {
              "existing": true,
              "type": "Microsoft.Insights/components",
              "apiVersion": "2020-02-02",
              "name": "[parameters('applicationInsightsName')]"
            },
            "apimService": {
              "type": "Microsoft.ApiManagement/service",
              "apiVersion": "2024-05-01",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "sku": {
                "name": "[parameters('sku')]",
                "capacity": "[if(equals(parameters('sku'), 'Consumption'), 0, if(equals(parameters('sku'), 'Developer'), 1, parameters('skuCount')))]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "publisherEmail": "[parameters('publisherEmail')]",
                "publisherName": "[parameters('publisherName')]",
                "virtualNetworkType": "[if(variables('isV2SKU'), 'External', parameters('apimNetworkType'))]",
                "publicNetworkAccess": "[if(variables('isV2SKU'), variables('apimPublicNetworkAccess'), 'Enabled')]",
                "virtualNetworkConfiguration": "[if(or(not(equals(parameters('apimNetworkType'), 'None')), variables('isV2SKU')), createObject('subnetResourceId', parameters('apimSubnetId')), null())]",
                "apiVersionConstraint": {
                  "minApiVersion": "[if(variables('isV2SKU'), variables('apiManagementMinApiVersionV2'), variables('apiManagementMinApiVersion'))]"
                },
                "customProperties": "[if(equals(parameters('sku'), 'Consumption'), createObject(), createObject('Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30', 'false'))]"
              },
              "zones": "[variables('apimZones')]"
            },
            "openAiBackends": {
              "copy": {
                "name": "openAiBackends",
                "count": "[length(parameters('openAiUris'))]"
              },
              "type": "Microsoft.ApiManagement/service/backends",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), format('{0}-{1}', variables('openAiApiBackendId'), copyIndex()))]",
              "properties": {
                "description": "[variables('openAiApiBackendId')]",
                "url": "[parameters('openAiUris')[copyIndex()]]",
                "protocol": "http",
                "tls": {
                  "validateCertificateChain": true,
                  "validateCertificateName": true
                }
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "contentSafetyBackend": {
              "type": "Microsoft.ApiManagement/service/backends",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'content-safety-backend')]",
              "properties": {
                "description": "Content Safety Service Backend",
                "url": "[parameters('contentSafetyServiceUrl')]",
                "protocol": "http",
                "tls": {
                  "validateCertificateChain": true,
                  "validateCertificateName": true
                }
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "apiopenAiApiEntraNamedValue": {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), variables('openAiApiEntraNamedValue'))]",
              "properties": {
                "displayName": "[variables('openAiApiEntraNamedValue')]",
                "secret": false,
                "value": "[parameters('entraAuth')]"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "apiopenAiApiClientNamedValue": {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), variables('openAiApiClientNamedValue'))]",
              "properties": {
                "displayName": "[variables('openAiApiClientNamedValue')]",
                "secret": true,
                "value": "[parameters('clientAppId')]"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "apiopenAiApiTenantNamedValue": {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), variables('openAiApiTenantNamedValue'))]",
              "properties": {
                "displayName": "[variables('openAiApiTenantNamedValue')]",
                "secret": true,
                "value": "[parameters('tenantId')]"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "apimOpenaiApiAudienceNamedValue": {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), variables('openAiApiAudienceNamedValue'))]",
              "properties": {
                "displayName": "[variables('openAiApiAudienceNamedValue')]",
                "secret": true,
                "value": "[parameters('audience')]"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "piiServiceUrlNamedValue": {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'piiServiceUrl')]",
              "properties": {
                "displayName": "piiServiceUrl",
                "secret": false,
                "value": "[parameters('aiLanguageServiceUrl')]"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "piiServiceKeyNamedValue": {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'piiServiceKey')]",
              "properties": {
                "displayName": "piiServiceKey",
                "secret": true,
                "value": "replace-with-language-service-key-if-needed"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "contentSafetyServiceUrlNamedValue": {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'contentSafetyServiceUrl')]",
              "properties": {
                "displayName": "contentSafetyServiceUrl",
                "secret": false,
                "value": "[parameters('contentSafetyServiceUrl')]"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "aadAuthPolicyFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'aad-auth')]",
              "properties": {
                "value": "[variables('$fxv#9')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimOpenaiApiAudienceNamedValue",
                "apimService",
                "apiopenAiApiClientNamedValue",
                "apiopenAiApiEntraNamedValue",
                "apiopenAiApiTenantNamedValue"
              ]
            },
            "validateRoutesPolicyFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'validate-routes')]",
              "properties": {
                "value": "[variables('$fxv#10')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "backendRoutingPolicyFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'backend-routing')]",
              "properties": {
                "value": "[variables('$fxv#11')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "openAIUsagePolicyFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'openai-usage')]",
              "properties": {
                "value": "[variables('$fxv#12')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService",
                "ehUsageLogger"
              ]
            },
            "openAIUsageStreamingPolicyFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'openai-usage-streaming')]",
              "properties": {
                "value": "[variables('$fxv#13')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "aiUsagePolicyFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'ai-usage')]",
              "properties": {
                "value": "[variables('$fxv#14')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService",
                "ehUsageLogger"
              ]
            },
            "throttlingEventsPolicyFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'throttling-events')]",
              "properties": {
                "value": "[variables('$fxv#15')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "dynamicThrottlingAssignmentFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'dynamic-throttling-assignment')]",
              "properties": {
                "value": "[variables('$fxv#16')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "piiAnonymizationPolicyFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'pii-anonymization')]",
              "properties": {
                "value": "[variables('$fxv#17')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService",
                "piiServiceKeyNamedValue",
                "piiServiceUrlNamedValue"
              ]
            },
            "piiDenonymizationPolicyFragment": {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'pii-deanonymization')]",
              "properties": {
                "value": "[variables('$fxv#18')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "piiStateSavingPolicyFragment": {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'pii-state-saving')]",
              "properties": {
                "value": "[variables('$fxv#19')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "apimService",
                "ehPIIUsageLogger"
              ]
            },
            "apimLogger": {
              "type": "Microsoft.ApiManagement/service/loggers",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'appinsights-logger')]",
              "properties": {
                "credentials": {
                  "instrumentationKey": "[reference('applicationInsights').InstrumentationKey]"
                },
                "description": "Application Insights logger for API observability",
                "isBuffered": false,
                "loggerType": "applicationInsights",
                "resourceId": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
              },
              "dependsOn": [
                "apimService",
                "applicationInsights"
              ]
            },
            "apimAppInsights": {
              "type": "Microsoft.ApiManagement/service/diagnostics",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'applicationinsights')]",
              "properties": {
                "alwaysLog": "allErrors",
                "httpCorrelationProtocol": "Legacy",
                "verbosity": "information",
                "logClientIp": true,
                "loggerId": "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('name'), 'appinsights-logger')]",
                "metrics": true,
                "sampling": {
                  "samplingType": "fixed",
                  "percentage": 100
                },
                "frontend": {
                  "request": {
                    "body": {
                      "bytes": 0
                    }
                  },
                  "response": {
                    "body": {
                      "bytes": 0
                    }
                  }
                },
                "backend": {
                  "request": {
                    "body": {
                      "bytes": 0
                    }
                  },
                  "response": {
                    "body": {
                      "bytes": 0
                    }
                  }
                }
              },
              "dependsOn": [
                "apimLogger",
                "apimService"
              ]
            },
            "apimEventHubsSender": {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceGroup().id, variables('eventHubsDataSenderRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('eventHubsDataSenderRoleDefinitionId')]",
                "principalId": "[reference('apimService', '2024-05-01', 'full').identity.principalId]",
                "principalType": "ServicePrincipal"
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "ehUsageLogger": {
              "type": "Microsoft.ApiManagement/service/loggers",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'usage-eventhub-logger')]",
              "properties": {
                "loggerType": "azureEventHub",
                "description": "Event Hub logger for OpenAI usage metrics",
                "credentials": {
                  "name": "[parameters('eventHubName')]",
                  "endpointAddress": "[variables('eventHubHost')]",
                  "identityClientId": "systemAssigned"
                }
              },
              "dependsOn": [
                "apimEventHubsSender",
                "apimService"
              ]
            },
            "ehPIIUsageLogger": {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/loggers",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'pii-usage-eventhub-logger')]",
              "properties": {
                "loggerType": "azureEventHub",
                "description": "Event Hub logger for PII usage metrics and logs",
                "credentials": {
                  "name": "[parameters('eventHubPIIName')]",
                  "connectionString": "[parameters('eventHubEndpoint')]"
                }
              },
              "dependsOn": [
                "apimService"
              ]
            },
            "apimOpenaiApi": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "azure-openai-service-api",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "azure-openai-service-api"
                  },
                  "path": {
                    "value": "openai"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "Azure OpenAI API"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "api-key"
                  },
                  "openApiSpecification": {
                    "value": "[string(variables('$fxv#0'))]"
                  },
                  "apiDescription": {
                    "value": "Azure OpenAI API"
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#1')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "836120676213751956"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "aadAuthPolicyFragment",
                "apimService",
                "backendRoutingPolicyFragment",
                "dynamicThrottlingAssignmentFragment",
                "openAiBackends",
                "openAIUsagePolicyFragment",
                "openAIUsageStreamingPolicyFragment",
                "throttlingEventsPolicyFragment",
                "validateRoutesPolicyFragment"
              ]
            },
            "apimAiModelInferenceApi": {
              "condition": "[parameters('enableAIModelInference')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "ai-model-inference-api",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "ai-model-inference-api"
                  },
                  "path": {
                    "value": "models"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "AI Model Inference API"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "api-key"
                  },
                  "openApiSpecification": {
                    "value": "[variables('$fxv#2')]"
                  },
                  "apiDescription": {
                    "value": "Access to AI inference models published through Azure AI Foundry"
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#3')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "836120676213751956"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "aadAuthPolicyFragment",
                "aiUsagePolicyFragment",
                "apimService",
                "backendRoutingPolicyFragment",
                "throttlingEventsPolicyFragment",
                "validateRoutesPolicyFragment"
              ]
            },
            "apimOpenAIRealTimetApi": {
              "condition": "[parameters('enableOpenAIRealtime')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "openai-realtime-ws-api",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "openai-realtime-ws-api"
                  },
                  "path": {
                    "value": "openai/realtime"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "Azure OpenAI Realtime API"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "api-key"
                  },
                  "openApiSpecification": {
                    "value": "NA"
                  },
                  "apiDescription": {
                    "value": "Access Azure OpenAI Realtime API for real-time voice and text conversion."
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#4')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  },
                  "serviceUrl": {
                    "value": "wss://to-be-replaced-by-policy"
                  },
                  "apiType": {
                    "value": "websocket"
                  },
                  "apiProtocols": {
                    "value": [
                      "wss"
                    ]
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "836120676213751956"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "aadAuthPolicyFragment",
                "apimService",
                "backendRoutingPolicyFragment",
                "openAiBackends",
                "openAIUsagePolicyFragment",
                "openAIUsageStreamingPolicyFragment",
                "validateRoutesPolicyFragment"
              ]
            },
            "apimDocumentIntelligenceLegacy": {
              "condition": "[parameters('enableDocumentIntelligence')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "document-intelligence-api-legacy",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "document-intelligence-api-legacy"
                  },
                  "path": {
                    "value": "formrecognizer"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "Document Intelligence API (Legacy)"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "Ocp-Apim-Subscription-Key"
                  },
                  "openApiSpecification": {
                    "value": "[variables('$fxv#5')]"
                  },
                  "apiDescription": {
                    "value": "Uses (/formrecognizer) url path. Extracts content, layout, and structured data from documents."
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#6')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "836120676213751956"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "aadAuthPolicyFragment",
                "aiUsagePolicyFragment",
                "apimService",
                "backendRoutingPolicyFragment",
                "throttlingEventsPolicyFragment",
                "validateRoutesPolicyFragment"
              ]
            },
            "apimDocumentIntelligence": {
              "condition": "[parameters('enableDocumentIntelligence')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "document-intelligence-api",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "document-intelligence-api"
                  },
                  "path": {
                    "value": "documentintelligence"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "Document Intelligence API"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "Ocp-Apim-Subscription-Key"
                  },
                  "openApiSpecification": {
                    "value": "[variables('$fxv#7')]"
                  },
                  "apiDescription": {
                    "value": "Uses (/documentintelligence) url path. Extracts content, layout, and structured data from documents."
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#8')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "836120676213751956"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "aadAuthPolicyFragment",
                "aiUsagePolicyFragment",
                "apimService",
                "backendRoutingPolicyFragment",
                "throttlingEventsPolicyFragment",
                "validateRoutesPolicyFragment"
              ]
            }
          },
          "outputs": {
            "apimName": {
              "type": "string",
              "metadata": {
                "description": "The name of the deployed API Management service."
              },
              "value": "[parameters('name')]"
            },
            "apimOpenaiApiPath": {
              "type": "string",
              "metadata": {
                "description": "The path for the OpenAI API in the deployed API Management service."
              },
              "value": "[reference('apimOpenaiApi').outputs.path.value]"
            },
            "apimGatewayUrl": {
              "type": "string",
              "metadata": {
                "description": "Gateway URL for the deployed API Management resource."
              },
              "value": "[reference('apimService').gatewayUrl]"
            },
            "apimPrincipalId": {
              "type": "string",
              "metadata": {
                "description": "System-assigned managed identity principalId for APIM (use this for RBAC)."
              },
              "value": "[reference('apimService', '2024-05-01', 'full').identity.principalId]"
            },
            "apimId": {
              "type": "string",
              "metadata": {
                "description": "APIM resource id."
              },
              "value": "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
            }
          }
        }
      },
      "dependsOn": [
        "contentSafety",
        "eventHub",
        "existingOpenAi",
        "languageService",
        "monitoring",
        "redis",
        "redisKeys",
        "vnetExisting"
      ]
    },
    "apimSemCache": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "apim-semcache",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "apimName": {
            "value": "[reference('apim').outputs.apimName.value]"
          },
          "redisConnectionString": {
            "value": "[format('{0}:10000,password={1},ssl=True,abortConnect=False', reference('redis').outputs.redisHostName.value, listOutputsWithSecureValues('redisKeys', '2025-04-01').primaryKey)]"
          },
          "openAiEndpoint": {
            "value": "[reference('existingOpenAi').endpoint]"
          },
          "embeddingsDeploymentName": {
            "value": "[parameters('embeddingsDeploymentName')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "183777308160035061"
            }
          },
          "parameters": {
            "apimName": {
              "type": "string"
            },
            "redisConnectionString": {
              "type": "securestring"
            },
            "openAiEndpoint": {
              "type": "string"
            },
            "embeddingsDeploymentName": {
              "type": "string"
            },
            "embeddingsBackendId": {
              "type": "string",
              "defaultValue": "embeddings-backend"
            }
          },
          "variables": {
            "aoaiBase": "[if(endsWith(parameters('openAiEndpoint'), '/'), substring(parameters('openAiEndpoint'), 0, sub(length(parameters('openAiEndpoint')), 1)), parameters('openAiEndpoint'))]",
            "embeddingsBackendUrl": "[format('{0}/openai/deployments/{1}/embeddings', variables('aoaiBase'), parameters('embeddingsDeploymentName'))]"
          },
          "resources": [
            {
              "type": "Microsoft.ApiManagement/service/caches",
              "apiVersion": "2024-05-01",
              "name": "[format('{0}/{1}', parameters('apimName'), 'default')]",
              "properties": {
                "connectionString": "[parameters('redisConnectionString')]",
                "useFromLocation": "default",
                "description": "Redis external cache for semantic caching"
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2021-04-01",
              "name": "[format('{0}-embeddings-backend-mi', parameters('apimName'))]",
              "properties": {
                "mode": "Incremental",
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "resources": [
                    {
                      "type": "Microsoft.ApiManagement/service/backends",
                      "apiVersion": "2024-05-01",
                      "name": "[format('{0}/{1}', parameters('apimName'), parameters('embeddingsBackendId'))]",
                      "properties": {
                        "description": "Embeddings backend for semantic cache",
                        "url": "[variables('embeddingsBackendUrl')]",
                        "protocol": "http",
                        "credentials": {
                          "header": {},
                          "query": {},
                          "managedIdentity": {
                            "resource": "https://cognitiveservices.azure.com/"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('apimName'), 'semantic-cache-lookup')]",
              "properties": {
                "format": "rawxml",
                "value": "<fragment>\r\n  <choose>\r\n    <when condition=\"@(!context.Request.Headers.GetValueOrDefault(\"Accept\",\"\").Contains(\"text/event-stream\")\r\n      && ((context.Request.Url.Path ?? \"\").Contains(\"/chat/completions\") || (context.Request.Url.Path ?? \"\").Contains(\"/responses\")))\">\r\n      <azure-openai-semantic-cache-lookup\r\n          score-threshold=\"0.05\"\r\n          embeddings-backend-id =\"${embeddingsBackendId}\"\r\n          embeddings-backend-auth =\"system-assigned\"\r\n          ignore-system-messages=\"true\"\r\n          max-message-count=\"10\">\r\n        <!-- Partition cache -->\r\n        <vary-by>@(context.Subscription?.Id ?? \"no-sub\")</vary-by>\r\n        <vary-by>@(context.Request.Url.Path)</vary-by>\r\n      </azure-openai-semantic-cache-lookup>\r\n    </when>\r\n  </choose>\r\n</fragment>\r\n"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', format('{0}-embeddings-backend-mi', parameters('apimName')))]",
                "[resourceId('Microsoft.ApiManagement/service/caches', parameters('apimName'), 'default')]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('apimName'), 'semantic-cache-store')]",
              "properties": {
                "format": "rawxml",
                "value": "<fragment>\r\n  <choose>\r\n    <when condition=\"@(!context.Request.Headers.GetValueOrDefault(\"Accept\",\"\").Contains(\"text/event-stream\")\r\n      && ((context.Request.Url.Path ?? \"\").Contains(\"/chat/completions\") || (context.Request.Url.Path ?? \"\").Contains(\"/responses\")))\">\r\n      <azure-openai-semantic-cache-store duration=\"60\" />\r\n    </when>\r\n  </choose>\r\n</fragment>\r\n"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/caches', parameters('apimName'), 'default')]"
              ]
            }
          ]
        }
      },
      "dependsOn": [
        "apim",
        "existingOpenAi",
        "redis",
        "redisKeys"
      ]
    },
    "cosmosDb": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "cosmos-db",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "accountName": "[if(not(empty(parameters('cosmosDbAccountName'))), createObject('value', parameters('cosmosDbAccountName')), createObject('value', format('{0}{1}', variables('abbrs').documentDBDatabaseAccounts, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "vNetName": {
            "value": "[reference('vnetExisting').outputs.vnetName.value]"
          },
          "cosmosDnsZoneName": {
            "value": "[variables('cosmosDbPrivateDnsZoneName')]"
          },
          "cosmosPrivateEndpointName": "[if(not(empty(parameters('cosmosDbPrivateEndpointName'))), createObject('value', parameters('cosmosDbPrivateEndpointName')), createObject('value', format('{0}pe-{1}', variables('abbrs').documentDBDatabaseAccounts, variables('resourceToken'))))]",
          "privateEndpointSubnetName": {
            "value": "[reference('vnetExisting').outputs.cosmosPrivateEndpointSubnetName.value]"
          },
          "vNetRG": {
            "value": "[reference('vnetExisting').outputs.vnetRG.value]"
          },
          "dnsZoneRG": {
            "value": "[parameters('dnsZoneRG')]"
          },
          "dnsSubscriptionId": {
            "value": "[parameters('dnsSubscriptionId')]"
          },
          "throughput": {
            "value": "[parameters('cosmosDbRUs')]"
          },
          "publicAccess": {
            "value": "[parameters('cosmosDbPublicAccess')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "13712680063826415587"
            }
          },
          "parameters": {
            "accountName": {
              "type": "string",
              "metadata": {
                "description": "Azure Cosmos DB account name, max length 44 characters"
              }
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]",
              "metadata": {
                "description": "Location for the Azure Cosmos DB account."
              }
            },
            "primaryRegion": {
              "type": "string",
              "defaultValue": "[parameters('location')]",
              "metadata": {
                "description": "The primary region for the Azure Cosmos DB account."
              }
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "defaultConsistencyLevel": {
              "type": "string",
              "defaultValue": "Session",
              "allowedValues": [
                "Eventual",
                "ConsistentPrefix",
                "Session",
                "BoundedStaleness",
                "Strong"
              ],
              "metadata": {
                "description": "The default consistency level of the Cosmos DB account."
              }
            },
            "maxStalenessPrefix": {
              "type": "int",
              "defaultValue": 100000,
              "minValue": 10,
              "maxValue": 2147483647,
              "metadata": {
                "description": "Max stale requests. Required for BoundedStaleness. Valid ranges, Single Region: 10 to 2147483647. Multi Region: 100000 to 2147483647."
              }
            },
            "maxIntervalInSeconds": {
              "type": "int",
              "defaultValue": 300,
              "minValue": 5,
              "maxValue": 86400,
              "metadata": {
                "description": "Max lag time (minutes). Required for BoundedStaleness. Valid ranges, Single Region: 5 to 84600. Multi Region: 300 to 86400."
              }
            },
            "systemManagedFailover": {
              "type": "bool",
              "defaultValue": true,
              "allowedValues": [
                true,
                false
              ],
              "metadata": {
                "description": "Enable system managed failover for regions"
              }
            },
            "databaseName": {
              "type": "string",
              "defaultValue": "ai-usage-db",
              "metadata": {
                "description": "The name for the database"
              }
            },
            "containerName": {
              "type": "string",
              "defaultValue": "ai-usage-container",
              "metadata": {
                "description": "The name for the container"
              }
            },
            "pricingContainerName": {
              "type": "string",
              "defaultValue": "model-pricing",
              "metadata": {
                "description": "The name for the container"
              }
            },
            "piiUsageContainerName": {
              "type": "string",
              "defaultValue": "pii-usage-container",
              "metadata": {
                "description": "The name for the container"
              }
            },
            "streamingExportConfigContainerName": {
              "type": "string",
              "defaultValue": "streaming-export-config",
              "metadata": {
                "description": "The name for the container"
              }
            },
            "throughput": {
              "type": "int",
              "defaultValue": 400,
              "minValue": 400,
              "maxValue": 1000000,
              "metadata": {
                "description": "The throughput for the container"
              }
            },
            "cosmosPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "cosmosDnsZoneName": {
              "type": "string"
            },
            "publicAccess": {
              "type": "string",
              "defaultValue": "Disabled"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            }
          },
          "variables": {
            "consistencyPolicy": {
              "Eventual": {
                "defaultConsistencyLevel": "Eventual"
              },
              "ConsistentPrefix": {
                "defaultConsistencyLevel": "ConsistentPrefix"
              },
              "Session": {
                "defaultConsistencyLevel": "Session"
              },
              "BoundedStaleness": {
                "defaultConsistencyLevel": "BoundedStaleness",
                "maxStalenessPrefix": "[parameters('maxStalenessPrefix')]",
                "maxIntervalInSeconds": "[parameters('maxIntervalInSeconds')]"
              },
              "Strong": {
                "defaultConsistencyLevel": "Strong"
              }
            },
            "locations": [
              {
                "locationName": "swedencentral",
                "failoverPriority": 0,
                "isZoneRedundant": false
              }
            ]
          },
          "resources": [
            {
              "type": "Microsoft.DocumentDB/databaseAccounts",
              "apiVersion": "2024-02-15-preview",
              "name": "[toLower(parameters('accountName'))]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('accountName')))]",
              "kind": "GlobalDocumentDB",
              "properties": {
                "consistencyPolicy": "[variables('consistencyPolicy')[parameters('defaultConsistencyLevel')]]",
                "locations": "[variables('locations')]",
                "databaseAccountOfferType": "Standard",
                "enableAutomaticFailover": "[parameters('systemManagedFailover')]",
                "disableKeyBasedMetadataWriteAccess": true,
                "publicNetworkAccess": "[parameters('publicAccess')]"
              }
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}', toLower(parameters('accountName')), parameters('databaseName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('databaseName')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts', toLower(parameters('accountName')))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}/{2}', toLower(parameters('accountName')), parameters('databaseName'), parameters('containerName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('containerName')]",
                  "partitionKey": {
                    "paths": [
                      "/productName"
                    ],
                    "kind": "Hash"
                  },
                  "indexingPolicy": {
                    "indexingMode": "consistent",
                    "automatic": true
                  }
                },
                "options": {
                  "throughput": "[parameters('throughput')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}/{2}', toLower(parameters('accountName')), parameters('databaseName'), parameters('pricingContainerName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('pricingContainerName')]",
                  "partitionKey": {
                    "paths": [
                      "/model"
                    ],
                    "kind": "Hash"
                  },
                  "indexingPolicy": {
                    "indexingMode": "consistent",
                    "automatic": true
                  }
                },
                "options": {
                  "throughput": "[parameters('throughput')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}/{2}', toLower(parameters('accountName')), parameters('databaseName'), parameters('streamingExportConfigContainerName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('streamingExportConfigContainerName')]",
                  "partitionKey": {
                    "paths": [
                      "/type"
                    ],
                    "kind": "Hash"
                  },
                  "indexingPolicy": {
                    "indexingMode": "consistent",
                    "automatic": true
                  }
                },
                "options": {
                  "throughput": "[parameters('throughput')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}/{2}', toLower(parameters('accountName')), parameters('databaseName'), parameters('piiUsageContainerName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('piiUsageContainerName')]",
                  "partitionKey": {
                    "paths": [
                      "/type"
                    ],
                    "kind": "Hash"
                  },
                  "indexingPolicy": {
                    "indexingMode": "consistent",
                    "automatic": true
                  }
                },
                "options": {
                  "throughput": "[parameters('throughput')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('accountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "sql"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('cosmosDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('cosmosPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.DocumentDB/databaseAccounts', toLower(parameters('accountName')))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1357425506328167870"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts', toLower(parameters('accountName')))]"
              ]
            }
          ],
          "outputs": {
            "location": {
              "type": "string",
              "value": "[parameters('location')]"
            },
            "cosmosDbAccountName": {
              "type": "string",
              "value": "[toLower(parameters('accountName'))]"
            },
            "cosmosDbDatabaseName": {
              "type": "string",
              "value": "[parameters('databaseName')]"
            },
            "cosmosDbContainerName": {
              "type": "string",
              "value": "[parameters('containerName')]"
            },
            "cosmosDbPiiUsageContainerName": {
              "type": "string",
              "value": "[parameters('piiUsageContainerName')]"
            },
            "cosmosDbPricingContainerName": {
              "type": "string",
              "value": "[parameters('pricingContainerName')]"
            },
            "cosmosDbStreamingExportConfigContainerName": {
              "type": "string",
              "value": "[parameters('streamingExportConfigContainerName')]"
            },
            "resourceId": {
              "type": "string",
              "value": "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
            },
            "cosmosDbEndpoint": {
              "type": "string",
              "value": "[format('https://{0}.documents.azure.com:443/', toLower(parameters('accountName')))]"
            }
          }
        }
      },
      "dependsOn": [
        "vnetExisting"
      ]
    },
    "storageAccount": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "storage",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "storageAccountName": "[if(not(empty(parameters('storageAccountName'))), createObject('value', parameters('storageAccountName')), createObject('value', format('funcusage{0}', variables('resourceToken'))))]",
          "vNetName": {
            "value": "[reference('vnetExisting').outputs.vnetName.value]"
          },
          "privateEndpointSubnetName": {
            "value": "[reference('vnetExisting').outputs.storageAccountPrivateEndpointSubnetName.value]"
          },
          "storageBlobDnsZoneName": {
            "value": "[variables('storageBlobPrivateDnsZoneName')]"
          },
          "storageFileDnsZoneName": {
            "value": "[variables('storageFilePrivateDnsZoneName')]"
          },
          "storageTableDnsZoneName": {
            "value": "[variables('storageTablePrivateDnsZoneName')]"
          },
          "storageQueueDnsZoneName": {
            "value": "[variables('storageQueuePrivateDnsZoneName')]"
          },
          "storageBlobPrivateEndpointName": "[if(not(empty(parameters('storageBlobPrivateEndpointName'))), createObject('value', parameters('storageBlobPrivateEndpointName')), createObject('value', format('{0}blob-pe-{1}', variables('abbrs').storageStorageAccounts, variables('resourceToken'))))]",
          "storageFilePrivateEndpointName": "[if(not(empty(parameters('storageFilePrivateEndpointName'))), createObject('value', parameters('storageFilePrivateEndpointName')), createObject('value', format('{0}file-pe-{1}', variables('abbrs').storageStorageAccounts, variables('resourceToken'))))]",
          "storageTablePrivateEndpointName": "[if(not(empty(parameters('storageTablePrivateEndpointName'))), createObject('value', parameters('storageTablePrivateEndpointName')), createObject('value', format('{0}table-pe-{1}', variables('abbrs').storageStorageAccounts, variables('resourceToken'))))]",
          "storageQueuePrivateEndpointName": "[if(not(empty(parameters('storageQueuePrivateEndpointName'))), createObject('value', parameters('storageQueuePrivateEndpointName')), createObject('value', format('{0}queue-pe-{1}', variables('abbrs').storageStorageAccounts, variables('resourceToken'))))]",
          "functionContentShareName": {
            "value": "[parameters('functionContentShareName')]"
          },
          "logicContentShareName": {
            "value": "[parameters('logicContentShareName')]"
          },
          "vNetRG": {
            "value": "[reference('vnetExisting').outputs.vnetRG.value]"
          },
          "dnsZoneRG": {
            "value": "[parameters('dnsZoneRG')]"
          },
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "2219779011221855639"
            }
          },
          "parameters": {
            "storageAccountName": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "vNetName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "storageBlobDnsZoneName": {
              "type": "string"
            },
            "storageBlobPrivateEndpointName": {
              "type": "string"
            },
            "storageFileDnsZoneName": {
              "type": "string"
            },
            "storageFilePrivateEndpointName": {
              "type": "string"
            },
            "storageTableDnsZoneName": {
              "type": "string"
            },
            "storageTablePrivateEndpointName": {
              "type": "string"
            },
            "storageQueueDnsZoneName": {
              "type": "string"
            },
            "storageQueuePrivateEndpointName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            },
            "provisionFunctionShare": {
              "type": "bool",
              "defaultValue": true
            },
            "provisionLogicShare": {
              "type": "bool",
              "defaultValue": true
            },
            "functionContentShareName": {
              "type": "string"
            },
            "logicContentShareName": {
              "type": "string"
            },
            "storageAccountType": {
              "type": "string",
              "defaultValue": "Standard_LRS",
              "allowedValues": [
                "Standard_LRS",
                "Standard_GRS",
                "Standard_RAGRS"
              ],
              "metadata": {
                "description": "Storage Account type"
              }
            }
          },
          "resources": [
            {
              "type": "Microsoft.Storage/storageAccounts",
              "apiVersion": "2022-05-01",
              "name": "[parameters('storageAccountName')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('storageAccountName')))]",
              "sku": {
                "name": "[parameters('storageAccountType')]"
              },
              "kind": "StorageV2",
              "properties": {
                "supportsHttpsTrafficOnly": true,
                "publicNetworkAccess": "Disabled",
                "allowBlobPublicAccess": false,
                "accessTier": "Hot",
                "networkAcls": {
                  "bypass": "None",
                  "defaultAction": "Deny"
                }
              }
            },
            {
              "condition": "[parameters('provisionFunctionShare')]",
              "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
              "apiVersion": "2022-05-01",
              "name": "[format('{0}/default/{1}', parameters('storageAccountName'), parameters('functionContentShareName'))]",
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "condition": "[parameters('provisionLogicShare')]",
              "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
              "apiVersion": "2022-05-01",
              "name": "[format('{0}/default/{1}', parameters('storageAccountName'), parameters('logicContentShareName'))]",
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-blob-privateEndpoint', parameters('storageAccountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "blob"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('storageBlobDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('storageBlobPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1357425506328167870"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-file-privateEndpoint', parameters('storageAccountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "file"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('storageFileDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('storageFilePrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1357425506328167870"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-table-privateEndpoint', parameters('storageAccountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "table"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('storageTableDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('storageTablePrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1357425506328167870"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-queue-privateEndpoint', parameters('storageAccountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "queue"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('storageQueueDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('storageQueuePrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1357425506328167870"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            }
          ],
          "outputs": {
            "storageAccountName": {
              "type": "string",
              "value": "[parameters('storageAccountName')]"
            }
          }
        }
      },
      "dependsOn": [
        "vnetExisting"
      ]
    },
    "logicApp": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "usageLogicApp",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "logicAppName": "[if(not(empty(parameters('usageProcessingLogicAppName'))), createObject('value', parameters('usageProcessingLogicAppName')), createObject('value', format('{0}usage-{1}', variables('abbrs').logicWorkflows, variables('resourceToken'))))]",
          "azdserviceName": {
            "value": "usageProcessingLogicApp"
          },
          "storageAccountName": {
            "value": "[reference('storageAccount').outputs.storageAccountName.value]"
          },
          "skuFamily": {
            "value": "WS"
          },
          "skuName": {
            "value": "WS1"
          },
          "skuCapaicty": {
            "value": "[parameters('logicAppsSkuCapacityUnits')]"
          },
          "skuSize": {
            "value": "WS1"
          },
          "skuTier": {
            "value": "WorkflowStandard"
          },
          "isReserved": {
            "value": false
          },
          "cosmosDbAccountName": {
            "value": "[reference('cosmosDb').outputs.cosmosDbAccountName.value]"
          },
          "eventHubName": {
            "value": "[reference('eventHub').outputs.eventHubName.value]"
          },
          "eventHubNamespaceName": {
            "value": "[reference('eventHub').outputs.eventHubNamespaceName.value]"
          },
          "cosmosDBDatabaseName": {
            "value": "[reference('cosmosDb').outputs.cosmosDbDatabaseName.value]"
          },
          "cosmosDBContainerConfigName": {
            "value": "[reference('cosmosDb').outputs.cosmosDbStreamingExportConfigContainerName.value]"
          },
          "cosmosDBContainerUsageName": {
            "value": "[reference('cosmosDb').outputs.cosmosDbContainerName.value]"
          },
          "cosmosDBContainerPIIName": {
            "value": "[reference('cosmosDb').outputs.cosmosDbPiiUsageContainerName.value]"
          },
          "eventHubPIIName": {
            "value": "[reference('eventHub').outputs.eventHubPIIName.value]"
          },
          "apimAppInsightsName": {
            "value": "[reference('monitoring').outputs.applicationInsightsName.value]"
          },
          "functionAppSubnetId": {
            "value": "[reference('vnetExisting').outputs.logicAppSubnetId.value]"
          },
          "fileShareName": {
            "value": "[parameters('logicContentShareName')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "14853185907545993492"
            }
          },
          "parameters": {
            "logicAppName": {
              "type": "string"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "azdserviceName": {
              "type": "string"
            },
            "storageAccountName": {
              "type": "string"
            },
            "fileShareName": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "skuName": {
              "type": "string"
            },
            "skuFamily": {
              "type": "string"
            },
            "skuSize": {
              "type": "string"
            },
            "skuCapaicty": {
              "type": "int"
            },
            "skuTier": {
              "type": "string"
            },
            "isReserved": {
              "type": "bool"
            },
            "cosmosDbAccountName": {
              "type": "string"
            },
            "functionAppSubnetId": {
              "type": "string"
            },
            "dotnetFrameworkVersion": {
              "type": "string",
              "defaultValue": "v6.0"
            },
            "eventHubNamespaceName": {
              "type": "string"
            },
            "eventHubName": {
              "type": "string"
            },
            "eventHubPIIName": {
              "type": "string"
            },
            "cosmosDBDatabaseName": {
              "type": "string"
            },
            "cosmosDBContainerConfigName": {
              "type": "string"
            },
            "cosmosDBContainerUsageName": {
              "type": "string"
            },
            "cosmosDBContainerPIIName": {
              "type": "string"
            },
            "apimAppInsightsName": {
              "type": "string"
            }
          },
          "variables": {
            "docDbAccNativeContributorRoleDefinitionId": "00000000-0000-0000-0000-000000000002",
            "eventHubsDataOwnerRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', 'f526a384-b230-433a-b45c-95f59c4a2dec')]",
            "azureMonitorLogsRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', '43d0d8ad-25c7-4714-9337-8ba259a9fe05')]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/serverfarms",
              "apiVersion": "2024-04-01",
              "name": "[format('hosting-plan-{0}', parameters('logicAppName'))]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', format('hosting-plan-{0}', parameters('logicAppName'))))]",
              "location": "[parameters('location')]",
              "sku": {
                "name": "[parameters('skuName')]",
                "tier": "[parameters('skuTier')]",
                "family": "[parameters('skuFamily')]",
                "size": "[parameters('skuSize')]",
                "capacity": "[parameters('skuCapaicty')]"
              },
              "kind": "elastic",
              "properties": {
                "maximumElasticWorkerCount": 20,
                "reserved": "[parameters('isReserved')]"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2024-04-01",
              "name": "[parameters('logicAppName')]",
              "location": "[parameters('location')]",
              "kind": "functionapp,workflowapp",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('azdserviceName')))]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "enabled": true,
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', format('hosting-plan-{0}', parameters('logicAppName')))]",
                "reserved": "[parameters('isReserved')]",
                "virtualNetworkSubnetId": "[parameters('functionAppSubnetId')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', format('hosting-plan-{0}', parameters('logicAppName')))]"
              ]
            },
            {
              "type": "Microsoft.Web/sites/networkConfig",
              "apiVersion": "2024-04-01",
              "name": "[format('{0}/{1}', parameters('logicAppName'), 'virtualNetwork')]",
              "properties": {
                "subnetResourceId": "[parameters('functionAppSubnetId')]",
                "swiftSupported": true
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2024-04-01",
              "name": "[format('{0}/{1}', parameters('logicAppName'), 'web')]",
              "properties": {
                "detailedErrorLoggingEnabled": true,
                "vnetRouteAllEnabled": true,
                "ftpsState": "FtpsOnly",
                "minTlsVersion": "1.2",
                "scmMinTlsVersion": "1.2",
                "minimumElasticInstanceCount": 1,
                "publicNetworkAccess": "Enabled",
                "functionsRuntimeScaleMonitoringEnabled": true,
                "netFrameworkVersion": "[parameters('dotnetFrameworkVersion')]",
                "preWarmedInstanceCount": 1,
                "cors": {
                  "allowedOrigins": [
                    "https://portal.azure.com",
                    "https://ms.portal.azure.com"
                  ],
                  "supportCredentials": false
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2024-04-01",
              "name": "[format('{0}/{1}', parameters('logicAppName'), 'appsettings')]",
              "properties": {
                "AzureWebJobsStorage": "[format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix=core.windows.net', parameters('storageAccountName'), listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2023-05-01').keys[0].value)]",
                "FUNCTIONS_EXTENSION_VERSION": "~4",
                "FUNCTIONS_WORKER_RUNTIME": "node",
                "WEBSITE_NODE_DEFAULT_VERSION": "~20",
                "WEBSITE_CONTENTAZUREFILECONNECTIONSTRING": "[format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix=core.windows.net', parameters('storageAccountName'), listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2023-05-01').keys[0].value)]",
                "WEBSITE_CONTENTSHARE": "[parameters('fileShareName')]",
                "WEBSITE_VNET_ROUTE_ALL": "0",
                "WEBSITE_CONTENTOVERVNET": "1",
                "eventHub_fullyQualifiedNamespace": "[format('{0}.servicebus.windows.net', parameters('eventHubNamespaceName'))]",
                "eventHub_name": "[parameters('eventHubName')]",
                "eventHub_pii_name": "[parameters('eventHubPIIName')]",
                "APP_KIND": "workflowapp",
                "AzureFunctionsJobHost_extensionBundle": "Microsoft.Azure.Functions.ExtensionBundle.Workflows",
                "CosmosDBAccount": "[parameters('cosmosDbAccountName')]",
                "CosmosDBDatabase": "[parameters('cosmosDBDatabaseName')]",
                "CosmosDBContainerConfig": "[parameters('cosmosDBContainerConfigName')]",
                "CosmosDBContainerUsage": "[parameters('cosmosDBContainerUsageName')]",
                "CosmosDBContainerPII": "[parameters('cosmosDBContainerPIIName')]",
                "AzureCosmosDB_connectionString": "[listConnectionStrings(resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName')), '2024-02-15-preview').connectionStrings[0].connectionString]",
                "AppInsights_SubscriptionId": "[subscription().subscriptionId]",
                "AppInsights_ResourceGroup": "[resourceGroup().name]",
                "AppInsights_Name": "[parameters('apimAppInsightsName')]",
                "AzureMonitor_Resource_Id": "[reference(resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn'), '2025-04-01').outputs.resourceId.value]",
                "AzureMonitor_Api_Id": "[reference(resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn'), '2025-04-01').outputs.apiId.value]",
                "AzureMonitor_ConnectRuntime_Url": "[reference(resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn'), '2025-04-01').outputs.connectRuntimeUrl.value]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn')]",
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlRoleAssignments",
              "apiVersion": "2023-04-15",
              "name": "[format('{0}/{1}', parameters('cosmosDbAccountName'), guid(resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName')), resourceId('Microsoft.Web/sites', parameters('logicAppName')), variables('docDbAccNativeContributorRoleDefinitionId')))]",
              "properties": {
                "principalId": "[reference(resourceId('Microsoft.Web/sites', parameters('logicAppName')), '2024-04-01', 'full').identity.principalId]",
                "roleDefinitionId": "[format('/{0}/sqlRoleDefinitions/{1}', resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName')), variables('docDbAccNativeContributorRoleDefinitionId'))]",
                "scope": "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName'))]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceGroup().id, resourceId('Microsoft.Web/sites', parameters('logicAppName')), variables('eventHubsDataOwnerRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('eventHubsDataOwnerRoleDefinitionId')]",
                "principalId": "[reference(resourceId('Microsoft.Web/sites', parameters('logicAppName')), '2024-04-01', 'full').identity.principalId]",
                "principalType": "ServicePrincipal"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceGroup().id, resourceId('Microsoft.Web/sites', parameters('logicAppName')), variables('azureMonitorLogsRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('azureMonitorLogsRoleDefinitionId')]",
                "principalId": "[reference(resourceId('Microsoft.Web/sites', parameters('logicAppName')), '2024-04-01', 'full').identity.principalId]",
                "principalType": "ServicePrincipal"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "azuremonitorlogs-conn",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "connection_name": {
                    "value": "azuremonitorlogs"
                  },
                  "display_name": {
                    "value": "conn-azure-monitor"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "connection_name": {
                      "type": "string"
                    },
                    "display_name": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    }
                  },
                  "variables": {},
                  "resources": [
                    {
                      "type": "Microsoft.Web/connections",
                      "name": "[parameters('connection_name')]",
                      "apiVersion": "[providers('Microsoft.Web','connections').apiVersions[0]]",
                      "location": "[parameters('location')]",
                      "kind": "V2",
                      "properties": {
                        "alternativeParameterValues": {},
                        "api": {
                          "id": "[subscriptionResourceId('Microsoft.Web/locations/managedApis', parameters('location'), parameters('connection_name'))]"
                        },
                        "authenticatedUser": {},
                        "connectionState": "Enabled",
                        "customParameterValues": {},
                        "displayName": "[parameters('display_name')]",
                        "parameterValueSet": {
                          "name": "managedIdentityAuth",
                          "values": {}
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "connectRuntimeUrl": {
                      "type": "string",
                      "value": "[reference(resourceId('Microsoft.Web/connections', parameters('connection_name')), '2016-06-01').connectionRuntimeUrl]"
                    },
                    "resourceId": {
                      "type": "string",
                      "value": "[resourceId('Microsoft.Web/connections', parameters('connection_name'))]"
                    },
                    "apiId": {
                      "type": "string",
                      "value": "[subscriptionResourceId('Microsoft.Web/locations/managedApis', parameters('location'), parameters('connection_name'))]"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "azuremonitorlogs-access",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "connectionName": {
                    "value": "azuremonitorlogs"
                  },
                  "accessPolicyName": {
                    "value": "azuremonitorlogs-access"
                  },
                  "identityPrincipalId": {
                    "value": "[reference(resourceId('Microsoft.Web/sites', parameters('logicAppName')), '2024-04-01', 'full').identity.principalId]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "6892316694194080083"
                    }
                  },
                  "parameters": {
                    "connectionName": {
                      "type": "string"
                    },
                    "accessPolicyName": {
                      "type": "string"
                    },
                    "identityPrincipalId": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Web/connections/accessPolicies",
                      "apiVersion": "2016-06-01",
                      "name": "[format('{0}/{1}', parameters('connectionName'), parameters('accessPolicyName'))]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "principal": {
                          "type": "ActiveDirectory",
                          "identity": {
                            "tenantId": "[subscription().tenantId]",
                            "objectId": "[parameters('identityPrincipalId')]"
                          }
                        }
                      }
                    }
                  ]
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn')]",
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            }
          ],
          "outputs": {
            "logicAppName": {
              "type": "string",
              "metadata": {
                "description": "Logic App name"
              },
              "value": "[parameters('logicAppName')]"
            },
            "logicAppId": {
              "type": "string",
              "metadata": {
                "description": "Logic App resource id"
              },
              "value": "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
            },
            "logicAppPrincipalId": {
              "type": "string",
              "metadata": {
                "description": "System-assigned managed identity principalId (use this for RBAC from main.bicep)"
              },
              "value": "[reference(resourceId('Microsoft.Web/sites', parameters('logicAppName')), '2024-04-01', 'full').identity.principalId]"
            }
          }
        }
      },
      "dependsOn": [
        "cosmosDb",
        "eventHub",
        "monitoring",
        "storageAccount",
        "vnetExisting"
      ]
    },
    "redis": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "redis-semcache",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[resourceGroup().location]"
          },
          "redisClusterName": {
            "value": "[parameters('redisClusterName')]"
          },
          "redisDatabaseName": {
            "value": "default"
          },
          "skuName": {
            "value": "[parameters('skuName')]"
          },
          "vNetName": {
            "value": "[reference('vnetExisting').outputs.vnetName.value]"
          },
          "privateEndpointSubnetName": {
            "value": "[reference('vnetExisting').outputs.redisPrivateEndpointSubnetName.value]"
          },
          "redisPrivateDnsZoneName": {
            "value": "[variables('redisPrivateDnsZoneName')]"
          },
          "redisPrivateEndpointName": {
            "value": "[parameters('redisPrivateEndpointName')]"
          },
          "vNetRG": {
            "value": "[reference('vnetExisting').outputs.vnetRG.value]"
          },
          "dnsZoneRG": {
            "value": "[parameters('dnsZoneRG')]"
          },
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]",
          "publicNetworkAccess": {
            "value": "Disabled"
          },
          "tags": {
            "value": {
              "workload": "apim-semcache"
            }
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "7210975235059924719"
            }
          },
          "parameters": {
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]",
              "metadata": {
                "description": "Azure region for the Redis cluster."
              }
            },
            "redisClusterName": {
              "type": "string",
              "metadata": {
                "description": "Name of the Azure Managed Redis (Redis Enterprise) cluster."
              }
            },
            "redisDatabaseName": {
              "type": "string",
              "defaultValue": "default",
              "metadata": {
                "description": "Name of the database inside the cluster."
              }
            },
            "skuName": {
              "type": "string",
              "metadata": {
                "description": "Redis Enterprise SKU name. Example: Enterprise_E10, Enterprise_E20, EnterpriseFlash_F300, Balanced_B5, etc."
              }
            },
            "publicNetworkAccess": {
              "type": "string",
              "defaultValue": "Disabled",
              "allowedValues": [
                "Enabled",
                "Disabled"
              ],
              "metadata": {
                "description": "Public network access for the cluster endpoint."
              }
            },
            "tags": {
              "type": "object",
              "defaultValue": {},
              "metadata": {
                "description": "Optional tags."
              }
            },
            "redisPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "redisPrivateDnsZoneName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            }
          },
          "resources": [
            {
              "type": "Microsoft.Cache/redisEnterprise",
              "apiVersion": "2025-07-01",
              "name": "[parameters('redisClusterName')]",
              "location": "[parameters('location')]",
              "tags": "[parameters('tags')]",
              "sku": {
                "name": "[parameters('skuName')]"
              },
              "properties": {
                "highAvailability": "Enabled",
                "minimumTlsVersion": "1.2",
                "publicNetworkAccess": "[parameters('publicNetworkAccess')]"
              }
            },
            {
              "type": "Microsoft.Cache/redisEnterprise/databases",
              "apiVersion": "2025-07-01",
              "name": "[format('{0}/{1}', parameters('redisClusterName'), parameters('redisDatabaseName'))]",
              "properties": {
                "accessKeysAuthentication": "Enabled",
                "clientProtocol": "Encrypted",
                "clusteringPolicy": "EnterpriseCluster",
                "evictionPolicy": "NoEviction",
                "modules": [
                  {
                    "name": "RediSearch",
                    "args": ""
                  }
                ]
              },
              "dependsOn": [
                "[resourceId('Microsoft.Cache/redisEnterprise', parameters('redisClusterName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('redisClusterName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "redis"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('redisPrivateDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('redisPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.Cache/redisEnterprise', parameters('redisClusterName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "1357425506328167870"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Cache/redisEnterprise', parameters('redisClusterName'))]"
              ]
            }
          ],
          "outputs": {
            "redisClusterId": {
              "type": "string",
              "value": "[resourceId('Microsoft.Cache/redisEnterprise', parameters('redisClusterName'))]"
            },
            "redisDatabaseId": {
              "type": "string",
              "value": "[resourceId('Microsoft.Cache/redisEnterprise/databases', parameters('redisClusterName'), parameters('redisDatabaseName'))]"
            },
            "redisHostName": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Cache/redisEnterprise', parameters('redisClusterName')), '2025-07-01').hostName]"
            },
            "redisPrivateEndpointName": {
              "type": "string",
              "value": "[format('{0}-privateEndpoint', parameters('redisClusterName'))]"
            }
          }
        }
      },
      "dependsOn": [
        "vnetExisting"
      ]
    },
    "redisKeys": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "redis-keys",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "clusterName": {
            "value": "[parameters('redisClusterName')]"
          },
          "databaseName": {
            "value": "default"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "languageVersion": "2.0",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "13223389295377988982"
            }
          },
          "parameters": {
            "clusterName": {
              "type": "string"
            },
            "databaseName": {
              "type": "string",
              "defaultValue": "default"
            },
            "apiVersion": {
              "type": "string",
              "defaultValue": "2025-07-01"
            }
          },
          "resources": {
            "getKeys": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2021-04-01",
              "name": "[format('{0}-redis-db-keys', parameters('clusterName'))]",
              "properties": {
                "mode": "Incremental",
                "parameters": {
                  "clusterName": {
                    "value": "[parameters('clusterName')]"
                  },
                  "databaseName": {
                    "value": "[parameters('databaseName')]"
                  },
                  "apiVersion": {
                    "value": "[parameters('apiVersion')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "clusterName": {
                      "type": "string"
                    },
                    "databaseName": {
                      "type": "string"
                    },
                    "apiVersion": {
                      "type": "string"
                    }
                  },
                  "resources": [],
                  "outputs": {
                    "primaryKey": {
                      "type": "string",
                      "value": "[[listKeys(resourceId(\"Microsoft.Cache/redisEnterprise/databases\", parameters(\"clusterName\"), parameters(\"databaseName\")), parameters(\"apiVersion\")).primaryKey]"
                    }
                  }
                }
              }
            }
          },
          "outputs": {
            "primaryKey": {
              "type": "securestring",
              "value": "[reference('getKeys').outputs.primaryKey.value]"
            }
          }
        }
      },
      "dependsOn": [
        "redis"
      ]
    },
    "rbac": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "rbac",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": {
            "value": "rbac"
          },
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "apimPrincipalId": {
            "value": "[reference('apim').outputs.apimPrincipalId.value]"
          },
          "logicAppPrincipalId": {
            "value": "[reference('logicApp').outputs.logicAppPrincipalId.value]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "12873550541391275171"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "apimPrincipalId": {
              "type": "string",
              "metadata": {
                "description": "APIM system-assigned managed identity principalId"
              }
            },
            "logicAppPrincipalId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional: Logic App (Workflow Standard) system-assigned managed identity principalId"
              }
            }
          },
          "variables": {
            "cognitiveServicesOpenAIUserRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', '5e0bd9bd-7b93-4f28-af87-19fc36ad61bd')]",
            "cognitiveServicesUserRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', 'a97b65f3-24c7-4388-baec-2e87135dc908')]",
            "eventHubsDataSenderRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', '2b629674-e913-4c01-ae53-ef4638d8f975')]"
          },
          "resources": [
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceGroup().id, parameters('apimPrincipalId'), variables('cognitiveServicesUserRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('cognitiveServicesUserRoleDefinitionId')]",
                "principalId": "[parameters('apimPrincipalId')]",
                "principalType": "ServicePrincipal"
              }
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceGroup().id, parameters('apimPrincipalId'), variables('cognitiveServicesOpenAIUserRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('cognitiveServicesOpenAIUserRoleDefinitionId')]",
                "principalId": "[parameters('apimPrincipalId')]",
                "principalType": "ServicePrincipal"
              }
            },
            {
              "condition": "[not(empty(parameters('logicAppPrincipalId')))]",
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceGroup().id, parameters('logicAppPrincipalId'), variables('eventHubsDataSenderRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('eventHubsDataSenderRoleDefinitionId')]",
                "principalId": "[parameters('logicAppPrincipalId')]",
                "principalType": "ServicePrincipal"
              }
            }
          ]
        }
      },
      "dependsOn": [
        "apim",
        "logicApp"
      ]
    },
    "logicAppRbac": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "logicapp-rbac",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "principalResourceId": {
            "value": "[reference('logicApp').outputs.logicAppId.value]"
          },
          "principalId": {
            "value": "[reference('logicApp').outputs.logicAppPrincipalId.value]"
          },
          "cosmosDbAccountName": {
            "value": "[reference('cosmosDb').outputs.cosmosDbAccountName.value]"
          },
          "storageAccountName": {
            "value": "[parameters('storageAccountName')]"
          },
          "assignCosmosSqlContributor": {
            "value": true
          },
          "assignEventHubsDataOwner": {
            "value": true
          },
          "tags": {
            "value": "[parameters('tags')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.39.26.7824",
              "templateHash": "11366146161359480040"
            }
          },
          "parameters": {
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "principalResourceId": {
              "type": "string",
              "metadata": {
                "description": "Resource ID of the workload that owns the system-assigned identity (e.g., APIM, Logic App, Function App). Used only to generate deterministic roleAssignment names."
              }
            },
            "principalId": {
              "type": "string",
              "metadata": {
                "description": "Principal (object) ID of the workload system-assigned identity."
              }
            },
            "cosmosDbAccountName": {
              "type": "string",
              "metadata": {
                "description": "Cosmos DB account name that the workload needs SQL RBAC on."
              }
            },
            "assignCosmosSqlContributor": {
              "type": "bool",
              "defaultValue": true,
              "metadata": {
                "description": "Assign Cosmos DB built-in Data Contributor (SQL role definition 000...002)."
              }
            },
            "assignEventHubsDataOwner": {
              "type": "bool",
              "defaultValue": true,
              "metadata": {
                "description": "Assign Event Hubs Data Owner at resourceGroup scope."
              }
            },
            "storageAccountName": {
              "type": "string",
              "metadata": {
                "description": "Name of the Storage Account"
              }
            }
          },
          "variables": {
            "storageBlobDataOwnerRoleId": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b7e6dc6d-f1e8-4753-8033-0f276bb0955b')]",
            "docDbAccNativeContributorRoleDefinitionId": "00000000-0000-0000-0000-000000000002",
            "eventHubsDataOwnerRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', 'f526a384-b230-433a-b45c-95f59c4a2dec')]"
          },
          "resources": [
            {
              "condition": "[parameters('assignCosmosSqlContributor')]",
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlRoleAssignments",
              "apiVersion": "2023-04-15",
              "name": "[format('{0}/{1}', parameters('cosmosDbAccountName'), guid(resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName')), parameters('principalResourceId'), variables('docDbAccNativeContributorRoleDefinitionId')))]",
              "properties": {
                "principalId": "[parameters('principalId')]",
                "roleDefinitionId": "[format('/{0}/sqlRoleDefinitions/{1}', resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName')), variables('docDbAccNativeContributorRoleDefinitionId'))]",
                "scope": "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName'))]"
              }
            },
            {
              "condition": "[parameters('assignEventHubsDataOwner')]",
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceGroup().id, parameters('principalResourceId'), variables('eventHubsDataOwnerRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('eventHubsDataOwnerRoleDefinitionId')]",
                "principalId": "[parameters('principalId')]",
                "principalType": "ServicePrincipal"
              }
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "scope": "[format('Microsoft.Storage/storageAccounts/{0}', parameters('storageAccountName'))]",
              "name": "[guid(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), parameters('principalResourceId'), variables('storageBlobDataOwnerRoleId'))]",
              "properties": {
                "principalId": "[parameters('principalId')]",
                "roleDefinitionId": "[variables('storageBlobDataOwnerRoleId')]"
              }
            }
          ]
        }
      },
      "dependsOn": [
        "cosmosDb",
        "logicApp"
      ]
    }
  },
  "outputs": {
    "APIM_NAME": {
      "type": "string",
      "value": "[reference('apim').outputs.apimName.value]"
    },
    "APIM_AOI_PATH": {
      "type": "string",
      "value": "[reference('apim').outputs.apimOpenaiApiPath.value]"
    },
    "APIM_GATEWAY_URL": {
      "type": "string",
      "value": "[reference('apim').outputs.apimGatewayUrl.value]"
    }
  }
}